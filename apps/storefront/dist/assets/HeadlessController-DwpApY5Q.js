var J=Object.defineProperty;var $=(s,e,r)=>e in s?J(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var k=(s,e,r)=>$(s,typeof e!="symbol"?e+"":e,r);import{r as n}from"./reactVendor-BTcQ-GDs.js";import{i as j,G as V,u as p,t as X,v as Y,w as Z,C as O,x,y as K,B as tt,z as v,A as et,D as rt,H as st,I as ot,J as nt,K as at,L as ut,M as it}from"./react-setup-Ceu1rkpw.js";import"./mui-BOgrCzfx.js";import{b as D}from"./base-BCVDEF8S.js";import"./load-functions-BIyT0cKp.js";import{c as ct}from"./b3ShoppingList-BbQWIY5B.js";import{e as M,s as dt}from"./masquerade-DfgGkYcY.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"./lodashEs-DKEtmQJE.js";import"./lang-D1hDrxfH.js";import"./intl-CKipw3rV.js";import"../index.Dxi-ailt.js";import"./global-D7Yn0gGb.js";import"./router-DEI8QtBD.js";import"./muiIcon-dPEugcco.js";import"./dateFns-DCN-lSH3.js";import"./dropzone-BroiqFaF.js";import"./eCache-BdHG5F0B.js";class pt{constructor(){k(this,"callbacks",new Map)}addEventListener(e,r){var o;if(typeof r!="function"){console.error("callback should be a function");return}if(!this.callbacks.has(e))this.callbacks.set(e,[r]);else{const a=(o=this.callbacks.get(e))!=null?o:[];a.find(i=>i===r)||a.push(r)}}removeEventListener(e,r){var u;if(!this.callbacks.has(e))return!1;const o=(u=this.callbacks.get(e))!=null?u:[],a=o.findIndex(i=>i===r);return a===-1?!1:(o.splice(a,1),this.callbacks.set(e,o),!0)}dispatchEvent(e,r){var i;let o=!0;const a={data:r,preventDefault:()=>{o=!1}};return this.callbacks.has(e)?(((i=this.callbacks.get(e))!=null?i:[]).forEach(l=>{try{l(a)}catch(m){o=!1,m instanceof Error&&D.error(m.message)}}),o):!0}}const U=s=>s.map(e=>{const{selectedOptions:r}=e;return{...e,selectedOptions:r==null?void 0:r.reduce((o,{optionEntityId:a,optionValueEntityId:u})=>(o["attribute[".concat(a,"]")]=u,o),{})}}),lt=new pt;function kt({setOpenPage:s}){const e=j(),{state:r}=n.useContext(V),o=p(X),a=p(({b2bFeatures:t})=>t.masqueradeCompany.id),u=p(({company:t})=>t.customer),i=p(({company:t})=>t.customer.role),l=p(Y),m=p(({b2bFeatures:t})=>t.masqueradeCompany.isAgenting),b=p(({company:t})=>t.tokens.B2BToken),N=Z(),{state:{addQuoteBtn:h,shoppingListBtn:B,addToAllQuoteBtn:C}}=n.useContext(O),{addToQuoteFromCart:G,addToQuoteFromCookie:_}=et(s),{registerEnabled:H,productQuoteEnabled:R,cartQuoteEnabled:y,shoppingListEnabled:I,quoteConfig:L}=r,W=()=>{s({isOpen:!0,openUrl:"/register"})},w=u.id,f=n.useRef(Number(a)),E=n.useRef(w),c=n.useRef(u),A=n.useRef(Number(i)),g=n.useRef(o),S=n.useRef(R),T=n.useRef(I),Q=n.useRef(y),P=n.useRef(h),q=n.useRef(B),F=n.useRef(C);return f.current=Number(a),E.current=w,c.current=u,A.current=Number(i),g.current=o,S.current=R,T.current=I,Q.current=y,P.current=h,q.current=B,F.current=C,n.useEffect(()=>{window.b2b={...window.b2b,callbacks:lt,utils:{getRoutes:()=>rt(r),openPage:t=>setTimeout(()=>{if(t==="CLOSE"){s({isOpen:!1});return}const d=t.startsWith("/")?t:it[t];s({isOpen:!0,openUrl:d})},0),quote:{addProductFromPage:t=>v([t],s),addProductsFromCart:_,addProductsFromCartId:G,addProducts:t=>v(t,s),getQuoteConfigs:()=>L,getCurrent:()=>({productList:l}),getButtonInfo:()=>({...P.current,enabled:S.current}),getButtonInfoAddAllFromCartToQuote:()=>({...F.current,enabled:Q.current})},user:{getProfile:()=>({...c.current,role:i}),getMasqueradeState:async()=>{if(typeof c.current.b2bId!="number")return{current_company_id:f.current,companies:[]};const{superAdminCompanies:{edges:t=[]}}=await ut(c.current.b2bId,{first:50,offset:0,orderBy:"companyName"});return{current_company_id:f.current,companies:t.map(({node:d})=>d)}},getB2BToken:()=>b,setMasqueradeCompany:t=>{typeof c.current.b2bId=="number"&&dt({companyId:t,customerId:E.current})},endMasquerade:()=>{typeof c.current.b2bId=="number"&&M()},graphqlBCProxy:tt.graphqlBCProxy,loginWithB2BStorefrontToken:async t=>{e(nt(t)),await at(t)},logout:async()=>{try{m&&await M()}catch(t){D.error(t)}finally{window.sessionStorage.clear(),ot(),window.b2b.callbacks.dispatchEvent("on-logout")}}},shoppingList:{itemFromCurrentPage:[],addProductFromPage:t=>{window.b2b.utils.shoppingList.itemFromCurrentPage=U([t]),st({role:A.current,storeDispatch:e,saveFn:W,setOpenPage:s,registerEnabled:H})},addProducts:(t,d)=>K({shoppingListId:t,items:U(d),isB2BUser:g.current,customerGroupId:c.current.customerGroupId}).then(()=>N(t.toString())),createNewShoppingList:async(t,d)=>{const{shoppingListsCreate:z}=await ct({data:{name:t,description:d},isB2BUser:g.current});return z.shoppingList},getButtonInfo:()=>({...q.current,enabled:T.current})},cart:{setEntityId:t=>{x.set("cartId",t)},getEntityId:()=>x.get("cartId")}}}},[l,b,r,L]),null}export{kt as default};
//# sourceMappingURL=HeadlessController-DwpApY5Q.js.map
