System.register(["./reactVendor-legacy-CtYIj4Ma.js","./react-setup-legacy-CJFY1VSJ.js","./mui-legacy-CLOaLEk9.js","./base-legacy-D2P4nFX7.js","./load-functions-legacy-BQBPfliD.js","./b3ShoppingList-legacy-DeMdkiLb.js","./masquerade-legacy-BIYectCk.js","./redux-legacy-D5ZHjMNV.js","./toolkit-legacy-uWyLsHZ1.js","./lodashEs-legacy-5FC1NR51.js","./lang-legacy-TODaA4m_.js","./intl-legacy-B7uNycgM.js","../index-legacy.C2G06ioT.js","./global-legacy-B1EgakWG.js","./router-legacy-s4T0V6vG.js","./muiIcon-legacy-D-EcFXKh.js","./dateFns-legacy-C2RUCIEF.js","./dropzone-legacy-CIQbZZBD.js","./eCache-legacy-CW-H9Ud9.js"],(function(e,t){"use strict";var r,n,s,a,o,c,u,l,i,d,g,p,b,m,y,f,h,C,I,j,B,k,w,E;return{setters:[e=>{r=e.r},e=>{n=e.i,s=e.G,a=e.u,o=e.t,c=e.v,u=e.w,l=e.C,i=e.x,d=e.y,g=e.B,p=e.z,b=e.A,m=e.D,y=e.H,f=e.I,h=e.J,C=e.K,I=e.L,j=e.M},null,e=>{B=e.b},null,e=>{k=e.c},e=>{w=e.e,E=e.s},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",(function({setOpenPage:e}){const L=n(),{state:F}=r.useContext(s),R=a(o),q=a((({b2bFeatures:e})=>e.masqueradeCompany.id)),v=a((({company:e})=>e.customer)),x=a((({company:e})=>e.customer.role)),T=a(c),O=a((({b2bFeatures:e})=>e.masqueradeCompany.isAgenting)),Q=a((({company:e})=>e.tokens.B2BToken)),S=u(),{state:{addQuoteBtn:A,shoppingListBtn:N,addToAllQuoteBtn:M}}=r.useContext(l),{addToQuoteFromCart:U,addToQuoteFromCookie:_}=b(e),{registerEnabled:D,productQuoteEnabled:G,cartQuoteEnabled:z,shoppingListEnabled:V,quoteConfig:W}=F,H=()=>{e({isOpen:!0,openUrl:"/register"})},J=v.id,K=r.useRef(Number(q)),$=r.useRef(J),X=r.useRef(v),Y=r.useRef(Number(x)),Z=r.useRef(R),ee=r.useRef(G),te=r.useRef(V),re=r.useRef(z),ne=r.useRef(A),se=r.useRef(N),ae=r.useRef(M);return K.current=Number(q),$.current=J,X.current=v,Y.current=Number(x),Z.current=R,ee.current=G,te.current=V,re.current=z,ne.current=A,se.current=N,ae.current=M,r.useEffect((()=>{window.b2b={...window.b2b,callbacks:P,utils:{getRoutes:()=>m(F),openPage:t=>setTimeout((()=>{if("CLOSE"===t)return void e({isOpen:!1});const r=t.startsWith("/")?t:j[t];e({isOpen:!0,openUrl:r})}),0),quote:{addProductFromPage:t=>p([t],e),addProductsFromCart:_,addProductsFromCartId:U,addProducts:t=>p(t,e),getQuoteConfigs:()=>W,getCurrent:()=>({productList:T}),getButtonInfo:()=>({...ne.current,enabled:ee.current}),getButtonInfoAddAllFromCartToQuote:()=>({...ae.current,enabled:re.current})},user:{getProfile:()=>({...X.current,role:x}),getMasqueradeState:async()=>{if("number"!=typeof X.current.b2bId)return{current_company_id:K.current,companies:[]};const{superAdminCompanies:{edges:e=[]}}=await I(X.current.b2bId,{first:50,offset:0,orderBy:"companyName"});return{current_company_id:K.current,companies:e.map((({node:e})=>e))}},getB2BToken:()=>Q,setMasqueradeCompany:e=>{"number"==typeof X.current.b2bId&&E({companyId:e,customerId:$.current})},endMasquerade:()=>{"number"==typeof X.current.b2bId&&w()},graphqlBCProxy:g.graphqlBCProxy,loginWithB2BStorefrontToken:async e=>{L(h(e)),await C(e)},logout:async()=>{try{O&&await w()}catch(e){B.error(e)}finally{window.sessionStorage.clear(),f(),window.b2b.callbacks.dispatchEvent("on-logout")}}},shoppingList:{itemFromCurrentPage:[],addProductFromPage:r=>{window.b2b.utils.shoppingList.itemFromCurrentPage=t([r]),y({role:Y.current,storeDispatch:L,saveFn:H,setOpenPage:e,registerEnabled:D})},addProducts:(e,r)=>d({shoppingListId:e,items:t(r),isB2BUser:Z.current,customerGroupId:X.current.customerGroupId}).then((()=>S(e.toString()))),createNewShoppingList:async(e,t)=>{const{shoppingListsCreate:r}=await k({data:{name:e,description:t},isB2BUser:Z.current});return r.shoppingList},getButtonInfo:()=>({...se.current,enabled:te.current})},cart:{setEntityId:e=>{i.set("cartId",e)},getEntityId:()=>i.get("cartId")}}}}),[T,Q,F,W]),null}));const t=e=>e.map((e=>{const{selectedOptions:t}=e;return{...e,selectedOptions:t?.reduce(((e,{optionEntityId:t,optionValueEntityId:r})=>(e[`attribute[${t}]`]=r,e)),{})}})),P=new class{callbacks=new Map;addEventListener(e,t){if("function"==typeof t)if(this.callbacks.has(e)){const r=this.callbacks.get(e)??[];r.find((e=>e===t))||r.push(t)}else this.callbacks.set(e,[t]);else console.error("callback should be a function")}removeEventListener(e,t){if(!this.callbacks.has(e))return!1;const r=this.callbacks.get(e)??[],n=r.findIndex((e=>e===t));return-1!==n&&(r.splice(n,1),this.callbacks.set(e,r),!0)}dispatchEvent(e,t){let r=!0;const n={data:t,preventDefault:()=>{r=!1}};return!this.callbacks.has(e)||((this.callbacks.get(e)??[]).forEach((e=>{try{e(n)}catch(t){r=!1,t instanceof Error&&B.error(t.message)}})),r)}}}}}));
//# sourceMappingURL=HeadlessController-legacy-RpwSXtXR.js.map
