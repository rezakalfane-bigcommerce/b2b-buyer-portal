import{z as oe,j as a,L as le,ae as de,x as ce,B as x,T as C}from"./mui-BLXOPN2Y.js";import{r as g}from"./reactVendor-BTcQ-GDs.js";import{u as ie}from"./lang-DZEhsX8V.js";import{aj as R,u as f,t as q,aw as M,au as E,a as ue,aU as me,ac as pe,ak as ye}from"./react-setup-CIpmLpp1.js";import"./load-functions-BRbpFqwb.js";import"./base-BCVDEF8S.js";import{O as V,f as fe,d as be,e as he,o as xe,g as ge,a as Ie}from"./OrderStatus-Cun5x70p.js";import{u as Se}from"./useSort-CwDaxthI.js";import{B as Ne}from"./B2BAutoCompleteCheckbox-C4unpN9i.js";import{B as Be}from"./B3Filter-DSoItPvE.js";import{u as H}from"./router-DEI8QtBD.js";const L="orderId",T={orderId:"bcOrderId",poNumber:"poNumber",totalIncTax:"totalIncTax",status:"status",placedBy:"placedBy",createdAt:"createdAt"},F={q:"",companyId:"",beginDateAt:null,endDateAt:null,companyName:"",orderBy:"-".concat(T[L]),createdBy:"",orderNumber:"",poNumber:"",isShowMy:0,companyIds:[]},Ce={beginDateAt:null,endDateAt:null,orderBy:"-".concat(T[L]),createdBy:"",q:""},we=(t,r,o,l,i,y=[])=>{var p;const c=y.filter(u=>u.statusCode!=="0"&&u.statusCode!=="1"),b=((p=i==null?void 0:i.createdByUser)==null?void 0:p.results.map(u=>({createdBy:"".concat(u.firstName," ").concat(u.lastName," (").concat(u.email,")")})))||[],h=[{name:"company",label:"Company",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small",idLang:"orders.company"},{name:"orderStatus",label:"Order status",required:!1,default:"",fieldType:"dropdown",options:c,replaceOptions:{label:"customLabel",value:"customLabel"},xs:12,variant:"filled",size:"small",idLang:"orders.orderStatus"},{name:"PlacedBy",label:"Placed by",required:!1,default:"",fieldType:"dropdown",options:b,replaceOptions:{label:"createdBy",value:"createdBy"},xs:12,variant:"filled",size:"small",idLang:"orders.placedBy"}],I=t&&!(Number(r)===3&&!l);return h.filter(u=>!((!t||I)&&!o&&(u.name==="company"||u.name==="PlacedBy")||Number(r)===3&&!l&&u.name==="PlacedBy"||(t||Number(r)===R.SUPER_ADMIN&&l)&&o&&u.name==="company"))},je=(t,r)=>(r&&(F.isShowMy=t?0:1),r?F:Ce),Ae=(t,r)=>{var o;return((o=r.find(l=>l.systemLabel===t))==null?void 0:o.customLabel)||""},Le=ce("div")(()=>({display:"flex",alignItems:"center","&.between-flex":{justifyContent:"space-between"}}));function Te({item:t,allTotal:r,filterData:o,index:l=0,isCompanyOrder:i}){const y=oe(),c=f(q),b=f(({company:p})=>p.customer),h=H(),I=p=>{h("/orderDetail/".concat(p.orderId),{state:{currentIndex:l||0,searchParams:o,totalCount:r,isCompanyOrder:i}})},d=p=>c?"by ".concat(p.firstName," ").concat(p.lastName):"by ".concat(b.firstName," ").concat(b.lastName);return a.jsx(le,{children:a.jsxs(de,{sx:{color:"rgba(0, 0, 0, 0.6)"},onClick:()=>I(t),children:[a.jsxs(Le,{className:"between-flex",children:[a.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(C,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)"},children:"# ".concat(t.orderId)}),a.jsx(C,{sx:{ml:1},variant:"body2",children:t.poNumber?t.poNumber:"–"})]}),a.jsx(x,{children:a.jsx(V,{code:t.status})})]}),a.jsx(C,{variant:"h6",sx:{marginBottom:y.spacing(2.5),mt:y.spacing(1.5),minHeight:"1.43em"},children:M(t.totalIncTax)}),a.jsxs(x,{sx:{display:"flex",justifyContent:"space-between"},children:[a.jsx(C,{variant:"body2",sx:{fontWeight:"normal",marginRight:y.spacing(2)},children:d(t)}),a.jsx(C,{children:"".concat(E(t.createdAt))})]})]})},t.orderId)}function Pe(){const t=f(q),r=f(({company:d})=>d.companyInfo.id),o=f(({company:d})=>d.customer.role),l=f(({b2bFeatures:d})=>d.masqueradeCompany.id),i=f(({b2bFeatures:d})=>d.masqueradeCompany.isAgenting),{order:y}=f(({company:d})=>d.pagesSubsidiariesPermission),{selectCompanyHierarchyId:c,isEnabledCompanyHierarchy:b}=f(({company:d})=>d.companyHierarchyInfo),h=o===R.SUPER_ADMIN&&i?Number(l):Number(r);return{role:o,isAgenting:i,isB2BUser:t,orderSubViewPermission:y,selectCompanyHierarchyId:c,isEnabledCompanyHierarchy:b,currentCompanyId:h,companyId:r||l}}function Ke({isCompanyOrder:t=!1}){const r=ie(),[o]=ue(),{role:l,isAgenting:i,companyId:y,isB2BUser:c,orderSubViewPermission:b,selectCompanyHierarchyId:h,isEnabledCompanyHierarchy:I,currentCompanyId:d}=Pe(),[p,u]=g.useState(!1),[P,K]=g.useState(0),[n,N]=g.useState(null),[W,z]=g.useState([]),[O,U]=g.useState([]),[J,D]=g.useState(!1),[_,G,Q]=Se(T,L,n,N);g.useEffect(()=>{const e=je(t,c);if(c&&(e.companyIds=[Number(h)||Number(d)]),N(e),D(!0),l===100)return;(async()=>{const m=c&&t?await fe(Number(y),0):{},S=c?await be():await he(),w=we(c,l,t,i,m,S);U(S);const ne=w.map(B=>{const k=B;return k.label=r(B.idLang),B.name==="orderStatus"&&(k.options=B.options.map(j=>{const $=xe[j.systemLabel],A=j;return A.customLabel=r($)===A.systemLabel?A.customLabel:r($),j})),B});z(ne)})()},[h]);const X=async e=>{const{edges:s=[],totalCount:m}=c?await ge(e):await Ie(e);return K(m),D(!1),{edges:s,totalCount:m}},Y=H(),Z=(e,s)=>{Y("/orderDetail/".concat(e.orderId),{state:{currentIndex:s,searchParams:n,totalCount:P,isCompanyOrder:t,beginDateAt:n==null?void 0:n.beginDateAt,endDateAt:n==null?void 0:n.endDateAt}})},v=[{key:"orderId",title:r("orders.order"),width:"10%",isSortable:!0},{key:"companyName",title:r("orders.company"),width:"10%",isSortable:!1,render:e=>{const{companyInfo:s}=e;return a.jsx(x,{children:(s==null?void 0:s.companyName)||"–"})}},{key:"poNumber",title:r("orders.poReference"),render:e=>a.jsx(x,{children:e.poNumber?e.poNumber:"–"}),width:"10%",isSortable:!0},{key:"totalIncTax",title:r("orders.grandTotal"),render:e=>e!=null&&e.money?me(JSON.parse(JSON.parse(e.money)),e.totalIncTax):M(e.totalIncTax),width:"8%",style:{textAlign:"right"},isSortable:!0},{key:"status",title:r("orders.orderStatus"),render:e=>a.jsx(V,{text:Ae(e.status,O),code:e.status}),width:"10%",isSortable:!0},{key:"placedBy",title:r("orders.placedBy"),render:e=>"".concat(e.firstName," ").concat(e.lastName),width:"10%",isSortable:!0},{key:"createdAt",title:r("orders.createdOn"),render:e=>"".concat(E(Number(e.createdAt))),width:"10%",isSortable:!0}],ee=()=>v.filter(s=>{const{key:m}=s;return!(!c&&m==="companyName"||(!c||Number(l)===3&&!i)&&m==="placedBy"||m==="companyId"&&c&&(Number(l)!==3||i)||(m==="companyId"||m==="placedBy")&&!(Number(l)===3&&!i)&&!t)}),te=(e,s)=>{e==="search"&&N({...n,q:s})},re=e=>{let s=(e==null?void 0:e.orderStatus)||"";if(s){const S=O.find(w=>w.customLabel===s||w.systemLabel===s);s=(S==null?void 0:S.systemLabel)||s}const m={beginDateAt:(e==null?void 0:e.startValue)||null,endDateAt:(e==null?void 0:e.endValue)||null,createdBy:(e==null?void 0:e.PlacedBy)||"",statusCode:s,companyName:(e==null?void 0:e.company)||""};N({...n,...m})},se=ee(),ae=e=>{const s=e.includes(-1)?[]:e;N({...n,companyIds:s})};return a.jsx(pe,{isSpinning:p,children:a.jsxs(x,{sx:{display:"flex",flexDirection:"column",flex:1,width:"100%"},children:[a.jsxs(x,{sx:{width:o?"100%":"auto",display:"flex",justifyContent:"flex-start",alignItems:o?"flex-start":"center",flexDirection:o?"column":"row","& > div":{width:o?"100%":"auto"}},children:[I&&b&&a.jsx(x,{sx:{mr:o?0:"10px",mb:"30px"},children:a.jsx(Ne,{handleChangeCompanyIds:ae})}),a.jsx(Be,{startPicker:{isEnabled:!0,label:r("orders.from"),defaultValue:(n==null?void 0:n.beginDateAt)||null,pickerKey:"start"},endPicker:{isEnabled:!0,label:r("orders.to"),defaultValue:(n==null?void 0:n.endDateAt)||null,pickerKey:"end"},filterMoreInfo:W,handleChange:te,handleFilterChange:re,pcTotalWidth:"100%",pcContainerWidth:"100%",pcSearchContainerWidth:"100%"})]}),a.jsx(ye,{columnItems:se,rowsPerPageOptions:[10,20,30],getRequestList:X,searchParams:n||{},isCustomRender:!1,requestLoading:u,tableKey:"orderId",pageType:"orderListPage",isAutoRefresh:J,sortDirection:G,orderBy:Q,sortByFn:_,renderItem:(e,s)=>a.jsx(Te,{item:e,index:s,allTotal:P,filterData:n,isCompanyOrder:t},e.orderId),onClickRow:(e,s)=>{s!==void 0&&Z(e,s)},hover:!0})]})})}export{Ke as O};
//# sourceMappingURL=Order-Xmkxb856.js.map
