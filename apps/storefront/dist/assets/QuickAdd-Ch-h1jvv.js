import{j as u,B as V,G as w,T as ht}from"./mui-DDntJqep.js";import{r as k}from"./reactVendor-BTcQ-GDs.js";import{u as mt}from"./form-hNmOEDBo.js";import{u as gt}from"./lang-o717ABxZ.js";import{u as B,t as kt,c3 as yt,c4 as Q,ac as T,ad as D,b7 as bt,af as y,aQ as xt,aR as At}from"./react-setup-BZUAuJbV.js";import{B as Lt}from"./B3CustomForm-DbCZxrBC.js";import"./load-functions-KyGF85Ss.js";import"./base-BCVDEF8S.js";import{u as St}from"./useBlockPendingAccountViewPrice-CRiD_yUB.js";function $t(R){const r=gt(),{updateList:M,quickAddToList:U,level:P=3,buttonText:_=r("shoppingList.quickAdd.addToShoppingList"),buttonLoading:z=!1,type:E}=R,G=B(kt),J=B(({company:t})=>t.companyInfo.status),F=B(({quoteInfo:t})=>t.draftQuoteList),[K]=St(),[b,W]=k.useState(P),[H,Y]=k.useState([]),[S,C]=k.useState(!1),$=(t,e)=>{new Array(t).fill(1).forEach((n,s)=>e(s))};k.useEffect(()=>{let t=[];$(b,e=>{t=[...t,...bt(e,r)]}),Y(t)},[b]);const X=()=>{W(b+P)},{control:Z,handleSubmit:tt,getValues:st,formState:{errors:et},setError:x,setValue:I}=mt({mode:"all"}),nt=(t,e,n)=>{if(!e&&!n)return!0;let s=!0;const i=parseInt(n,10)||0;return e||(x("sku-".concat(t),{type:"manual",message:r("global.validate.required",{label:r("purchasedProducts.quickAdd.sku")})}),s=!1),n?i<=0&&(x("qty-".concat(t),{type:"manual",message:"incorrect number"}),s=!1):(x("qty-".concat(t),{type:"manual",message:r("global.validate.required",{label:r("purchasedProducts.quickAdd.qty")})}),s=!1),s},ot=t=>{const e={};let n=!0;return $(b,s=>{const i=t["sku-".concat(s)],a=t["qty-".concat(s)];if(n=nt(s,i,a)===!1?!1:n,n&&i){const c=parseInt(a,10)||0;e[i]=e[i]?e[i]+c:c}}),{skuValue:e,isValid:n,skus:Object.keys(e)}},it=k.useCallback((t,e,n)=>{const s=[],i=[],a=[],c=[],g=[],p=[];return n.forEach(d=>{const f=(t||[]).find(o=>o.variantSku.toUpperCase()===d.toUpperCase());if(!f){s.push(d);return}const{productId:q,variantId:ct,option:dt,purchasingDisabled:lt="1",modifiers:pt,variantSku:ft}=f,N=yt(pt),L=e[d]||0;if(lt==="1"&&E!=="shoppingList"){i.push(d);return}if(N.filter(o=>!o.isVerified).length>0){g.push(d);return}if(Number(L)<1||Number(L)>1e6){p.push(d);return}const h=(dt||[]).reduce((o,l)=>{try{const m=typeof l=="string"?JSON.parse(l):l;return o.push({optionId:"attribute[".concat(m.option_id,"]"),optionValue:"".concat(m.id)}),o}catch(m){return o}},[]);N.forEach(o=>{const{type:l}=o;if(l==="date"){const{defaultValue:m}=o;Object.keys(m).forEach(O=>{h.push({optionId:"attribute[".concat(o.option_id,"][").concat(O,"]"),optionValue:"".concat(o.defaultValue[O])})})}else h.push({optionId:"attribute[".concat(o.option_id,"]"),optionValue:"".concat(o.defaultValue)})}),c.push(d);const j=F.find(o=>o.node.variantSku===ft);if(j){const o=JSON.parse(j.node.optionList);let{quantity:l}=j.node;if((o.length>h.length?Q(o,h):Q(h,o))&&(l+=L),l>1e6){p.push(d);return}}a.push({...f,newSelectOptionList:h,productId:parseInt(q,10)||0,quantity:L,variantId:parseInt(ct,10)||0})}),{notFoundSku:s,notPurchaseSku:i,productItems:a,passSku:c,notAddAble:g,numberLimit:p}},[F,E]),A=(t,e,n,s)=>{e.forEach(i=>{const a=Object.keys(t).find(c=>t[c]===i)||"";a&&x(a.replace("sku",n),{type:"manual",message:s})})},rt=(t,e)=>{e.forEach(n=>{const s=Object.keys(t).find(i=>t[i]===n)||"";s&&(I(s,""),I(s.replace("sku","qty"),""))})},at=async t=>{const e=G?xt:At;try{const{variantSku:n}=await e({skus:t},!0);return n}catch(n){return[]}},v=()=>{if(K&&J===0){y.info("Your business account is pending approval. This feature is currently disabled.");return}tt(async t=>{try{C(!0);const{skuValue:e,isValid:n,skus:s}=ot(t);if(!n||s.length<=0)return;const i=await at(s),{notFoundSku:a,notPurchaseSku:c,productItems:g,notAddAble:p,passSku:d,numberLimit:f}=it(i,e,s);a.length>0&&(A(t,a,"sku",""),y.error(r("shoppingList.quickAdd.skuNotFound",{notFoundSku:a.join(", ")}),{isClose:!0})),c.length>0&&(A(t,c,"sku",""),y.error(r("shoppingList.quickAdd.skuNotPurchasable",{notPurchaseSku:c.join(", ")}),{isClose:!0})),p.length>0&&(A(t,p,"sku",""),y.error(r("shoppingList.quickAdd.skuNotAddable",{notAddAble:p.join(", ")}),{isClose:!0})),f.length>0&&(f.forEach(q=>{A(t,[q],"qty","")}),y.error(r("shoppingList.quickAdd.skuLimitQuantity",{numberLimit:f.join(", ")}),{isClose:!0})),g.length>0&&(await U(g),rt(t,d),M())}finally{C(!1)}})()},ut=t=>{t.key==="Enter"&&v()};return u.jsx(T,{isSpinning:S,spinningHeight:"auto",children:u.jsxs(V,{sx:{width:"100%"},children:[u.jsxs(w,{container:!0,sx:{margin:"16px 0"},children:[u.jsx(w,{item:!0,sx:{flex:1,display:"flex",alignItems:"center"},children:u.jsx(ht,{sx:{color:"#000"},variant:"body1",children:r("shoppingList.quickAdd.quickAdd")})}),u.jsx(w,{item:!0,children:u.jsx(D,{variant:"text",sx:{textTransform:"initial",ml:"-8px",fontWeight:"400"},onClick:X,children:r("shoppingList.quickAdd.showMoreRows")})})]}),u.jsx(V,{onKeyDown:ut,sx:{"& label":{zIndex:0}},children:u.jsx(Lt,{formFields:H,errors:et,control:Z,getValues:st,setValue:I})}),u.jsx(D,{variant:"outlined",fullWidth:!0,disabled:S,onClick:v,sx:{margin:"20px 0"},children:u.jsx(T,{isSpinning:z?S:!1,tip:"",size:16,children:u.jsx(V,{sx:{flex:1,textAlign:"center"},children:_})})})]})})}export{$t as Q};
//# sourceMappingURL=QuickAdd-Ch-h1jvv.js.map
