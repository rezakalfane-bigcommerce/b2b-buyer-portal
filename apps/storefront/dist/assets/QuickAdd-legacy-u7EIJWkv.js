System.register(["./mui-legacy-nJi-LPwx.js","./reactVendor-legacy-CtYIj4Ma.js","./form-legacy-CAo5v63e.js","./lang-legacy-1f-gtWXv.js","./react-setup-legacy-DuBzGPOI.js","./B3CustomForm-legacy-CZbiJ61c.js","./load-functions-legacy-Cd9k4nWw.js","./base-legacy-D2P4nFX7.js","./useBlockPendingAccountViewPrice-legacy-DO2Hc-4y.js"],(function(t,e){"use strict";var s,n,i,o,r,u,a,l,c,d,p,h,f,g,k,y,m,b,x;return{setters:[t=>{s=t.j,n=t.B,i=t.G,o=t.T},t=>{r=t.r},t=>{u=t.u},t=>{a=t.u},t=>{l=t.u,c=t.t,d=t.c3,p=t.c4,h=t.ac,f=t.ad,g=t.b7,k=t.af,y=t.aQ,m=t.aR},t=>{b=t.B},null,null,t=>{x=t.u}],execute:function(){t("Q",(function(t){const e=a(),{updateList:j,quickAddToList:S,level:q=3,buttonText:A=e("shoppingList.quickAdd.addToShoppingList"),buttonLoading:v=!1,type:L}=t,I=l(c),V=l((({company:t})=>t.companyInfo.status)),$=l((({quoteInfo:t})=>t.draftQuoteList)),[w]=x(),[C,E]=r.useState(q),[P,N]=r.useState([]),[O,F]=r.useState(!1),T=(t,e)=>{new Array(t).fill(1).forEach(((t,s)=>e(s)))};r.useEffect((()=>{let t=[];T(C,(s=>{t=[...t,...g(s,e)]})),N(t)}),[C]);const{control:B,handleSubmit:Q,getValues:_,formState:{errors:z},setError:D,setValue:J}=u({mode:"all"}),R=t=>{const s={};let n=!0;return T(C,(i=>{const o=t[`sku-${i}`],r=t[`qty-${i}`];if(n=!1!==((t,s,n)=>{if(!s&&!n)return!0;let i=!0;const o=parseInt(n,10)||0;return s||(D(`sku-${t}`,{type:"manual",message:e("global.validate.required",{label:e("purchasedProducts.quickAdd.sku")})}),i=!1),n?o<=0&&(D(`qty-${t}`,{type:"manual",message:"incorrect number"}),i=!1):(D(`qty-${t}`,{type:"manual",message:e("global.validate.required",{label:e("purchasedProducts.quickAdd.qty")})}),i=!1),i})(i,o,r)&&n,n&&o){const t=parseInt(r,10)||0;s[o]=s[o]?s[o]+t:t}})),{skuValue:s,isValid:n,skus:Object.keys(s)}},U=r.useCallback(((t,e,s)=>{const n=[],i=[],o=[],r=[],u=[],a=[];return s.forEach((s=>{const l=(t||[]).find((t=>t.variantSku.toUpperCase()===s.toUpperCase()));if(!l)return void n.push(s);const{productId:c,variantId:h,option:f,purchasingDisabled:g="1",modifiers:k,variantSku:y}=l,m=d(k),b=e[s]||0;if("1"===g&&"shoppingList"!==L)return void i.push(s);if(m.filter((t=>!t.isVerified)).length>0)return void u.push(s);if(Number(b)<1||Number(b)>1e6)return void a.push(s);const x=(f||[]).reduce(((t,e)=>{try{const s="string"==typeof e?JSON.parse(e):e;return t.push({optionId:`attribute[${s.option_id}]`,optionValue:`${s.id}`}),t}catch(s){return t}}),[]);m.forEach((t=>{const{type:e}=t;if("date"===e){const{defaultValue:e}=t;Object.keys(e).forEach((e=>{x.push({optionId:`attribute[${t.option_id}][${e}]`,optionValue:`${t.defaultValue[e]}`})}))}else x.push({optionId:`attribute[${t.option_id}]`,optionValue:`${t.defaultValue}`})})),r.push(s);const j=$.find((t=>t.node.variantSku===y));if(j){const t=JSON.parse(j.node.optionList);let{quantity:e}=j.node;if((t.length>x.length?p(t,x):p(x,t))&&(e+=b),e>1e6)return void a.push(s)}o.push({...l,newSelectOptionList:x,productId:parseInt(c,10)||0,quantity:b,variantId:parseInt(h,10)||0})})),{notFoundSku:n,notPurchaseSku:i,productItems:o,passSku:r,notAddAble:u,numberLimit:a}}),[$,L]),W=(t,e,s,n)=>{e.forEach((e=>{const i=Object.keys(t).find((s=>t[s]===e))||"";i&&D(i.replace("sku",s),{type:"manual",message:n})}))},Y=()=>{w&&0===V?k.info("Your business account is pending approval. This feature is currently disabled."):Q((async t=>{try{F(!0);const{skuValue:s,isValid:n,skus:i}=R(t);if(!n||i.length<=0)return;const o=await(async t=>{const e=I?y:m;try{const{variantSku:s}=await e({skus:t},!0);return s}catch(s){return[]}})(i),{notFoundSku:r,notPurchaseSku:u,productItems:a,notAddAble:l,passSku:c,numberLimit:d}=U(o,s,i);r.length>0&&(W(t,r,"sku",""),k.error(e("shoppingList.quickAdd.skuNotFound",{notFoundSku:r.join(", ")}),{isClose:!0})),u.length>0&&(W(t,u,"sku",""),k.error(e("shoppingList.quickAdd.skuNotPurchasable",{notPurchaseSku:u.join(", ")}),{isClose:!0})),l.length>0&&(W(t,l,"sku",""),k.error(e("shoppingList.quickAdd.skuNotAddable",{notAddAble:l.join(", ")}),{isClose:!0})),d.length>0&&(d.forEach((e=>{W(t,[e],"qty","")})),k.error(e("shoppingList.quickAdd.skuLimitQuantity",{numberLimit:d.join(", ")}),{isClose:!0})),a.length>0&&(await S(a),((t,e)=>{e.forEach((e=>{const s=Object.keys(t).find((s=>t[s]===e))||"";s&&(J(s,""),J(s.replace("sku","qty"),""))}))})(t,c),j())}finally{F(!1)}}))()};return s.jsx(h,{isSpinning:O,spinningHeight:"auto",children:s.jsxs(n,{sx:{width:"100%"},children:[s.jsxs(i,{container:!0,sx:{margin:"16px 0"},children:[s.jsx(i,{item:!0,sx:{flex:1,display:"flex",alignItems:"center"},children:s.jsx(o,{sx:{color:"#000"},variant:"body1",children:e("shoppingList.quickAdd.quickAdd")})}),s.jsx(i,{item:!0,children:s.jsx(f,{variant:"text",sx:{textTransform:"initial",ml:"-8px",fontWeight:"400"},onClick:()=>{E(C+q)},children:e("shoppingList.quickAdd.showMoreRows")})})]}),s.jsx(n,{onKeyDown:t=>{"Enter"===t.key&&Y()},sx:{"& label":{zIndex:0}},children:s.jsx(b,{formFields:P,errors:z,control:B,getValues:_,setValue:J})}),s.jsx(f,{variant:"outlined",fullWidth:!0,disabled:O,onClick:Y,sx:{margin:"20px 0"},children:s.jsx(h,{isSpinning:!!v&&O,tip:"",size:16,children:s.jsx(n,{sx:{flex:1,textAlign:"center"},children:A})})})]})})}))}}}));
//# sourceMappingURL=QuickAdd-legacy-u7EIJWkv.js.map
