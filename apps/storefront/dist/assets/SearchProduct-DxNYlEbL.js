import{o as Wt,j as n,B as F,x as X,T as nt,ah as zt,f as xt,ag as Lt}from"./mui-Cw0dwOiN.js";import{r as Mt,u as j,bl as Qt,c1 as Ut,bH as Kt,af as mt,c2 as $t,ab as vt,ac as yt,aN as Gt,aw as Ht,a_ as It,a$ as Ot,bn as Jt,b4 as ft,bg as Xt,a as kt,aV as Yt,ad as gt,b0 as Zt}from"./react-setup-DSYWb28G.js";import{r as s}from"./reactVendor-BTcQ-GDs.js";import{u as st}from"./lang-6J3-0YIA.js";import{d as wt}from"./B3FilterSearch-D1P6QGaK.js";import"./load-functions-DL5N0fkL.js";import{b as te}from"./base-BCVDEF8S.js";import{u as ee}from"./useBlockPendingAccountViewPrice-DHifFlSn.js";import{u as ne}from"./form-hNmOEDBo.js";import{g as se}from"./lodashEs-DKEtmQJE.js";import{B as ie}from"./B3CustomForm-B8D1YiOY.js";var Pt={},oe=Wt;Object.defineProperty(Pt,"__esModule",{value:!0});var ae=Pt.default=void 0,re=oe(Mt()),ce=n;ae=Pt.default=(0,re.default)((0,ce.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile");const le=X("div")({display:"flex",wordBreak:"break-word",gap:"8px",flexWrap:"wrap",padding:"12px 0 12px","&:first-of-type":{marginTop:"12px"}}),ht=X("div")(({padding:h})=>({display:"flex",flexGrow:1,flexShrink:1,alignItems:"flex-start",width:"100%",padding:h||"0 0 0 16px"})),de=X("img")(()=>({width:"60px",height:"60px",borderRadius:"4px",marginTop:"12px",flexShrink:0})),ue=X("div")(()=>({fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"})),pe=X(xt)(()=>({"& input::-webkit-outer-spin-button, input::-webkit-inner-spin-button":{marginTop:"-8px",marginBottom:"8px"}}));function he(h){const{isOpen:l,onCancel:I,onConfirm:O,product:e,isEdit:m=!1,isLoading:b,setIsLoading:D,isB2BUser:V,type:k,...Q}=h,L=st(),{addButtonText:v=L("shoppingList.chooseOptionsDialog.addToList")}=Q,y=j(({global:t})=>t.showInclusiveTaxPrice),N=j(({global:t})=>t.blockPendingQuoteNonPurchasableOOS.isEnableProduct),w=j(({b2bFeatures:t})=>t.masqueradeCompany.id),R=j(t=>t.company.customer.customerGroupId),U=j(t=>t.company.companyInfo.id),[f,_]=s.useState(1),[u,x]=s.useState([]),[p,S]=s.useState(null),[P,it]=s.useState(""),[ot,Y]=s.useState((e==null?void 0:e.imageUrl)||""),[Z,K]=s.useState(!0),[W,at]=s.useState({}),[$,rt]=s.useState([]),[tt,et]=s.useState(0),[B,G]=s.useState([]),[ct,a]=s.useState(!1);s.useEffect(()=>{if(k==="quote"&&e)if(P){const t=e;t.quantity=f;const i=!!Qt(t.base_price,t,{sku:P});K(i)}else{const t=e;t.quantity=f,!!Ut(t.base_price,t)||K(!1)}else(k==="shoppingList"||k==="quickOrder")&&e&&K(!(e!=null&&e.isPriceHidden))},[P,f,e,k]);const T=async t=>{var i,r;try{D(!0);const o=((i=t==null?void 0:t.modifiers)==null?void 0:i.filter(g=>g.type==="product_list_with_images"||g.type==="product_list"))||[],d={},C={};if(o.length>0){const g=o.reduce((H,J)=>{const{option_values:M}=J;return M.forEach(A=>{var Ct;(Ct=A==null?void 0:A.value_data)!=null&&Ct.product_id&&H.push(A.value_data.product_id)}),H},[]);if(g.length>0){const H=V?It:Ot,J=U||w,{productsSearch:M}=await H({productIds:g,companyId:J,customerGroupId:R});M.forEach(A=>{d[A.id]=A.imageUrl,C[A.id]=A})}}at(C),_(t.quantity),((r=t.variants)==null?void 0:r.length)===1&&t.variants[0]&&S(t.variants[0]);const c=Jt(t,d);x([...c])}finally{D(!1)}},E=t=>{var r;const i=[];(r=t.allOptions)==null||r.forEach(o=>{(o.type==="product_list_with_images"||o.type==="product_list"||o.type==="checkbox"||o.type==="rectangles"||o.type==="swatch"||o.type==="radio_buttons"||o.type==="dropdown")&&i.push(o)}),rt(i)};s.useEffect(()=>{var t;e?(T(e),G([]),et(0),(t=e==null?void 0:e.allOptions)!=null&&t.length&&E(e)):(_(1),x([]))},[e]);const lt=t=>{var o,d,C;const{variants:i=[]}=t;let r=0;if(P){const c=(o=i.find(g=>g.sku===P))==null?void 0:o.bc_calculated_price;r=(y?c==null?void 0:c.tax_inclusive:c==null?void 0:c.tax_exclusive)||0}else{const c=(d=i[0])==null?void 0:d.bc_calculated_price;r=parseFloat((C=y?c==null?void 0:c.tax_inclusive:c==null?void 0:c.tax_exclusive)==null?void 0:C.toString())||0}return r},Dt=t=>{(!t.target.value||parseInt(t.target.value,10)>0)&&_(t.target.value)},Tt=t=>{["KeyE","Equal","Minus"].indexOf(t.code)>-1&&t.preventDefault()},At=()=>{f||_(1),Number(f)>1e6&&_(1e6)},{control:Bt,handleSubmit:Et,getValues:Vt,formState:{errors:qt},watch:bt,setValue:St,reset:Ft}=ne({mode:"all"}),z=bt(),q=s.useRef(z),dt=s.useCallback(async(t,i="")=>{var C;if(!(((C=u.find(c=>c.name===i))==null?void 0:C.isVariantOption)||!1)||!e||!i)return;const{variants:o=[]}=e||{},d=o.find(c=>{const{option_values:g=[]}=c;return g.reduce((J,M)=>t[Kt.encode("attribute[".concat(M.option_id,"]"))].toString()!==(M.id||"").toString()?!1:J,!0)})||null;if(it(d?d.sku:""),S(d),d&&(d.sku||d.variant_id)){const c=o.find(g=>g.sku===d.sku||g.variant_id===d.variant_id);Y((c==null?void 0:c.image_url)||e.imageUrl||"")}},[u,e]);s.useEffect(()=>{const t=bt((i,{name:r})=>{dt(i,r)});if(u[0]){const i=u.reduce((r,o)=>{const d=r;return d[o.name]=o.default,St(o.name,o.default),r},{});dt(i,u[0].name)}return()=>t.unsubscribe()},[u,dt]);const ut=s.useCallback(()=>{const{purchasing_disabled:t=!0}=p||{};return k!=="shoppingList"&&t===!0&&!N?(mt.error(L("shoppingList.chooseOptionsDialog.productNoLongerForSale")),!1):!0},[N,k,p]),pt=s.useCallback(t=>{const i=$t(u,{},t);return Object.keys(i).map(r=>{var o;return{optionId:r,optionValue:(o=i[r])==null?void 0:o.toString()}})},[u]);s.useEffect(()=>{if(!(q!=null&&q.current&&se(q==null?void 0:q.current,z))&&(q.current=z,Object.keys(z).length&&u.length&&$.length)){const t=pt(z),{variant_id:i=""}=p||{};if(!e||!e.id||!i||!ut())return;const r=[{...e,newSelectOptionList:t,productId:e==null?void 0:e.id,quantity:parseInt(f.toString(),10)||1,variantId:parseInt(i.toString(),10)||1,additionalProducts:W}];if(B[0]){let o=!1;const{newSelectOptionList:d}=B[0];d.forEach(C=>{const c=$.findIndex(g=>C.optionId.includes(String(g.id)));t.forEach(g=>{C.optionId===g.optionId&&C.optionValue!==g.optionValue&&c!==-1&&(o=!0)})}),o&&G(r)}else G(r)}},[W,B,u.length,z,pt,e,$,f,ut,p]),s.useEffect(()=>{(async()=>{try{if(B.length){a(!0);const i=await ft(B);if(i[0]){const{basePrice:r,taxPrice:o}=i[0],d=Xt(Number(r),Number(o));et(d)}}}catch(i){te.error(i)}finally{a(!1)}})()},[B]);const Nt=()=>{Et(t=>{const i=pt(t),{variant_id:r=""}=p||{};!e||!e.id||!r||!ut()||O([{...e,newSelectOptionList:i,productId:e==null?void 0:e.id,quantity:parseInt(f.toString(),10)||1,variantId:parseInt(r.toString(),10)||1,additionalProducts:W}])})()},Rt=()=>{_(1),I()};return s.useEffect(()=>{l||Ft()},[l]),n.jsx(vt,{isOpen:l,rightSizeBtn:m?L("shoppingList.chooseOptionsDialog.saveOption"):v,handleLeftClick:Rt,handRightClick:Nt,title:L("shoppingList.chooseOptionsDialog.chooseOptions"),loading:b||ct,children:n.jsx(yt,{isSpinning:b,children:e&&n.jsx(F,{children:n.jsxs(F,{sx:{display:"flex",flexDirection:"column"},children:[n.jsxs(F,{sx:{display:"flex"},children:[n.jsx(de,{src:ot||e.imageUrl||Gt}),n.jsxs(le,{children:[n.jsx(ht,{padding:"0",children:n.jsxs(F,{sx:{marginLeft:"16px"},children:[n.jsx(nt,{variant:"body1",color:"#212121",children:e.name}),n.jsx(nt,{variant:"body1",color:"#616161",children:P||e.sku}),(e.product_options||[]).map(t=>n.jsx(ue,{children:"".concat(t.display_name,": ").concat(t.display_value)},"".concat(t.option_id)))]})}),n.jsxs(ht,{children:[n.jsx("span",{children:L("shoppingList.chooseOptionsDialog.price")}),Z?Ht(tt*Number(f)||lt(e)):""]}),n.jsx(ht,{children:n.jsx(pe,{type:"number",variant:"filled",label:L("shoppingList.chooseOptionsDialog.quantity"),value:f,onChange:Dt,onKeyDown:Tt,onBlur:At,size:"small",sx:{width:"60%",maxWidth:"100px"}})})]})]}),n.jsx(zt,{sx:{margin:"16px 0 24px"}}),n.jsx(ie,{formFields:u,errors:qt,control:Bt,getValues:Vt,setValue:St})]})})})})}const _t={id:0,isLoading:!1},jt=s.createContext({state:_t,dispatch:()=>{}}),fe=(h,l)=>{switch(l.type){case"all":return{...h,...l.payload};case"init":return{...h,id:l.payload.id};case"loading":return{...h,isLoading:l.payload.isLoading};default:return h}};function _e(h){const[l,I]=s.useReducer(fe,_t),{children:O}=h,e=s.useMemo(()=>({state:l,dispatch:I}),[l]);return n.jsx(jt.Provider,{value:e,children:O})}function ge(h){const{product:{id:l,allOptions:I},onAddToListClick:O,onChooseOptionsClick:e,addButtonText:m}=h,{state:{isLoading:b=!1}}=s.useContext(jt),[D]=kt(),V=st();return I&&I.length>0?n.jsx(gt,{variant:"outlined",onClick:()=>{e(l)},disabled:b,fullWidth:D,children:V("global.searchProduct.chooseOptionsButton")}):n.jsx(gt,{variant:"outlined",onClick:()=>{O(l)},disabled:b,fullWidth:D,children:m})}const xe=Yt;function me(h){const l=st(),{isOpen:I,onCancel:O,searchText:e,productList:m,onSearchTextChange:b,onSearch:D,onProductQuantityChange:V,onAddToListClick:k,onChooseOptionsClick:Q,isLoading:L,type:v,searchDialogTitle:y=l("shoppingLists.title"),addButtonText:N=l("shoppingLists.addButtonText")}=h,w=j(({global:x})=>x.blockPendingQuoteNonPurchasableOOS.isEnableProduct),[R]=kt(),U=()=>{O()},f=x=>{x.key==="Enter"&&D()},_=s.useCallback(x=>{const{variants:p=[]}=x||{},{purchasing_disabled:S=!0}=p[0]||{};return v!=="shoppingList"&&S===!0&&!w?(mt.error(l("shoppingList.chooseOptionsDialog.productNoLongerForSale")),!1):!0},[w,v]),u=x=>{var S;const p=m.find(P=>P.id===x);if(p&&_(p||{})){let P=p.variantId||0;!p.variantId&&((S=p.variants)!=null&&S[0])&&(P=p.variants[0].variant_id),k([{...p,newSelectOptionList:[],quantity:parseInt(p.quantity.toString(),10)||1,variantId:P}])}};return n.jsx(vt,{fullWidth:!0,isOpen:I,handleLeftClick:U,title:y,showRightBtn:!1,loading:L,maxWidth:"md",leftSizeBtn:l("shoppingLists.close"),children:n.jsx(yt,{isSpinning:L,children:n.jsxs(F,{sx:{minWidth:R?"initial":"100%",flex:1},children:[n.jsx(xt,{hiddenLabel:!0,variant:"filled",fullWidth:!0,size:"small",value:e,onChange:b,onKeyDown:f,error:!m||m.length<=0,InputProps:{startAdornment:n.jsx(Lt,{position:"start",children:n.jsx(wt,{})})},sx:{margin:"12px 0","& input":{padding:"12px 12px 12px 0"}}}),m&&m.length>0?n.jsx(xe,{products:m,quantityEditable:!0,type:v,textAlign:R?"left":"right",canToProduct:!0,onProductQuantityChange:V,renderAction:x=>n.jsx(ge,{product:x,onAddToListClick:u,onChooseOptionsClick:Q,addButtonText:N}),actionWidth:"180px"}):n.jsx(nt,{children:"No products found"})]})})})}function je({updateList:h=()=>{},addToList:l,searchDialogTitle:I,addButtonText:O,isB2BUser:e,type:m}){const b=st(),D=j(({company:a})=>a.companyInfo.id),V=j(a=>a.company.customer.customerGroupId),k=j(({company:a})=>a.companyInfo.status),Q=j(({b2bFeatures:a})=>a.masqueradeCompany.id),L=D||Q,[v,y]=s.useState(!1),[N,w]=s.useState(!1),[R,U]=s.useState(!1),[f,_]=s.useState(""),[u,x]=s.useState([]),[p,S]=s.useState(!1),[P,it]=s.useState(),[ot]=ee(),Y=a=>{_(a.target.value)},Z=async()=>{if(!f||v)return;if(ot&&k===0){mt.info(b("global.searchProductAddProduct.businessAccountPendingApproval"));return}const a=e?It:Ot;y(!0);try{const{productsSearch:T}=await a({search:f,companyId:L,customerGroupId:V,categoryFilter:!0}),E=Zt(T);x(E),w(!0)}finally{y(!1)}},K=a=>{a.key==="Enter"&&Z()},W=()=>{Z()},at=()=>{x([])},$=()=>{S(!1),w(!1),R&&(U(!1),h()),at()},rt=(a,T)=>{const E=u.find(lt=>lt.id===a);E&&(E.quantity=T),x([...u])},tt=async a=>{try{y(!0),await ft(a),await l(a),h()}finally{y(!1)}},et=async a=>{await tt(a)},B=a=>{const T=u.find(E=>E.id===a);T&&it({...T}),w(!1),S(!0)},G=()=>{S(!1),w(!0)},ct=async a=>{try{y(!0),await ft(a),await tt(a),S(!1),w(!0)}catch(T){y(!1)}finally{y(!1)}};return n.jsxs(F,{sx:{margin:"24px 0"},children:[n.jsx(nt,{children:b("global.searchProductAddProduct.searchBySkuOrName")}),n.jsx(xt,{hiddenLabel:!0,placeholder:b("global.searchProduct.placeholder.".concat(m)),variant:"filled",fullWidth:!0,size:"small",value:f,onChange:Y,onKeyDown:K,InputProps:{startAdornment:n.jsx(Lt,{position:"start",children:n.jsx(wt,{sx:{w:"32px"}})})},sx:{margin:"12px 0","& input":{padding:"12px 12px 12px 0"}}}),n.jsx(gt,{variant:"outlined",fullWidth:!0,disabled:v,onClick:W,children:n.jsx(yt,{isSpinning:v,tip:"",size:16,children:n.jsx(F,{sx:{flex:1,textAlign:"center"},children:b("global.searchProductAddProduct.searchProduct")})})}),n.jsx(me,{isOpen:N,isLoading:v,productList:u,searchText:f,type:m,onSearchTextChange:Y,onSearch:W,onCancel:$,onProductQuantityChange:rt,onChooseOptionsClick:B,onAddToListClick:et,searchDialogTitle:I,addButtonText:O}),n.jsx(he,{isOpen:p,isLoading:v,type:m,setIsLoading:y,product:P,onCancel:G,onConfirm:ct,addButtonText:O,isB2BUser:e})]})}export{he as C,je as S,jt as a,_e as b,ae as d};
//# sourceMappingURL=SearchProduct-DxNYlEbL.js.map
