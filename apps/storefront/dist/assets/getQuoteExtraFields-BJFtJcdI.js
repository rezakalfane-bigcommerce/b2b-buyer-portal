import{o as Q,j as e,B as u,T as h,W as se,z as re,x as E,am as ne,L as V,ae as J,f as ie}from"./mui-BLXOPN2Y.js";import{r as g}from"./reactVendor-BTcQ-GDs.js";import{u as C}from"./lang-DZEhsX8V.js";import{r as R,bC as le,ac as de,ai as ce,bD as ue,bE as fe,af as D,bF as pe,b2 as xe,i as me,u as N,bG as he,bt as ge,bH as be,a as Y,ad as je,t as ye,a0 as qe,a5 as U,bI as W}from"./react-setup-Dk2lMx-W.js";import"./load-functions-adwiw1MZ.js";import{b as Fe}from"./base-BCVDEF8S.js";import{q as we,m as Ie,n as Ce}from"./QuoteStatus-CIPIH2-3.js";import{n as K}from"./lodashEs-DKEtmQJE.js";var k={},Le=Q;Object.defineProperty(k,"__esModule",{value:!0});var X=k.default=void 0,ve=Le(R()),De=e;X=k.default=(0,ve.default)((0,De.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var P={},Ne=Q;Object.defineProperty(P,"__esModule",{value:!0});var Z=P.default=void 0,Ee=Ne(R()),Se=e;Z=P.default=(0,Ee.default)((0,Se.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");function ee(a){const{children:d,title:t="",header:s,defaultOpen:o=!1,handleOnChange:r}=a,[i,c]=g.useState(o),b=()=>{c(!i)};return g.useEffect(()=>{r&&r(i)},[r,i]),g.useEffect(()=>{o&&c(o)},[o]),e.jsxs(u,{children:[e.jsxs(u,{onClick:b,sx:{display:"flex",justifyContent:"space-between",cursor:"pointer",alignItems:"center"},children:[s||e.jsx(h,{variant:"h5",children:t}),i?e.jsx(X,{}):e.jsx(Z,{})]}),e.jsx(se,{in:i,timeout:"auto",unmountOnExit:!0,children:d})]})}var O={},Te=Q;Object.defineProperty(O,"__esModule",{value:!0});var te=O.default=void 0,Be=Te(R()),$e=e;te=O.default=(0,Be.default)((0,$e.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help");const Ae=E(u)(({style:a})=>({"& .file-upload-area":{cursor:"pointer","& .MuiDropzoneArea-textContainer":{display:"flex",alignItems:"center",color:(a==null?void 0:a.color)||"#1976D2"},"& .MuiDropzoneArea-text":{order:1,textTransform:"uppercase",fontWeight:500,fontSize:"14px",lineHeight:"24px"}}})),ze=E(u)(a=>({display:"flex",background:a.hasdelete==="true"?"rgba(25, 118, 210, 0.3)":"rgba(0, 0, 0, 0.12)",borderRadius:"18px",padding:"6px 8px",alignItems:"center",margin:"0 0 2px",color:"rgba(0, 0, 0, 0.54)","& .fileList-name-area":{display:"flex",flex:1,alignItems:"center"},"& .fileList-name":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",flexGrow:1,flexBasis:"100px",maxWidth:"200px",color:"#313440",fontSize:"14px",cursor:"pointer"}})),_e=E(h)({marginBottom:"16px",fontSize:"10px",color:"rgba(0, 0, 0, 0.38)",padding:"0 12px",textAlign:"right",wordBreak:"break-word"}),G=E(fe)(()=>({transform:"rotate(45deg)",marginRight:"5px"}));function Ue(a,d){const t=C(),{title:s=t("global.fileUpload.addAttachment"),tips:o=t("global.fileUpload.maxFileSizeMessage"),maxFileSize:r=2097152,fileNumber:i=3,limitUploadFn:c,acceptedFiles:b=le,onchange:y=K,fileList:f=[],allowUpload:x=!0,onDelete:p=K,isEndLoadding:I=!1,requestType:S="quoteAttachedFile"}=a,B=re().palette.primary.main,[$,l]=g.useState(!1);g.useImperativeHandle(d,()=>({setUploadLoadding:n=>l(n)}));const m=n=>n/1048576>1?"".concat((n/1048576).toFixed(1),"MB"):n/1024>1?"".concat((n/1024).toFixed(1),"KB"):"".concat(n,"B"),q=(n,F,T)=>{const{size:A,type:z}=n;let _=!1;F.forEach(oe=>{_=new RegExp(oe).test(z)||_});let v="";return _||(v=t("global.fileUpload.fileTypeNotSupported")),A>T&&(v=t("global.fileUpload.fileSizeExceedsLimit",{maxFileSize:m(T)})),v&&D.error(v),v},j=()=>(D.error(t("global.fileUpload.fileSizeExceedsLimit",{maxFileSize:m(r)})),""),w=async n=>{const F=n.length>0?n[0]:null;if(!(F&&c&&c())){if(!c&&F&&f.length>=i){D.error(t("global.fileUpload.maxFileNumber",{fileNumber:i}));return}if(F)try{l(!0);const{code:T,data:A,message:z}=await pe({file:F,type:S});T===200?y({...A,id:xe()}):D.error(z)}finally{I||l(!1)}}},L=n=>{p(n)},ae=n=>{n&&window.open(n,"_blank")};return e.jsx(de,{isSpinning:$,children:e.jsxs(u,{sx:{padding:"12px 0 0",width:"100%"},children:[e.jsx(u,{children:f.map((n,F)=>e.jsxs(u,{children:[e.jsxs(ze,{hasdelete:((n==null?void 0:n.hasDelete)||"").toString(),children:[e.jsxs(u,{className:"fileList-name-area",children:[e.jsx(G,{}),e.jsx(h,{className:"fileList-name",onClick:()=>{ae(n.fileUrl)},children:n.fileName})]}),n.hasDelete&&e.jsx(ce,{sx:{cursor:"pointer"},onClick:()=>{L((n==null?void 0:n.id)||"")}})]}),e.jsx(_e,{children:n.title||""})]},n.id||F))}),x&&e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",marginTop:"10px"},children:[e.jsx(Ae,{style:{color:B},children:e.jsx(ue,{dropzoneClass:"file-upload-area",Icon:G,filesLimit:1,onChange:w,showPreviews:!1,showPreviewsInDropzone:!1,maxFileSize:r,showAlerts:!1,dropzoneText:s,getDropRejectMessage:q,getFileLimitExceedMessage:j,acceptedFiles:b})}),e.jsx(ne,{title:o,sx:{fontSize:"20px",color:"rgba(0, 0, 0, 0.54)"},children:e.jsx(te,{})})]})]})})}const Me=g.forwardRef(Ue);function et(a){const{allowUpload:d=!0,defaultFileList:t=[],status:s,quoteId:o}=a,r=C(),i=me(),c=N(({company:l})=>l.customer.firstName),b=N(({company:l})=>l.customer.lastName),y=N(({quoteInfo:l})=>l.draftQuoteInfo),[f]=he(),[x,p]=g.useState([]),I=g.useRef(null);g.useEffect(()=>{if(s===0){const{fileInfo:l=[]}=y||{};p(typeof l!="object"?[]:l)}else t.length&&p(t)},[t.length,s]);const S=l=>{if(y){const m={...y,fileInfo:l};i(ge(m))}},H=async l=>{var m;try{let q=[];if(s!==0){const j={fileName:l.fileName,fileType:l.fileType,fileUrl:l.fileUrl,fileSize:l.fileSize},{quoteAttachFileCreate:{attachFiles:w}}=await we({fileList:[{...j}],quoteId:o});j.id=w[0].id,q=[{...j,title:r("global.quoteAttachment.uploadedByCustomer",{createdBy:w[0].createdBy}),hasDelete:!0},...x]}else q=[{...l,title:r("global.quoteAttachment.uploadedByCustomerWithName",{firstName:c,lastName:b}),hasDelete:!0},...x],S(q);p(q)}finally{(m=I.current)==null||m.setUploadLoadding(!1)}},B=async l=>{var m,q;try{(m=I.current)==null||m.setUploadLoadding(!0);const j=x.find(L=>L.id===l),w=x.filter(L=>L.id!==l);s!==0&&j?await Ie({fileId:(j==null?void 0:j.id)||"",quoteId:o}):S(w),p(w)}finally{(q=I.current)==null||q.setUploadLoadding(!1)}},$=()=>x.filter(m=>(m==null?void 0:m.title)&&m.title.includes("by customer")).length>=3?(D.error(r("global.quoteAttachment.maxFilesMessage")),!0):!1;return e.jsx(V,{children:e.jsx(J,{sx:{p:"16px !important"},children:e.jsx(ee,{title:r("global.quoteAttachment.title"),children:e.jsx(u,{children:e.jsx(Me,{ref:I,requestType:f!=="b2b"?"customerQuoteAttachedFile":"quoteAttachedFile",isEndLoadding:!0,fileList:x,limitUploadFn:$,onchange:H,onDelete:B,allowUpload:d})})})})})}const Qe=E("div")(({padding:a="1rem",alignItems:d="flex-start",flexDirection:t="row",backgroundColor:s="white",width:o="100%",xs:r})=>({display:"flex",flexDirection:t,alignItems:d,padding:a,width:o,backgroundColor:s,...r}));function Re({status:a,quoteInfo:d}){const t=C(),{info:{quoteTitle:s,referenceNumber:o},extraFields:r=[],recipients:i}=d;return e.jsxs(u,{sx:{width:"100%"},children:[e.jsx(h,{sx:{fontWeight:400,fontSize:"24px",height:"32px"},children:t("quoteDraft.quoteInfo.title")}),e.jsxs(u,{sx:{p:"15px 0"},children:[(s||a==="Draft")&&e.jsx(h,{children:"".concat(t("quoteDraft.quoteInfo.titleText")," ").concat(s)}),(o||a==="Draft")&&e.jsx(h,{children:"".concat(t("quoteDraft.quoteInfo.referenceText")," ").concat(o)}),a==="Draft"&&!i.length?e.jsx(h,{children:t("quoteDraft.quoteInfo.ccEmailText")}):i.map(c=>e.jsx(h,{sx:{wordBreak:"break-all"},children:"".concat(t("quoteDraft.quoteInfo.ccEmailText")," ").concat(c)},"ccEmail-".concat(be.encode(c)))),r.map(c=>(c.value||a==="Draft")&&e.jsx(h,{children:"".concat(c.fieldName,": ").concat(c.value)},"extraField-".concat(c.fieldName)))]})]})}const ke=["name","email","companyName","phoneNumber"],Pe=["label","firstName","lastName","company","address","apartment","city","state","zipCode","country","phoneNumber"],Oe=["label",["firstName","lastName"],"company","address","apartment",["city","state","zipCode","country"],"phoneNumber"];function M({flag:a,title:d,info:t,status:s}){const o=a==="info"?ke:Oe,[r]=Y(),i=C(),c=s==="Draft"?"Please add ".concat(a==="Billing"?"billing":"shipping"," address "):"No ".concat(a==="Billing"?"billing":"shipping"," address"),b=a!=="info"?Pe.some(f=>t&&!!t[f]):!1,y=a==="info"||r?0:"10px";return e.jsxs(u,{sx:{width:r||a==="info"?"100%":"33.3%",paddingLeft:y},children:[e.jsx(h,{sx:{fontWeight:400,fontSize:"24px",height:"32px"},children:d}),e.jsxs(u,{sx:{p:"15px 0"},children:[(b||a==="info")&&JSON.stringify(t)!=="{}"&&o.map(f=>f==="quoteTitle"?s==="Draft"?e.jsx(h,{sx:{wordBreak:"break-all"},variant:"body1",children:"".concat(i("quoteDraft.quoteInfo.quoteTitle")).concat(t[f]||"")},f):"":typeof f=="string"?e.jsx(h,{variant:"body1",children:t&&t[f]||""},f):e.jsx(h,{variant:"body1",children:f.map((x,p)=>p===f.length-1?t[x]||"":x==="firstName"?"".concat(t[x]||""," "):t[x]?"".concat(t[x]||"",", "):"")},"".concat(f))),!b&&a!=="info"&&e.jsx(u,{children:c})]})]})}function tt({quoteAndExtraFieldsInfo:a,contactInfo:d,shippingAddress:t,billingAddress:s,handleEditInfoClick:o,status:r}){const i=C(),[c]=Y();return e.jsxs(Qe,{flexDirection:"column",xs:{boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px"},children:[e.jsxs(u,{sx:{width:"100%",display:"flex",justifyContent:"space-between",flexDirection:c?"column":"row"},children:[e.jsxs(u,{sx:{width:c?"100%":"33.3%"},children:[e.jsx(M,{title:i("quoteDraft.contactInfo.contact"),flag:"info",status:r,info:d}),e.jsx(Re,{status:r,quoteInfo:a})]}),e.jsx(M,{title:i("global.quoteInfo.billing"),flag:"Billing",status:r,info:s}),e.jsx(M,{title:i("global.quoteInfo.shipping"),flag:"Shipping",status:r,info:t})]}),o&&e.jsx(je,{sx:{mt:"10px",mb:"15px"},onClick:o,variant:"outlined",children:i("global.quoteInfo.editInfo")})]})}function at(a){const d=C(),{quoteStatus:t,quoteNotes:s=""}=a,[o,r]=g.useState(""),[i,c]=g.useState(!1),b=N(ye),y=N(qe),f=b?y.quotesCreateActionsPermission:!0,x=p=>{r((p==null?void 0:p.target.value)||""),U.dispatch(W((p==null?void 0:p.target.value)||""))};return g.useEffect(()=>{const p=U.getState().quoteInfo.draftQuoteInfo.note||"";r(p)},[]),g.useEffect(()=>{U.dispatch(W(o||""))},[o]),g.useEffect(()=>{s&&c(!0)},[s]),e.jsx(V,{children:e.jsx(J,{sx:{p:"16px !important"},children:e.jsx(ee,{title:d(t&&t==="Draft"?"global.quoteNote.message":"global.quoteNote.notes"),defaultOpen:i,children:e.jsxs(u,{sx:{padding:"16px 0"},children:[t&&t==="Draft"&&e.jsx(u,{sx:{fontSize:"16px",color:"rgba(0, 0, 0, 0.38)",mb:"16px"},children:d("global.quoteNote.messageNote")}),s?e.jsx(h,{variant:"body1",style:{whiteSpace:"pre-line",maxHeight:"400px",overflow:"auto"},children:s}):e.jsx(u,{children:f?e.jsx(ie,{multiline:!0,fullWidth:!0,rows:5,value:o,onChange:x,label:d("global.quoteNote.typeMessage"),size:"small",variant:"filled",sx:{"& .MuiFormLabel-root":{color:"rgba(0, 0, 0, 0.38)"}}}):null})]})})})})}const He=a=>a.map(t=>{const{listOfValue:s}=t,o={isExtraFields:!0,name:t.fieldName||"",label:t.labelName||"",required:t.isRequired,default:t.defaultValue||"",fieldType:t.fieldCategory||"",xs:6,variant:"filled",size:"small",id:t.id};switch(t.fieldCategory){case"dropdown":if(s){const r=s==null?void 0:s.map(i=>({label:i,value:i}));r.length>0&&(o.options=r)}break;case"number":o.max=t.maximumValue||"";break;case"multiline":o.rows=t.numberOfRows||"";break;default:o.maxLength=t.maximumLength||"";break}return o}),ot=async()=>{let a=[];try{const{quoteExtraFieldsConfig:d}=await Ce(),t=d.filter(o=>o.visibleToEnduser);a=He(t)}catch(d){Fe.error(d)}return a};export{ee as B,Qe as C,tt as Q,at as a,et as b,ot as g};
//# sourceMappingURL=getQuoteExtraFields-BJFtJcdI.js.map
