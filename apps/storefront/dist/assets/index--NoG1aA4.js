import{o as et,j as e,z as De,B as m,L as me,ae,f as tt,am as rt,G as O,T as g,s as ie,d as st}from"./mui-BLXOPN2Y.js";import{g as nt,r as f}from"./reactVendor-BTcQ-GDs.js";import{u as W}from"./lang-DZEhsX8V.js";import{r as ot,G as Ae,u as Q,a0 as qe,ac as Re,aW as at,aH as we,a5 as Se,bd as Ne,be as Le,aF as it,a as he,ad as xe,C as ct,k as lt,a8 as ut,au as ve,bf as V,bg as K,aN as Qe,ak as dt,aZ as pt,am as xt,bh as mt,af as _,bi as ht,t as ft,aY as gt,ar as bt,a_ as yt,a$ as Ct,b0 as jt}from"./react-setup-Dk2lMx-W.js";import"./load-functions-adwiw1MZ.js";import{b as Pt}from"./base-BCVDEF8S.js";import{u as Te,a as ke,g as wt,b as St,c as Nt,Q as vt,d as Tt,e as kt,f as Et,h as It}from"./QuoteStatus-CIPIH2-3.js";import{B as Be,Q as Dt,a as At,b as qt,g as Rt}from"./getQuoteExtraFields-BJFtJcdI.js";import{g as Lt,h as Qt}from"./dateFns-CXOS6Mtj.js";import{s as Bt,a as Ft}from"./b3checkout-DzpbYa4z.js";import{a as fe,u as ge,c as $t}from"./router-DEI8QtBD.js";import{A as Mt}from"./muiIcon-DcrdeM0-.js";import{j as Ee}from"./lodashEs-DKEtmQJE.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.COFs9ak5.js";import"./global-D7Yn0gGb.js";import"./dropzone-BOmS2zFM.js";var Ht=function(){var s=document.getSelection();if(!s.rangeCount)return function(){};for(var n=document.activeElement,a=[],b=0;b<s.rangeCount;b++)a.push(s.getRangeAt(b));switch(n.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":n.blur();break;default:n=null;break}return s.removeAllRanges(),function(){s.type==="Caret"&&s.removeAllRanges(),s.rangeCount||a.forEach(function(C){s.addRange(C)}),n&&n.focus()}},zt=Ht,Ie={"text/plain":"Text","text/html":"Url",default:"Text"},Ut="Copy to clipboard: #{key}, Enter";function Ot(s){var n=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return s.replace(/#{\s*key\s*}/g,n)}function _t(s,n){var a,b,C,j,h,r,y=!1;n||(n={}),a=n.debug||!1;try{C=zt(),j=document.createRange(),h=document.getSelection(),r=document.createElement("span"),r.textContent=s,r.ariaHidden="true",r.style.all="unset",r.style.position="fixed",r.style.top=0,r.style.clip="rect(0, 0, 0, 0)",r.style.whiteSpace="pre",r.style.webkitUserSelect="text",r.style.MozUserSelect="text",r.style.msUserSelect="text",r.style.userSelect="text",r.addEventListener("copy",function(i){if(i.stopPropagation(),n.format)if(i.preventDefault(),typeof i.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var S=Ie[n.format]||Ie.default;window.clipboardData.setData(S,s)}else i.clipboardData.clearData(),i.clipboardData.setData(n.format,s);n.onCopy&&(i.preventDefault(),n.onCopy(i.clipboardData))}),document.body.appendChild(r),j.selectNodeContents(r),h.addRange(j);var d=document.execCommand("copy");if(!d)throw new Error("copy command was unsuccessful");y=!0}catch(i){a&&console.error("unable to copy using execCommand: ",i),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(n.format||"text",s),n.onCopy&&n.onCopy(window.clipboardData),y=!0}catch(S){a&&console.error("unable to copy using clipboardData: ",S),a&&console.error("falling back to prompt"),b=Ot("message"in n?n.message:Ut),window.prompt(b,s)}}finally{h&&(typeof h.removeRange=="function"?h.removeRange(j):h.removeAllRanges()),r&&document.body.removeChild(r),C()}return y}var Vt=_t;const Wt=nt(Vt);var be={},Gt=et;Object.defineProperty(be,"__esModule",{value:!0});var Fe=be.default=void 0,Kt=Gt(ot()),Yt=e;Fe=be.default=(0,Kt.default)((0,Yt.jsx)("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpward");function Xt({msg:s,isEndMessage:n,isCustomer:a}){const b=W();return e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",paddingTop:"5px"},children:[(s==null?void 0:s.role)&&e.jsx(m,{sx:{height:"14px",fontWeight:400,lineHeight:"14px",fontSize:"10px",letterSpacing:"0.17px",color:"rgba(0, 0, 0, 0.38)"},children:s.role}),(s==null?void 0:s.message)&&e.jsxs(m,{sx:{display:"inline-block",lineHeight:"34px",padding:"0 10px",background:a?"rgba(25, 118, 210, 0.3)":"rgba(0, 0, 0, 0.12)",borderRadius:"18px",m:"1px"},children:[e.jsx(rt,{title:Lt((s.sendTime||0)*1e3,"K:m aa"),placement:"top",arrow:!0,children:e.jsx(m,{sx:{wordBreak:"break-word"},children:s.message})}),n&&e.jsx(m,{sx:{height:"14px",fontWeight:400,lineHeight:"14px",fontSize:"10px",letterSpacing:"0.17px",color:"rgba(0, 0, 0, 0.38)"},children:"".concat(b("quoteDetail.message.sent")," ").concat(Qt(new Date((s.sendTime||0)*1e3),new Date,{addSuffix:!0}))})]})]})}function Zt({msg:s}){return e.jsx(m,{sx:{color:"rgba(0, 0, 0, 0.6)",textAlign:"center",height:"21px",mb:"5px"},children:"".concat(at((s==null?void 0:s.date)||0))})}function Jt({msgs:s,id:n,isB2BUser:a,email:b,status:C}){const{dispatch:j}=f.useContext(Ae),r=De().palette.primary.main,y=W(),d=f.useRef(null),i=f.useRef(0),[S,B]=f.useState([]),[I,q]=f.useState(0),[k,o]=f.useState(""),[t,p]=f.useState(!1),{quotesUpdateMessageActionsPermission:x}=Q(qe),P=a?x:!0,N=w=>{let E={};const $=[];let H=0;w.forEach((l,ce)=>{var Y,te,X,Z,re,se,ne,oe,J;ce===0?($.push({isCustomer:!((Y=l.role)!=null&&Y.includes("Sales rep:")),date:l==null?void 0:l.date,key:"".concat(l==null?void 0:l.date,"date")}),$.push({isCustomer:!((te=l.role)!=null&&te.includes("Sales rep:")),message:l.message,sendTime:l.date,role:l.role,key:l==null?void 0:l.date}),E=l,E.isCustomer=!((X=l.role)!=null&&X.includes("Sales rep:"))):(((l==null?void 0:l.date)||0)-((E==null?void 0:E.date)||0)>60*60&&$.push({isCustomer:!((Z=l.role)!=null&&Z.includes("Sales rep:")),date:l==null?void 0:l.date,key:"".concat(l==null?void 0:l.date,"date")}),E.isCustomer===!((re=l.role)!=null&&re.includes("Sales rep:"))?$.push({isCustomer:!((se=l.role)!=null&&se.includes("Sales rep:")),message:l.message,sendTime:l.date,key:l==null?void 0:l.date}):$.push({isCustomer:!((ne=l.role)!=null&&ne.includes("Sales rep:")),message:l.message,role:l.role,sendTime:l.date,key:l==null?void 0:l.date}),E=l,E.isCustomer=!((oe=l.role)!=null&&oe.includes("Sales rep:"))),(J=l.role)!=null&&J.includes("Sales rep:")&&!l.read&&(H+=1)}),q(H),B($)},L=f.useMemo(()=>e.jsxs(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:["".concat(y("quoteDetail.message.message")," "),I!==0&&e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"20px",height:"20px",borderRadius:"50%",background:r||"#1976D2",color:"#fff",fontSize:"12px",ml:"8px"},children:I})]}),[r,I]);f.useEffect(()=>{N(s)},[s]),f.useEffect(()=>{d.current&&S.length&&(d.current.scrollTop=d.current.scrollHeight)},[S]);const D=async w=>{try{const E=a?Te:ke;p(!0);const{quoteUpdate:{quote:{trackingHistory:$}}}=await E({id:Number(n),quoteData:{message:w,lastMessage:parseInt("".concat(new Date().getTime()/1e3),10),userEmail:b||"",storeHash:we}});o(""),q(0),N($)}finally{p(!1)}},z=w=>{w.key==="Enter"&&D(w.target.value||"")},F=f.useCallback(w=>{var E;if(w){if(!P&&a)return;const $=a?Te:ke;i.current===0&&s.length&&$({id:Number(n),quoteData:{lastMessage:(E=s[s.length-1])==null?void 0:E.date,userEmail:b||"",storeHash:we}}),q(0),d.current&&(d.current.scrollTop=d.current.scrollHeight),i.current+=1}},[b,n,a,s,P]);return f.useEffect(()=>{j({type:"common",payload:{quoteDetailHasNewMessages:I!==0}})},[I]),e.jsx(me,{children:e.jsx(ae,{sx:{p:"16px !important"},children:e.jsxs(Be,{handleOnChange:F,title:L,children:[e.jsxs(m,{sx:{padding:"16px 0"},children:[e.jsx(m,{sx:{position:"relative",color:"rgba(0, 0, 0, 0.6)",opacity:.6,textAlign:"left",width:"100%",fontSize:"14px"},children:y("quoteDetail.message.merchantAnswers")}),e.jsx(m,{ref:d,sx:{mt:"20px",maxHeight:"280px",overflowY:"auto","&::-webkit-scrollbar":{display:"none"}},children:S.map((w,E)=>e.jsxs(m,{children:[e.jsx(Xt,{msg:w,isEndMessage:E===S.length-1,isCustomer:!!w.isCustomer}),w.date&&e.jsx(Zt,{msg:w})]},w.key))})]}),C!==4&&P&&e.jsx(Re,{isSpinning:t,spinningHeight:50,size:10,isCloseLoading:!0,tip:"waiting..",children:e.jsxs(m,{sx:{display:"flex",width:"100%"},children:[e.jsx(tt,{onKeyDown:z,sx:{width:"100%","& .MuiFormLabel-root":{color:"rgba(0, 0, 0, 0.38)"},"& input":{padding:"1.5rem 0.7rem 0.5rem"}},value:k,onChange:w=>{o(w.target.value)},size:"small",label:y("quoteDetail.message.typeMessage"),variant:"filled"}),e.jsx(m,{onClick:()=>D(k),sx:{width:"42px",height:"36px",margin:"10px 0 0 10px",background:"#BAD6F2",borderRadius:"50%"},children:e.jsx(Fe,{sx:{height:"18px",width:"18px",margin:"8px 0 0 9px",color:"#0000008A"},fontSize:"small"})})]})})]})})})}const $e=async({role:s,proceedingCheckoutFn:n,location:a,quoteId:b,navigate:C})=>{try{if(Se.dispatch(Ne("")),n())return;const{storefrontProductSettings:{hidePriceFromGuests:h}}=await wt();if(h&&Number(s)===100&&C){Se.dispatch(Ne(a.pathname+a.search)),C("/login");return}const r=Number(s)===99?St:Nt,y=Le(a.search,"date"),d=await r({id:Number(b)});Bt(b,y);const{quoteCheckout:{quoteCheckout:{checkoutUrl:i,cartId:S}}}=d;if(it==="bigcommerce"){window.location.href=i;return}await Ft(S,i)}catch(j){Pt.error(j)}};function er(s){const{quoteId:n,role:a,isAgenting:b,status:C,proceedingCheckoutFn:j}=s,[h]=he(),r=W(),y=fe(),d=ge(),i=h?{alignItems:"flex-end",flexDirection:"column"}:{alignItems:"center"};return C!==5?e.jsx(m,{sx:{position:"fixed",bottom:h&&b?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:"0.8rem 1rem",height:"auto",display:"flex",zIndex:"999",justifyContent:h?"center":"flex-end",displayPrint:"none",...i},children:e.jsx(xe,{variant:"contained",onClick:()=>{$e({proceedingCheckoutFn:j,role:a,location:y,quoteId:n,navigate:d})},sx:{width:h?"100%":"auto"},children:r("quoteDetail.footer.proceedToCheckout")})}):null}const pe=ie("div")(()=>({display:"flex",alignItems:"center",marginTop:"0.5rem"}));function tr(s){const[n]=he(),a=W(),{status:b,quoteNumber:C,issuedAt:j,expirationDate:h,exportPdf:r,printQuote:y,role:d,salesRepInfo:i}=s,{state:{portalStyle:{backgroundColor:S="#FEF9F5"}}}=f.useContext(ct),B=lt(S),q=De().palette.primary.main,k=ge(),o=t=>n?{}:{xs:t};return e.jsxs(e.Fragment,{children:[Number(d)!==100&&e.jsx(m,{sx:{marginBottom:"10px",width:"fit-content",displayPrint:"none"},children:e.jsxs(m,{sx:{color:"#1976d2",cursor:"pointer",display:"flex",alignItems:"center"},onClick:()=>{k("/quotes")},children:[e.jsx(Mt,{fontSize:"small",sx:{fontSize:"12px",marginRight:"0.5rem",color:q}}),e.jsx("p",{style:{color:q,margin:"0"},children:a("quoteDetail.header.backToQuoteLists")})]})}),e.jsxs(O,{container:!0,spacing:2,sx:{display:"flex",justifyContent:"space-between",flexDirection:n?"column":"row",mb:n?"16px":""},children:[e.jsxs(O,{item:!0,...o(8),sx:{color:B},children:[e.jsxs(m,{sx:{display:"flex",alignItems:n?"start":"center",flexDirection:n?"column":"row"},children:[e.jsx(g,{sx:{marginRight:"10px",fontSize:"34px",color:ut(B,.87)},children:a("quoteDetail.header.quoteNumber",{quoteNumber:C||""})}),e.jsx(vt,{code:b})]}),((i==null?void 0:i.salesRepName)||(i==null?void 0:i.salesRepEmail))&&e.jsxs(pe,{children:[e.jsx(g,{variant:"subtitle2",sx:{marginRight:"0.5rem",fontSize:"16px"},children:a("quoteDetail.header.salesRep")}),e.jsx("span",{children:(i==null?void 0:i.salesRepEmail)!==""?"".concat(i==null?void 0:i.salesRepName,"(").concat(i==null?void 0:i.salesRepEmail,")"):i==null?void 0:i.salesRepName})]}),e.jsxs(m,{children:[e.jsxs(pe,{children:[e.jsx(g,{variant:"subtitle2",sx:{marginRight:"0.5rem",fontSize:"16px"},children:a("quoteDetail.header.issuedOn")}),e.jsx("span",{children:"".concat(j?ve(Number(j)):"")})]}),e.jsxs(pe,{children:[e.jsx(g,{variant:"subtitle2",sx:{marginRight:"0.5rem",fontSize:"16px"},children:a("quoteDetail.header.expirationDate")}),e.jsx("span",{children:"".concat(h?ve(Number(h)):"")})]})]})]}),Number(d)!==100&&e.jsx(O,{item:!0,sx:{textAlign:n?"none":"end",displayPrint:"none"},...o(4),children:e.jsxs(m,{children:[e.jsx(xe,{variant:"outlined",sx:{marginRight:"1rem",displayPrint:"none"},onClick:y,children:a("quoteDetail.header.print")}),e.jsx(xe,{variant:"outlined",onClick:r,children:a("quoteDetail.header.downloadPDF")})]})})]})]})}function rr({quoteSummary:{originalSubtotal:s,discount:n,tax:a,shipping:b,totalAmount:C},quoteDetailTax:j=0,status:h,quoteDetail:r,isHideQuoteCheckout:y}){const d=W(),i=Q(({storeConfigs:x})=>x.currencies.enteredInclusiveTax),S=Q(({global:x})=>x.showInclusiveTaxPrice),B=(x,P)=>i?S?x:x-P:S?x+P:x,I=x=>V(x,{currency:r.currency,isConversionRate:!1,useCurrentCurrency:!!r.currency}),k=(()=>{var x,P,N,L;return(x=r==null?void 0:r.shippingMethod)!=null&&x.id?{shippingText:"".concat(d("quoteDetail.summary.shipping"),"(").concat(((P=r==null?void 0:r.shippingMethod)==null?void 0:P.description)||"",")"),shippingVal:I(Number(b)),taxText:d("quoteDetail.summary.tax"),taxVal:I(Number(a))}:!(r!=null&&r.salesRepEmail)&&!((N=r==null?void 0:r.shippingMethod)!=null&&N.id)&&Number(h)===1?{shippingText:d("quoteDetail.summary.shipping"),shippingVal:d("quoteDetail.summary.tbd"),taxText:d("quoteDetail.summary.estimatedTax"),taxVal:I(Number(a))}:r!=null&&r.salesRepEmail&&!((L=r==null?void 0:r.shippingMethod)!=null&&L.id)&&(Number(h)===1||Number(h)===5)?{shippingText:"".concat(d("quoteDetail.summary.shipping"),"(").concat(d("quoteDetail.summary.quoteCheckout"),")"),shippingVal:d("quoteDetail.summary.tbd"),taxText:d("quoteDetail.summary.tax"),taxVal:d("quoteDetail.summary.tbd")}:null})(),o=x=>y?d("quoteDraft.quoteSummary.tbd"):x,t=Number(s),p=Number(s)-Number(n);return e.jsx(me,{children:e.jsx(ae,{children:e.jsxs(m,{children:[e.jsx(g,{variant:"h5",children:d("quoteDetail.summary.quoteSummary")}),e.jsxs(m,{sx:{marginTop:"20px",color:"#212121"},children:[(r==null?void 0:r.displayDiscount)&&e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(g,{children:d("quoteDetail.summary.originalSubtotal")}),e.jsx(g,{children:o(I(B(t,j)))})]}),!(r!=null&&r.salesRepEmail)&&Number(h)===1?null:e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0",display:r!=null&&r.displayDiscount?"":"none"},children:[e.jsx(g,{children:d("quoteDetail.summary.discountAmount")}),e.jsx(g,{children:Number(n)>0?"-".concat(I(Number(n))):I(Number(n))})]}),e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(g,{sx:{fontWeight:"bold",color:"#212121"},children:d("quoteDetail.summary.quotedSubtotal")}),e.jsx(g,{sx:{fontWeight:"bold",color:"#212121"},children:o(I(B(p,j)))})]}),k&&e.jsxs(e.Fragment,{children:[e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(g,{sx:{maxWidth:"70%",wordBreak:"break-word"},children:k.shippingText}),e.jsx(g,{children:o(k.shippingVal)})]}),e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(g,{children:k.taxText}),e.jsx(g,{children:o(k.taxVal)})]})]}),e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"24px 0 0"},children:[e.jsx(g,{sx:{fontWeight:"bold",color:"#212121"},children:d("quoteDetail.summary.grandTotal")}),e.jsx(g,{sx:{fontWeight:"bold",color:"#212121"},children:o(I(Number(C)))})]})]})]})})})}const sr=ie("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"}));function nr(s){const{item:n,len:a,itemIndex:b,getTaxRate:C,showPrice:j,currency:h,displayDiscount:r}=s,y=W(),d=Q(({storeConfigs:H})=>H.currencies.enteredInclusiveTax),{basePrice:i,quantity:S,imageUrl:B,productName:I,options:q,sku:k,notes:o,offeredPrice:t,productsSearch:{productUrl:p,variants:x=[],taxClassId:P}}=n,N=C(P,x),L=d?Number(i)*N/(1+N):Number(i)*N,D=d?Number(t)*N/(1+N):Number(t)*N,z=K(Number(i),L),F=K(Number(t),D),w=Number(i)-Number(t)>0&&r,E=Number(z)*Number(S),$=F*Number(S);return e.jsx(m,{width:"100%",sx:{borderTop:"1px solid #D9DCE9",borderBottom:b===a-1?"1px solid #D9DCE9":""},children:e.jsxs(ae,{sx:{color:"#313440",display:"flex",pl:0},children:[e.jsx(m,{children:e.jsx(sr,{src:B||Qe,alt:"Product-img",loading:"lazy"})}),e.jsxs(m,{sx:{flex:1},children:[e.jsx(g,{variant:"body1",color:"#212121",onClick:()=>{const{location:{origin:H}}=window;p&&(window.location.href="".concat(H).concat(p))},sx:{cursor:"pointer"},children:I}),e.jsx(g,{variant:"body1",color:"#616161",children:k}),e.jsx(m,{sx:{margin:"1rem 0"},children:q.length>0&&e.jsx(m,{children:q.map(H=>e.jsx(g,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(H.optionName,": ").concat(H.optionLabel)},H.optionName))})}),e.jsx(g,{variant:"body1",color:"#616161",children:o}),e.jsxs(g,{sx:{fontSize:"14px"},children:[y("quoteDetail.tableCard.price"),w&&e.jsx("span",{style:{marginLeft:"5px",textDecoration:"line-through"},children:"".concat(j(V(z,{currency:h}),n))}),e.jsx("span",{style:{marginLeft:"5px",color:w?"#2E7D32":"#212121"},children:"".concat(j(V(t,{currency:h}),n))})]}),e.jsx(g,{sx:{padding:"12px 0",fontSize:"14px"},children:y("quoteDetail.tableCard.qty",{quantity:S})}),e.jsxs(g,{sx:{fontSize:"14px"},children:[y("quoteDetail.tableCard.total"),w&&e.jsx("span",{style:{marginLeft:"5px",textDecoration:"line-through"},children:"".concat(j(V(E,{currency:h}),n))}),e.jsx("span",{style:{marginLeft:"5px",color:w?"#2E7D32":"#212121"},children:"".concat(j(V($,{currency:h}),n))})]})]})]})},n.id)}const or=ie("div")(()=>({backgroundColor:"#FFFFFF",padding:"1rem",width:"100%",border:"1px solid #E0E0E0",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px","& tbody":{"& tr":{"& td":{verticalAlign:"top"},"& td: first-of-type":{verticalAlign:"inherit"}},"& tr: hover":{"& #shoppingList-actionList":{opacity:1}}}})),ar=ie("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"}));function ir(s,n){const a=W(),{total:b,getQuoteTableDetails:C,getTaxRate:j,isHandleApprove:h,displayDiscount:r,currency:y}=s,d=Q(({global:o})=>o.blockPendingQuoteNonPurchasableOOS.isEnableProduct),i=Q(({storeConfigs:o})=>o.currencies.enteredInclusiveTax),S=f.useRef(null),[B,I]=f.useState({first:12,offset:0});f.useImperativeHandle(n,()=>({getList:()=>{var o;return(o=S.current)==null?void 0:o.getList()},refreshList:()=>{I({offset:0})}}));const q=(o,t)=>d?h?o:pt({price:o,productInfo:t,showText:a("quoteDraft.quoteSummary.tbd")}):o,k=[{key:"Product",title:a("quoteDetail.table.product"),render:o=>{var x;const t=o.options,p=(x=o.productsSearch)==null?void 0:x.productUrl;return e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start"},children:[e.jsx(ar,{src:o.imageUrl||Qe,alt:"Product-img",loading:"lazy"}),e.jsxs(m,{children:[e.jsx(g,{variant:"body1",color:"#212121",onClick:()=>{const{location:{origin:P}}=window;p&&(window.location.href="".concat(P).concat(p))},sx:{cursor:"pointer"},children:o.productName}),e.jsx(g,{variant:"body1",color:"#616161",children:o.sku}),t.length>0&&e.jsx(m,{children:t.map(P=>P.optionLabel&&e.jsx(g,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(P.optionName,": ").concat(P.optionLabel)},"".concat(P.optionName,"_").concat(P.optionLabel)))}),o.notes&&e.jsxs(g,{variant:"body1",color:"#ED6C02",sx:{fontSize:"0.9rem",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.jsx("span",{children:"Notes: "}),o.notes]})]})]})},width:"40%"},{key:"Price",title:a("quoteDetail.table.price"),render:o=>{const{basePrice:t,offeredPrice:p,productsSearch:{variants:x=[],taxClassId:P}}=o,N=j(P,x),L=i?Number(t)*N/(1+N):Number(t)*N,D=i?Number(p)*N/(1+N):Number(p)*N,z=K(Number(t),L),F=K(Number(p),D),w=Number(t)-Number(p)>0&&r;return e.jsxs(e.Fragment,{children:[w&&e.jsx(g,{sx:{padding:"12px 0 0 0",textDecoration:"line-through"},children:q(V(z,{currency:y,isConversionRate:!1,useCurrentCurrency:!!y}),o)}),e.jsx(g,{sx:{padding:w?"0":"12px 0 0 0",color:w?"#2E7D32":"#212121"},children:q(V(F,{currency:y,isConversionRate:!1,useCurrentCurrency:!!y}),o)})]})},width:"15%",style:{textAlign:"right"}},{key:"Qty",title:a("quoteDetail.table.qty"),render:o=>e.jsx(g,{sx:{padding:"12px 0"},children:o.quantity}),width:"15%",style:{textAlign:"right"}},{key:"Total",title:a("quoteDetail.table.total"),render:o=>{const{basePrice:t,quantity:p,offeredPrice:x,productsSearch:{variants:P=[],taxClassId:N}}=o,L=j(N,P),D=i?Number(t)*L/(1+L):Number(t)*L,z=i?Number(x)*L/(1+L):Number(x)*L,F=K(Number(t),D),w=K(Number(x),z),E=Number(t)-Number(x)>0&&r,$=F*Number(p),H=w*Number(p);return e.jsxs(m,{children:[E&&e.jsx(g,{sx:{padding:"12px 0 0 0",textDecoration:"line-through"},children:q(V($,{currency:y,isConversionRate:!1,useCurrentCurrency:!!y}),o)}),e.jsx(g,{sx:{padding:E?"0":"12px 0 0 0",color:E?"#2E7D32":"#212121"},children:q(V(H,{currency:y,isConversionRate:!1,useCurrentCurrency:!!y}),o)})]})},width:"20%",style:{textAlign:"right"}}];return e.jsxs(or,{children:[e.jsx(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"0.5rem 0 1rem 0"},children:e.jsx(g,{sx:{fontSize:"24px"},children:a("quoteDetail.table.totalProducts",{total:b||0})})}),e.jsx(dt,{ref:S,columnItems:k,rowsPerPageOptions:[12,24,36],getRequestList:C,isCustomRender:!1,hover:!0,searchParams:B,labelRowsPerPage:a("quoteDetail.table.perPage"),showBorder:!1,itemIsMobileSpacing:0,noDataText:a("quoteDetail.table.noProducts"),tableKey:"productId",renderItem:(o,t)=>e.jsx(nr,{len:b||0,item:o,showPrice:q,itemIndex:t,currency:y,displayDiscount:r,getTaxRate:j})})]})}const cr=f.forwardRef(ir);function lr(s){const{quoteLegalTerms:n=""}=s,[a,b]=f.useState(!1),C=W(),j=h=>{b(h)};return e.jsx(me,{sx:{".MuiCardContent-root":{maxHeight:a?"637px":"auto"}},children:e.jsx(ae,{sx:{p:"16px !important"},children:e.jsx(Be,{title:C("quoteDetail.termsAndConditions"),handleOnChange:j,children:e.jsx(m,{children:e.jsx(g,{variant:"body1",sx:{padding:"16px 0",maxHeight:"545px",whiteSpace:"pre-wrap",overflow:"auto"},children:n})})})})})}function ur(){const{id:s=""}=$t(),{state:{bcLanguage:n,quoteConfig:a}}=f.useContext(Ae),b=Q(({company:p})=>p.companyInfo.id),C=Q(({company:p})=>p.customer.emailAddress),j=Q(({company:p})=>p.customer.customerGroupId),h=Q(({company:p})=>p.customer.role),r=Q(ft),{selectCompanyHierarchyId:y}=Q(({company:p})=>p.companyHierarchyInfo),d=Q(({b2bFeatures:p})=>p.masqueradeCompany.isAgenting),{currency_code:i}=Q(gt),S=Q(({global:p})=>p.taxZoneRates),B=Q(({storeConfigs:p})=>p.currencies.enteredInclusiveTax),I=Q(({global:p})=>{var x;return(x=p.blockPendingQuoteNonPurchasableOOS)==null?void 0:x.isEnableProduct}),{purchasabilityPermission:q}=Q(qe),k=async p=>{if(p.length>0){const x=[];p.forEach(D=>{x.includes(D.productId)||x.push(D.productId)});const P={productIds:x,currencyCode:i,companyId:b,customerGroupId:j},{productsSearch:N}=await(r?yt(P):Ct(P)),L=jt(N);return p.forEach(D=>{const z=D,F=L.find(w=>{const{id:E}=w;return Number(D.productId)===Number(E)});z.productsSearch=F||{}}),p}},o=fe();return{id:s,bcLanguage:n,quoteConfig:a,role:h,emailAddress:C,isB2BUser:r,selectCompanyHierarchyId:y,isAgenting:d,taxZoneRates:S,enteredInclusiveTax:B,isEnableProduct:I,purchasabilityPermission:q,handleGetProductsById:k,getQuote:async()=>{const{search:p}=o,x=Le(p,"date")||"",P={id:Number(s),date:x.toString()},{quote:N}=await(Number(h)===99?Tt(P):kt(P));return N}}}function Dr(){const s=ge(),{id:n,bcLanguage:a,quoteConfig:b,role:C,emailAddress:j,isB2BUser:h,selectCompanyHierarchyId:r,isAgenting:y,taxZoneRates:d,enteredInclusiveTax:i,isEnableProduct:S,purchasabilityPermission:B,handleGetProductsById:I,getQuote:q}=ur(),[k]=he(),o=W(),[t,p]=f.useState({}),[x,P]=f.useState([]),[N,L]=f.useState([]),[D,z]=f.useState(!1),[F,w]=f.useState(!0),[E,$]=f.useState({originalSubtotal:0,discount:0,tax:0,shipping:0,totalAmount:0}),[H,l]=f.useState(!1),[ce,Y]=f.useState(!1),[te,X]=f.useState(0),[Z,re]=f.useState({oos:"",nonPurchasable:""}),[se,ne]=f.useState({quotePurchasabilityPermission:!1,quoteConvertToOrderPermission:!1}),[oe,J]=f.useState(!1),G=fe();f.useEffect(()=>{if(!(t!=null&&t.id))return;const{quoteConvertToOrderPermission:c}=xt,u=()=>{var A,R;if(h){const U=((A=t==null?void 0:t.companyId)==null?void 0:A.id)||null,ee=((R=t==null?void 0:t.contactInfo)==null?void 0:R.email)||"";return{quotePurchasabilityPermission:B,quoteConvertToOrderPermission:bt({code:c,companyId:U,userEmail:ee})}}return{quotePurchasabilityPermission:!0,quoteConvertToOrderPermission:!0}},{quotePurchasabilityPermission:v,quoteConvertToOrderPermission:T}=u();ne({quotePurchasabilityPermission:v,quoteConvertToOrderPermission:T})},[h,t,r,B]),f.useEffect(()=>{let c="",u="";x.forEach(T=>{const A=mt(T);A!=null&&A.type&&S&&!(T!=null&&T.purchaseHandled)&&(A.type==="oos"&&(c+="".concat(T.productName).concat(c?",":"")),A.type==="non-purchasable"&&(u+="".concat(T.productName).concat(u?",":"")))});const v=!!c||!!u;S&&D&&v&&(c&&_.error(o("quoteDetail.message.insufficientStock",{ProductName:c})),u&&_.error(o("quoteDetail.message.nonPurchasable",{ProductName:u}))),w(v),re({oos:c,nonPurchasable:u})},[S,D,x]);const le=f.useCallback(()=>{if(F){const{oos:c,nonPurchasable:u}=Z;c&&_.error(o("quoteDetail.message.insufficientStock",{ProductName:c})),u&&_.error(o("quoteDetail.message.nonPurchasable",{ProductName:u}))}return F},[F,Z]),ue=[];if(d!=null&&d.length){const c=d==null?void 0:d.find(u=>u.id===1);if(c){const{rates:u=[]}=c;u[0]&&u[0].enabled&&u[0].classRates.length&&u[0].classRates.forEach(v=>ue.push(v))}}const ye=(c,u)=>{var v;if(u.length){const T=Ee(u,"[0].bc_calculated_price.tax_exclusive",0),A=Ee(u,"[0].bc_calculated_price.tax_inclusive",0);return T>0?(A-T)/T:0}return ue.length?(((v=ue.find(T=>T.taxClassId===c))==null?void 0:v.rate)||0)/100:0},Me=async c=>{const u=await Rt(),v=[];return u.length&&u.forEach(T=>{const A=T,R=c.find(U=>U.fieldName===A.name);v.push({fieldName:A.name||"",fieldValue:(R==null?void 0:R.fieldValue)||A.default})}),v},He=async()=>{l(!0),Y(!1);try{const c=await q(),u=await I(c.productsList).catch(M=>{_.error(M)}),v=await Me(c.extraFields);if(p({...c,extraFields:v}),$({originalSubtotal:c.subtotal,discount:c.discount,tax:c.taxTotal,shipping:c.shippingTotal,totalAmount:c.totalAmount}),P(u),Number(c.shippingTotal)===0)X(Number(c.taxTotal));else{let M=0;u==null||u.forEach(Xe=>{const{quantity:je,offeredPrice:Pe,productsSearch:{variants:Ze=[],taxClassId:Je}}=Xe,de=ye(Je,Ze);M+=i?Number(Pe)*de/(1+de)*Number(je):Number(Pe)*de*Number(je)}),X(M)}const{backendAttachFiles:T=[],storefrontAttachFiles:A=[],salesRep:R,salesRepEmail:U}=c;z(!!R||!!U);const ee=[];return A.forEach(M=>{ee.push({fileName:M.fileName,fileType:M.fileType,fileUrl:M.fileUrl,id:M.id,hasDelete:t.status!==4,title:o("quoteDetail.uploadedByCustomer",{createdBy:M.createdBy})})}),T.forEach(M=>{ee.push({fileName:M.fileName,fileType:M.fileType,fileUrl:M.fileUrl,id:M.id,title:o("quoteDetail.uploadedBySalesRep",{createdBy:M.createdBy})})}),L(ee),c}catch(c){throw _.error(c),c}finally{l(!1),Y(!0)}},Ce=async c=>{l(!0);const{id:u,createdAt:v}=t;try{const T={quoteId:Number(u),createdAt:v,isPreview:c,lang:a},R=await(Number(C)===99?Et:It)(T);if(R)return{url:R.quoteFrontendPdf.url,content:R.quoteFrontendPdf.content}}catch(T){_.error(T)}return{url:"",content:""}},ze=async()=>{try{const{url:c}=await Ce(!1);c&&window.open("".concat(c),"_blank")}catch(c){_.error(c)}finally{l(!1)}},Ue=async()=>{var c,u,v,T,A;try{const{content:R}=await Ce(!0),U=document.createElement("iframe");U.setAttribute("style","display:none;"),(c=document.getElementById("bundle-container"))==null||c.appendChild(U),(u=U.contentDocument)==null||u.open(),(v=U.contentDocument)==null||v.write(R),(T=U.contentDocument)==null||T.close(),l(!1),(A=U.contentWindow)==null||A.print()}catch(R){_.error(R)}},Oe=async c=>{let u=x;if(u.length===0){const R=await He();u=(R==null?void 0:R.productsList)||[]}const v=Number(c.offset),T=Number(c.first)+v;return u.length?{edges:u.slice(v,T),totalCount:u.length}:{edges:[],totalCount:0}};f.useEffect(()=>{const{state:c}=G;if(!c)return;const u=()=>e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(m,{sx:{mr:"15px"},children:Number(C)===100?o("quoteDetail.submittedQuote"):o("quoteDetail.quoteSubmitted")}),e.jsx(st,{onClick:()=>{Number(C)===100?(Wt(window.location.href),_.success(o("quoteDetail.copySuccessful"))):s("/quotes")},variant:"text",sx:{color:"#ffffff",textAlign:"left",padding:0},children:Number(C)===100?o("quoteDetail.copyQuoteLink"):o("quoteDetail.reviewAllQuotes")})]});setTimeout(()=>{_.success("",{jsx:()=>u(),isClose:!0,duration:3e4})},10),G.state=null},[G,s,C]);const _e=async()=>{try{J(!0),await $e({quoteId:n,proceedingCheckoutFn:le,role:C,location:G,navigate:s})}finally{J(!1)}};f.useEffect(()=>{G.search.includes("isCheckout")&&n&&_e()},[n,G,le]);const Ve=f.useMemo(()=>{var u;return!(!(((u=b.find(v=>v.key==="quote_auto_quoting"))==null?void 0:u.value)==="1")&&!D)},[b,D]),We=()=>S?!!(D&&F||!F):!0,Ge=f.useMemo(()=>{var u;const c=(u=t==null?void 0:t.extraFields)==null?void 0:u.map(v=>({fieldName:v.fieldName,value:v.fieldValue}));return{info:{quoteTitle:(t==null?void 0:t.quoteTitle)||"",referenceNumber:(t==null?void 0:t.referenceNumber)||""},extraFields:c||[],recipients:(t==null?void 0:t.recipients)||[]}},[t]);ht(!1);const{quotePurchasabilityPermission:Ke,quoteConvertToOrderPermission:Ye}=se;return e.jsx(Re,{isSpinning:H||oe,children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column",flex:1},children:[e.jsx(tr,{status:t.status,quoteNumber:t.quoteNumber,issuedAt:t.createdAt,expirationDate:t.expiredAt,exportPdf:ze,printQuote:Ue,role:C,salesRepInfo:t.salesRepInfo}),e.jsx(m,{sx:{marginTop:"1rem"},children:e.jsx(Dt,{quoteAndExtraFieldsInfo:Ge,contactInfo:t.contactInfo,shippingAddress:t.shippingAddress,billingAddress:t.billingAddress})}),e.jsxs(O,{container:!0,spacing:k?2:0,rowSpacing:0,sx:{overflow:"auto",flexWrap:k?"wrap":"nowrap",paddingBottom:"20px",marginBottom:k?"6rem":0,marginTop:k?0:"1rem","@media print":{overflow:"hidden"}},children:[e.jsx(O,{item:!0,xs:k?12:8,rowSpacing:0,sx:k?{flexBasis:"100%",pl:"16px"}:{mr:"16px"},children:e.jsx(m,{sx:k?{flexBasis:"100%"}:{},children:e.jsx(cr,{total:x.length,currency:t.currency,isHandleApprove:D,getQuoteTableDetails:Oe,getTaxRate:ye,displayDiscount:t.displayDiscount})})}),e.jsxs(O,{item:!0,xs:k?12:4,rowSpacing:0,sx:k?{flexBasis:"100%"}:{pl:0},children:[e.jsx(m,{sx:{marginBottom:"1rem"},children:e.jsx(rr,{isHideQuoteCheckout:F,quoteSummary:E,quoteDetailTax:te,status:t.status,quoteDetail:t})}),t.notes&&e.jsx(m,{sx:{marginBottom:"1rem",displayPrint:"none"},children:e.jsx(At,{quoteNotes:t.notes})}),e.jsx(m,{sx:{marginBottom:"1rem",displayPrint:"none"},children:e.jsx(Jt,{id:n,status:t.status,isB2BUser:h,email:j||"",msgs:(t==null?void 0:t.trackingHistory)||[]})}),e.jsx(m,{sx:{marginBottom:"1rem",displayPrint:"none"},children:e.jsx(qt,{allowUpload:Number(t.status)!==4,quoteId:t.id,status:t.status,defaultFileList:N})}),t.legalTerms&&e.jsx(m,{sx:{displayPrint:"none"},children:e.jsx(lr,{quoteLegalTerms:t.legalTerms})})]})]}),Ye&&Ke&&Number(t.status)!==4&&ce&&(t==null?void 0:t.allowCheckout)&&Ve&&We()&&e.jsx(er,{quoteId:t.id,role:C,isAgenting:y,status:t.status,proceedingCheckoutFn:le})]})})}export{Dr as default};
//# sourceMappingURL=index--NoG1aA4.js.map
