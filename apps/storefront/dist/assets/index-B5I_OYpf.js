import{j as t,B as g,ae as Et,s as yt,T as z,f as Qt,ac as Zt,G as at,X as te,Y as ee,d as re,L as se,ah as Tt,a0 as ne}from"./mui-Cw0dwOiN.js";import{r as q}from"./reactVendor-BTcQ-GDs.js";import"./load-functions-DL5N0fkL.js";import{a5 as Vt,B as Dt,aN as qt,aw as At,au as Ft,u as K,t as wt,a as kt,aY as _t,ac as St,ak as oe,aZ as ie,a_ as It,a$ as Ct,b0 as Mt,af as k,b1 as ae,G as ce,a0 as Rt,ad as gt,aS as jt,a1 as Lt,b2 as de,b3 as ue,b4 as le,b5 as pe,b6 as he,aO as fe,aP as me,b7 as xe,aQ as ge,aR as ye,b8 as ke}from"./react-setup-DSYWb28G.js";import{u as mt}from"./lang-6J3-0YIA.js";import{b as vt}from"./base-BCVDEF8S.js";import{b as $t}from"./b2bGetVariantImageByVariantInfo-BskJ2qQo.js";import{d as lt,B as Pe,a as be}from"./B3FilterMore-CgQ4nWa9.js";import{e as Se}from"./lodashEs-DKEtmQJE.js";import{u as Ie}from"./useSort-CwDaxthI.js";import{B as Ce}from"./B3FilterSearch-D1P6QGaK.js";import{s as pt}from"./B3LinkTipContent-DnqeZwRf.js";import{b as Ot}from"./b3TriggerCartNumber-6ZWpUTGT.js";import je from"./CreateShoppingList-DGdQuhPc.js";import Le from"./OrderShoppingList-BGbqjbi-.js";import{u as ve}from"./router-DEI8QtBD.js";import{d as Oe}from"./muiIcon-BiFRwRtm.js";import{S as qe,d as Ae}from"./SearchProduct-DxNYlEbL.js";import{u as zt}from"./useBlockPendingAccountViewPrice-DHifFlSn.js";import{u as we}from"./form-hNmOEDBo.js";import{B as Te}from"./B3CustomForm-B8D1YiOY.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"../index.hStmN1DJ.js";import"./global-D7Yn0gGb.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"./dateFns-CeqDayOU.js";import"./dropzone-Cizh2goU.js";import"./useB2BCallback-DOyIFx1A.js";import"./b3ShoppingList-DdH6MiKu.js";const Ut=(h,n,C)=>{const{global:{showInclusiveTaxPrice:a}}=Vt.getState(),f=h.find(b=>Number(b.variant_id)===n||C===b.sku);if(f&&!Se(f)){const b=f.bc_calculated_price;return Number(a?b.tax_inclusive:b.tax_exclusive)}return!1},Gt=h=>'{\n  orderedProducts (\n    q: "'.concat(h.q||"",'"\n    first: ').concat(h.first,"\n    offset: ").concat(h.offset,'\n    beginDateAt: "').concat(h.beginDateAt,'"\n    endDateAt: "').concat(h.endDateAt,'"\n    orderBy: "').concat((h==null?void 0:h.orderBy)||"",'"\n  ){\n    totalCount,\n    pageInfo{\n      hasNextPage,\n      hasPreviousPage,\n    },\n    edges{\n      node {\n        id,\n        createdAt,\n        updatedAt,\n        productName,\n        productBrandName,\n        variantSku,\n        productId,\n        variantId,\n        optionList,\n        orderedTimes,\n        firstOrderedAt,\n        lastOrderedAt,\n        lastOrderedItems,\n        sku,\n        lastOrdered,\n        imageUrl,\n        baseSku,\n        basePrice,\n        discount,\n        tax,\n        enteredInclusive,\n        productUrl,\n        optionSelections,\n      }\n    }\n  }\n}'),Ne=h=>Dt.graphqlB2B({query:Gt(h)}),Be=h=>Dt.graphqlB2B({query:Gt(h)}),Ee=yt("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"}));function Qe(h){const{item:n,checkBox:C,handleUpdateProductQty:a}=h,f=mt(),{quantity:b,imageUrl:p,productName:i,variantSku:S,optionList:N,basePrice:Z,lastOrderedAt:H,variantId:U,productsSearch:m}=n,B=Number(Z)*Number(b),I=m.variants||[],Y=$t(I,{variantId:U})||p;return t.jsx(g,{sx:{borderTop:"1px solid #D9DCE9"},children:t.jsxs(Et,{sx:{color:"#313440",display:"flex",pl:0},children:[t.jsx(g,{children:C&&C()}),t.jsx(g,{children:t.jsx(Ee,{src:Y||qt,alt:"Product-img",loading:"lazy"})}),t.jsxs(g,{sx:{flex:1},children:[t.jsx(z,{variant:"body1",color:"#212121",children:i}),t.jsx(z,{variant:"body1",color:"#616161",children:S}),t.jsx(g,{sx:{margin:"1rem 0"},children:N.length>0&&t.jsx(g,{children:N.map(M=>t.jsx(z,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(M.display_name,": ").concat(M.display_value)},M.display_name))})}),t.jsx(z,{sx:{fontSize:"14px"},children:f("purchasedProducts.quickOrderCard.price",{price:At(B)})}),t.jsx(g,{sx:{"& label":{zIndex:0}},children:t.jsx(Qt,{size:"small",type:"number",variant:"filled",label:"Qty",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:b,sx:{margin:"1rem 0",width:"60%",maxWidth:"100px","& label":{fontSize:"14px"},"& input":{fontSize:"14px"}},onChange:M=>{a(n.id,M.target.value)}})}),t.jsx(z,{sx:{fontSize:"14px"},children:f("purchasedProducts.quickOrderCard.lastOrdered",{lastOrderedAt:Ft(H)})})]})]})},n.id)}const Ve=yt("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"})),De=yt(g)(()=>({display:"flex",flexDirection:"column",width:"100%","& tbody":{"& tr":{"& td":{verticalAlign:"top"},"& td: first-of-type":{paddingTop:"25px"}}}})),Fe=yt(Qt)(()=>({"& input":{paddingTop:"12px",paddingRight:"6px"}})),Nt="lastOrderedAt",Bt={product:"productName",lastOrderedAt:"lastOrderedAt"};function _e({setIsRequestLoading:h,setCheckedArr:n,isRequestLoading:C}){const a=q.useRef(null),f=K(wt),b=K(({company:r})=>r.companyInfo.id),p=K(({company:r})=>r.customer.customerGroupId),[i,S]=q.useState({q:"",beginDateAt:lt(90),endDateAt:lt(0),orderBy:"-".concat(Bt[Nt])}),[N,Z,H]=Ie(Bt,Nt,i,S),[U,m]=q.useState(0),[B]=kt(),I=mt(),{currency_code:Y}=K(_t),M=async r=>{if(r.length>0){const o=[];r.forEach(x=>{const{node:e}=x;e.quantity=1,o.includes(e.productId)||o.push(e.productId)});const c=f?It:Ct;try{const{productsSearch:x}=await c({productIds:o,currencyCode:Y,companyId:b,customerGroupId:p}),e=Mt(x);return r.forEach(d=>{const{node:u}=d,l=e.find(P=>{const{id:j}=P;return Number(u.productId)===Number(j)});u.productsSearch=l||{}}),r}catch(x){k.error(x)}}return[]},rt=async r=>{const{orderedProducts:{edges:o,totalCount:c}}=f?await Ne(r):await Be(r),x=await M(o);return m(c),{edges:x,totalCount:c}},ct=async r=>{S({...i,q:r})},tt=r=>{var o;if(r.length>0){const c=((o=a.current)==null?void 0:o.getCacheList())||[],x=r.reduce((e,d)=>{const u=c.find(l=>{const{node:P}=l;return P.id===d});return u&&e.push(u),e},[]);n([...x])}else n([])},st=(r,o)=>{const c={...i};r==="start"?c.beginDateAt=o||lt(90):c.endDateAt=o||lt(0),S(c)},y=r=>{const o={...i};o.beginDateAt=r.startValue,o.endDateAt=r.endValue,S(o)},A=(r,o)=>{var u,l,P,j;if(o!==""&&Number(o)<=0)return;const c=((u=a.current)==null?void 0:u.getList())||[],x=((l=a.current)==null?void 0:l.getCacheList())||[],e=c==null?void 0:c.map(v=>{const{node:L}=v;return(L==null?void 0:L.id)===r&&(L.quantity=Number(o)||""),v}),d=x==null?void 0:x.map(v=>{const{node:L}=v;return(L==null?void 0:L.id)===r&&(L.quantity=Number(o)||""),v});(P=a.current)==null||P.setList([...e]),(j=a.current)==null||j.setCacheAllList([...d])},G=(r,o)=>{const{productsSearch:{isPriceHidden:c}}=o;return c?"":ie({price:r,productInfo:o,showText:c?"":r,forcedSkip:!0})},D=r=>{var x;const o=((x=a.current)==null?void 0:x.getCacheList())||[];let c=r.quantity;if(o.length>0){const e=o.find(d=>d.node.variantId===r.variantId&&d.node.productId===r.productId&&d.node.id===r.id);e&&e.node&&(c=e.node.quantity||c)}return c},W=[{key:"product",title:I("purchasedProducts.product"),render:r=>{const{optionList:o,productsSearch:c,variantId:x}=r,e=c.variants||[],d=$t(e,{variantId:x})||r.imageUrl;return t.jsxs(g,{sx:{display:"flex",alignItems:"flex-start"},children:[t.jsx(Ve,{src:d||qt,alt:"Product-img",loading:"lazy"}),t.jsxs(g,{children:[t.jsx(z,{variant:"body1",color:"#212121",children:r.productName}),t.jsx(z,{variant:"body1",color:"#616161",children:r.variantSku}),o.length>0&&t.jsx(g,{children:o.map(u=>t.jsx(z,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(u.display_name,": ").concat(u.display_value)},u.id))})]})]})},width:"40%",isSortable:!0},{key:"price",title:I("purchasedProducts.price"),render:r=>{const{productsSearch:{variants:o},variantId:c,basePrice:x}=r;let e=Number(x);o!=null&&o.length&&(e=Ut(o,Number(c))||Number(x));const d=D(r),l=(e||Number(x))*Number(d);return t.jsx(z,{sx:{padding:"12px 0"},children:"".concat(G(At(l),r))})},width:"15%",style:{textAlign:"right"}},{key:"qty",title:I("purchasedProducts.qty"),render:r=>{const o=D(r);return t.jsx(Fe,{size:"small",type:"number",variant:"filled",value:o,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},onChange:c=>{A(r.id,c.target.value)}})},width:"15%",style:{textAlign:"right"}},{key:"lastOrderedAt",title:I("purchasedProducts.lastOrdered"),render:r=>t.jsx(g,{children:t.jsx(z,{sx:{padding:"12px 0"},children:"".concat(Ft(Number(r.lastOrderedAt)))})}),width:"15%",style:{textAlign:"right"},isSortable:!0}];return t.jsx(St,{isSpinning:C,children:t.jsxs(De,{children:[t.jsx(z,{sx:{fontSize:"24px",height:"50px"},children:I("purchasedProducts.totalProducts",{total:U})}),t.jsxs(g,{sx:{marginBottom:"5px",display:"flex","& label":{zIndex:0}},children:[t.jsxs(g,{sx:{width:B?"100%":"40%",mr:"20px",display:"flex",justifyContent:B?"space-between":"flex-start"},children:[t.jsx(Ce,{h:"48px",searchBGColor:"rgba(0, 0, 0, 0.06)",handleChange:r=>{ct(r)}}),B&&t.jsx(g,{sx:{display:"flex",alignItems:"center"},children:t.jsx(Pe,{filterMoreInfo:[],startPicker:{isEnabled:!0,label:I("purchasedProducts.from"),defaultValue:(i==null?void 0:i.beginDateAt)||"",pickerKey:"start"},endPicker:{isEnabled:!0,label:I("purchasedProducts.to"),defaultValue:(i==null?void 0:i.endDateAt)||"",pickerKey:"end"},isShowMore:!0,onChange:y})})]}),!B&&t.jsx(be,{handleChange:st,xs:{mt:0,height:"50px"},startPicker:{isEnabled:!0,label:I("purchasedProducts.from"),defaultValue:lt(90),pickerKey:"start"},endPicker:{isEnabled:!0,label:I("purchasedProducts.to"),defaultValue:lt(),pickerKey:"end"},customWidth:"58%"})]}),t.jsx(oe,{ref:a,columnItems:W,rowsPerPageOptions:[12,24,36],getRequestList:rt,searchParams:i,isCustomRender:!1,showCheckbox:!0,showSelectAllCheckbox:!0,disableCheckbox:!1,hover:!0,labelRowsPerPage:I("purchasedProducts.itemsPerPage"),showBorder:!1,requestLoading:h,getSelectCheckbox:tt,itemIsMobileSpacing:0,isSelectOtherPageCheckbox:!0,noDataText:I("purchasedProducts.noProductsFound"),sortDirection:Z,orderBy:H,sortByFn:N,renderItem:(r,o,c)=>t.jsx(Qe,{item:r,checkBox:c,handleUpdateProductQty:A})})]})})}const Me=(h,n)=>{var Y,M;const{variantId:C,variants:a,inventoryLevel:f,inventoryTracking:b,orderQuantityMaximum:p,orderQuantityMinimum:i,quantity:S,sku:N}=h,Z=((M=(Y=Vt.getState().global)==null?void 0:Y.blockPendingQuoteNonPurchasableOOS)==null?void 0:M.isEnableProduct)||!1,H=b!=="none";let U=!1,m=f,B=N;const I=a.find(rt=>Number(rt.variant_id)===Number(C));return I&&(U=I.purchasing_disabled,m=b==="variant"?I.inventory_level:m,B=I.sku||N),U&&!Z?(k.error(n("purchasedProducts.quickOrderPad.notPurchaseableSku",{notPurchaseSku:B})),{isVerify:!1,type:"notPurchaseableSku"}):H&&Number(S)>Number(m)?(k.error(n("purchasedProducts.quickOrderPad.insufficientStockSku",{sku:B}),{isClose:!0}),{isVerify:!1,type:"insufficientStockSku"}):Number(i)>0&&Number(S)<i?(k.error(n("purchasedProducts.quickOrderPad.minQuantityMessage",{minQuantity:i,sku:B}),{isClose:!0}),{isVerify:!1,type:"minQuantity"}):Number(p)>0&&Number(S)>Number(p)?(k.error(n("purchasedProducts.quickOrderPad.maxQuantityMessage",{maxQuantity:p,sku:B}),{isClose:!0}),{isVerify:!1,type:"maxQuantity"}):{isVerify:!0}},Wt=async()=>{const{data:{site:{cart:h}}}=await ae();if(h){const{lineItems:n}=h;return Object.keys(n).reduce((C,a)=>(n[a].forEach(f=>{C.push(f)}),C),[])}return[]},Kt=async(h,n)=>{const C=await Wt();return h.reduce((f,b)=>{var S;const{node:p}=b,i=((S=C.find(N=>N.sku===(p==null?void 0:p.sku)&&Number((N==null?void 0:N.variantEntityId)||0)===Number((p==null?void 0:p.variantId)||0)))==null?void 0:S.quantity)||0;return f.push({...p==null?void 0:p.productsSearch,variantId:p==null?void 0:p.variantId,quantity:((p==null?void 0:p.quantity)||0)+i}),f},[]).every(f=>Me(f,n).isVerify)};function Re(h){const{checkedArr:n,isAgenting:C,setIsRequestLoading:a,isB2BUser:f}=h,{state:{productQuoteEnabled:b=!1,shoppingListEnabled:p=!1}}=q.useContext(ce),i=mt(),S=K(s=>s.company.companyInfo.id),{currency_code:N}=K(_t),{purchasabilityPermission:Z}=K(Rt),H=f?Z:!0,U=Zt("(min-width:1775px)"),[m]=kt(),B=q.useRef(null),[I,Y]=q.useState(!1),[M,rt]=q.useState(0),[ct,tt]=q.useState(!1),[st,y]=q.useState(!1),[A,G]=q.useState(!1),D=K(s=>s.company.customer.customerGroupId),W=ve(),r=m?{alignItems:"flex-start",flexDirection:"column"}:{alignItems:"center"},o=()=>{n.length===0?k.error(i("purchasedProducts.error.selectOneItem")):Y(!0)},c=()=>{Y(!1)},x=s=>{const w=[];return n.forEach(T=>{const{node:E}=T,V=s.find(Q=>Number(E.productId)===Q.id);if(V){const{variants:Q}=V;if(Q.length>0){const O=Q.find(_=>E.variantSku===_.sku&&Number(E.variantId)===Number(_.variant_id));if(O){const{optionList:_,quantity:et}=E,nt=_.map($=>({optionId:$.product_option_id,optionValue:$.value}));w.push({optionSelections:nt,allOptions:_,productId:parseInt(O.product_id,10)||0,quantity:et,variantId:parseInt(O.variant_id,10)||0})}}}}),w},e=async()=>{a(!0),c();try{const s=[];if(n.forEach(_=>{const{node:et}=_;s.includes(Number(et.productId))||s.push(Number(et.productId))}),s.length===0){k.error(i("purchasedProducts.footer.selectOneItemToAdd"));return}if(!await Kt(n,i))return;const T=S,E=f?It:Ct,{productsSearch:V}=await E({productIds:s,companyId:T,customerGroupId:D}),Q=x(V||[]),O=await jt(Q);O&&!O.errors?k.success("",{jsx:pt({message:i("purchasedProducts.footer.productsAdded"),link:Lt,linkText:i("purchasedProducts.footer.viewCart"),isOutLink:!0,isCustomEvent:!0}),isClose:!0}):O&&O.errors?k.error(O.errors[0].message,{isClose:!0}):k.error("Error has occurred",{isClose:!0})}finally{Ot(),a(!1)}},d=s=>(s==null?void 0:s.length)===0?[]:s.map(({product_option_id:T,value:E})=>({optionId:"attribute[".concat(T,"]"),optionValue:E})),u=async()=>{a(!0),c();try{const s=n.filter($=>{const{node:{variantSku:F}}=$;return F!==""&&F!==null&&F!==void 0}),w=n.filter($=>{const{node:{variantSku:F}}=$;return!F});if(w.length>0&&k.error(i("purchasedProducts.footer.cantAddProductsNoSku"),{isClose:!0}),w.length===n.length)return;const T=[];s.forEach($=>{const{node:F}=$;T.includes(Number(F.productId))||T.push(Number(F.productId))});const E=f?It:Ct,{productsSearch:V}=await E({productIds:T,companyId:S,customerGroupId:D,currencyCode:N}),Q=Mt(V);let O=!1,_="",et=!0;const nt=[];if(s.forEach($=>{const{node:{basePrice:F,optionList:Pt,variantSku:ut,productId:J,productName:ht,quantity:ft,variantId:Ht,tax:Yt}}=$,Jt=d(Pt),xt=Q.find(bt=>Number(bt.id)===Number(J)),dt=xt==null?void 0:xt.variants.find(bt=>bt.sku===ut);dt||(_=i("purchasedProducts.footer.notFoundSku",{sku:ut}),et=!1);const Xt={node:{id:de(),variantSku:(dt==null?void 0:dt.sku)||ut,variantId:Ht,productsSearch:xt,primaryImage:(dt==null?void 0:dt.image_url)||qt,productName:ht,quantity:Number(ft)||1,optionList:JSON.stringify(Jt),productId:J,basePrice:F,tax:Yt}};nt.push(Xt),O=!0}),O=ue(nt),!et){k.error("",{jsx:pt({message:_,link:"",linkText:"",isOutLink:!1}),isClose:!0});return}O?(await le(nt,"2"),pe(nt),k.success("",{jsx:pt({message:i("purchasedProducts.footer.productsAddedToQuote"),link:"/quoteDraft",linkText:i("purchasedProducts.footer.viewQuote"),isOutLink:!1}),isClose:!0})):k.error("",{jsx:pt({message:i("purchasedProducts.footer.productsLimit"),link:"/quoteDraft",linkText:i("purchasedProducts.footer.viewQuote"),isOutLink:!1}),isClose:!0})}catch(s){vt.error(s)}finally{a(!1)}},l=s=>{W("/shoppingList/".concat(s))},P=s=>t.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(g,{sx:{mr:"15px"},children:i("purchasedProducts.footer.productsAddedToShoppingList")}),t.jsx(re,{onClick:()=>l(s),variant:"text",sx:{color:"#ffffff",padding:0},children:"view shopping list"})]}),j=s=>{tt(!1),y(!1)},v=()=>{tt(!1),y(!0)},L=()=>{y(!1),tt(!0)},ot=()=>{c(),L(),tt(!0)},it=async s=>{G(!0);try{const w=[];n.forEach(V=>{const{node:Q}=V;w.includes(Number(Q.productId))||w.push(Number(Q.productId))});const T=[];n.forEach(V=>{const{node:{optionList:Q,productId:O,quantity:_,variantId:et,productsSearch:nt}}=V,$=d(Q),F=he($,nt);T.push({productId:Number(O),variantId:Number(et),quantity:Number(_),optionList:F})}),await(f?fe:me)({shoppingListId:Number(s),items:T}),k.success(i("purchasedProducts.footer.productsAddedToShoppingList"),{jsx:()=>P(s),isClose:!0}),j(!0)}catch(w){vt.error(w)}finally{G(!1)}},R=[{name:i("purchasedProducts.footer.addToCart"),key:"add-selected-to-cart",handleClick:e,isDisabled:!H},{name:i("purchasedProducts.footer.addToQuote"),key:"add-selected-to-quote",handleClick:u,isDisabled:!b},{name:i("purchasedProducts.footer.addSelectedProductsToShoppingList"),key:"add-selected-to-shoppingList",handleClick:ot,isDisabled:!p}];q.useEffect(()=>{if(n.length>0){let s=0;n.forEach(w=>{const{node:{variantId:T,productsSearch:{variants:E},quantity:V,basePrice:Q}}=w;if(E!=null&&E.length){const O=Ut(E,Number(T))||Number(Q||0);s+=O*Number(V)}else s+=Number(Q||0)*Number(V)}),rt(1e3*s/1e3)}else rt(0)},[n]);let X={display:m?"initial":"flex",flexBasis:"100%"};return U&&(X={display:"flex",flexGrow:1,maxWidth:1775,margin:"auto"}),t.jsxs(t.Fragment,{children:[H||b||p?t.jsx(at,{sx:{position:"fixed",bottom:m&&C?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:m?"0 0 1rem 0":"16px 0 16px",height:m?"8rem":"auto",marginLeft:0,display:"flex",flexWrap:"nowrap",zIndex:"1000"},container:!0,spacing:2,children:t.jsxs(at,{item:m,sx:X,children:[t.jsx(g,{sx:{width:263,display:m?"none":"block"}}),t.jsxs(g,{sx:{flex:1,display:"flex",alignItems:"center",paddingLeft:m?0:"50px",paddingRight:m?0:"80px"},children:[t.jsxs(g,{sx:{width:m?"100%":"calc(66.6667% + 32px)",display:"flex",zIndex:"999",justifyContent:"space-between",...r},children:[t.jsx(z,{sx:{color:"#000000",fontSize:"16px",fontWeight:"400"},children:i("purchasedProducts.footer.selectedProducts",{quantity:n.length})}),t.jsxs(g,{sx:{display:"flex",alignItems:"center",flexWrap:m?"wrap":"nowrap",width:m?"100%":"auto"},children:[t.jsx(z,{variant:"h6",sx:{fontSize:"16px",fontWeight:"700",color:"#000000"},children:i("purchasedProducts.footer.subtotal",{subtotal:At(M)})}),t.jsxs(g,{sx:{display:"flex",alignItems:"center",marginTop:m?"0.5rem":0,marginLeft:m?0:"20px",width:m?"100%":"auto"},children:[t.jsx(gt,{variant:"contained",ref:B,onClick:o,sx:{marginRight:m?"1rem":0,width:m?"100%":"auto"},endIcon:t.jsx(Oe,{}),children:i("purchasedProducts.footer.addSelectedTo")}),t.jsx(te,{id:"basic-menu",anchorEl:B.current,open:I,onClose:c,MenuListProps:{"aria-labelledby":"basic-button"},children:R.length>0&&R.map(s=>s.isDisabled?null:t.jsx(ee,{onClick:()=>{s.handleClick()},children:s.name},s.key))})]})]})]}),t.jsx(g,{sx:{width:"33.3333%",display:m?"none":"block"}})]})]})}):null,t.jsx(Le,{isOpen:ct,dialogTitle:i("purchasedProducts.footer.addToShoppingList"),onClose:j,onConfirm:it,onCreate:v,isLoading:A,setLoading:G}),t.jsx(je,{open:st,onChange:ot,onClose:L})]})}function $e(h){const n=mt(),{updateList:C=()=>{},quickAddToList:a,level:f=3,buttonText:b=n("purchasedProducts.quickAdd.addProductToList")}=h,p=K(wt),i=K(({company:e})=>e.companyInfo.status),[S,N]=q.useState(f),[Z,H]=q.useState([]),[U,m]=q.useState(!1),B=(e,d)=>{new Array(e).fill(1).forEach((u,l)=>d(l))};q.useEffect(()=>{let e=[];B(S,d=>{e=[...e,...xe(d,n)]}),H(e)},[S]);const[I]=zt(),Y=()=>{N(S+f)},{control:M,handleSubmit:rt,getValues:ct,formState:{errors:tt},setError:st,setValue:y}=we({mode:"all"}),A=(e,d,u)=>{if(!d&&!u)return!0;let l=!0;const P=parseInt(u,10)||0;return d||(st("sku-".concat(e),{type:"manual",message:n("global.validate.required",{label:n("purchasedProducts.quickAdd.sku")})}),l=!1),u?P<=0&&(st("qty-".concat(e),{type:"manual",message:"incorrect number"}),l=!1):(st("qty-".concat(e),{type:"manual",message:n("global.validate.required",{label:n("purchasedProducts.quickAdd.qty")})}),l=!1),l},G=e=>{const d={};let u=!0;return B(S,l=>{const P=e["sku-".concat(l)],j=e["qty-".concat(l)];if(u=A(l,P,j)===!1?!1:u,u&&P){const v=parseInt(j,10)||0;d[P]=d[P]?d[P]+v:v}}),{skuValue:d,isValid:u,skus:Object.keys(d)}},D=async(e,d,u)=>{const l=[],P=[],j=[],v=[],L=[],ot=[],it=await Wt();return u.forEach(R=>{var ut;const X=(e||[]).find(J=>J.variantSku.toUpperCase()===R.toUpperCase());if(!X){l.push(R);return}const{productId:s,variantId:w,option:T,purchasingDisabled:E="1",stock:V,isStock:Q,maxQuantity:O,minQuantity:_,variantSku:et}=X,nt=((ut=it.find(J=>J.sku===et&&Number((J==null?void 0:J.variantEntityId)||0)===Number(w||0)))==null?void 0:ut.quantity)||0,$=d[R]||0,F=d[R]+nt||0;if(E==="1"){P.push(R);return}if(Q==="1"&&$>Number(V)){L.push({sku:R,stock:Number(V)});return}if(O!==0&&_!==0&&F>0&&(F>O||F<_)){ot.push({sku:R,min:F<_?_:0,max:F>O?O:0});return}const Pt=(T||[]).reduce((J,ht)=>{try{const ft=typeof ht=="string"?JSON.parse(ht):ht;return J.push({optionId:"attribute[".concat(ft.option_id,"]"),optionValue:"".concat(ft.id)}),J}catch(ft){return J}},[]);v.push(R),j.push({...X,newSelectOptionList:Pt,productId:parseInt(s,10)||0,quantity:$,variantId:parseInt(w,10)||0})}),{notFoundSku:l,notPurchaseSku:P,notStockSku:L,productItems:j,passSku:v,orderLimitSku:ot}},W=(e,d,u,l)=>{d.forEach(P=>{const j=Object.keys(e).find(v=>e[v]===P)||"";j&&st(j.replace("sku",u),{type:"manual",message:l})})},r=(e,d)=>{d.forEach(u=>{const l=Object.keys(e).find(P=>e[P]===u)||"";l&&(y(l,""),y(l.replace("sku","qty"),""))})},o=async e=>{const d=p?ge:ye;try{const{variantSku:u}=await d({skus:e},!0);return u}catch(u){return[]}},c=()=>{if(I&&i===0){k.info("Your business account is pending approval. This feature is currently disabled.");return}rt(async e=>{try{m(!0);const{skuValue:d,isValid:u,skus:l}=G(e);if(!u||l.length<=0)return;const P=await o(l),{notFoundSku:j,notPurchaseSku:v,productItems:L,passSku:ot,notStockSku:it,orderLimitSku:R}=await D(P,d,l);if(j.length>0&&(W(e,j,"sku",""),k.error(n("purchasedProducts.quickAdd.notFoundSku",{notFoundSku:j.join(",")}),{isClose:!0})),v.length>0&&(W(e,v,"sku",""),k.error(n("purchasedProducts.quickAdd.notPurchaseableSku",{notPurchaseSku:v.join(",")}),{isClose:!0})),it.length>0){const X=it.map(s=>s.sku);it.forEach(s=>{const{sku:w,stock:T}=s;W(e,[w],"qty","".concat(T," in stock"))}),k.error(n("purchasedProducts.quickAdd.insufficientStockSku",{stockSku:X.join(",")}),{isClose:!0})}R.length>0&&R.forEach(X=>{const{min:s,max:w,sku:T}=X,E=s===0?"Max":"Min",V=s===0?w:s;W(e,[T],"qty","".concat(E," is ").concat(V));const Q=s===0?"maximum":"minimum";k.error(n("purchasedProducts.quickAdd.purchaseQuantityLimitMessage",{typeText:Q,limit:V,sku:T}),{isClose:!0})}),L.length>0&&(await a(L),r(e,ot),C())}finally{m(!1)}})()},x=e=>{e.key==="Enter"&&c()};return t.jsx(St,{isSpinning:U,spinningHeight:"auto",children:t.jsxs(g,{sx:{width:"100%"},children:[t.jsxs(at,{container:!0,sx:{margin:"16px 0"},children:[t.jsx(at,{item:!0,sx:{flex:1,display:"flex",alignItems:"center"},children:t.jsx(z,{sx:{color:"#000"},variant:"body1",children:n("purchasedProducts.quickAdd.title")})}),t.jsx(at,{item:!0,children:t.jsx(gt,{variant:"text",sx:{textTransform:"initial",ml:"-8px"},onClick:Y,children:n("purchasedProducts.quickAdd.showMoreRowsButton")})})]}),t.jsx(g,{onKeyDown:x,sx:{"& label":{zIndex:0}},children:t.jsx(Te,{formFields:Z,errors:tt,control:M,getValues:ct,setValue:y})}),t.jsx(gt,{variant:"outlined",fullWidth:!0,disabled:U,onClick:c,sx:{margin:"20px 0"},children:t.jsx(St,{isSpinning:U,tip:"",size:16,children:t.jsx(g,{sx:{flex:1,textAlign:"center"},children:b})})})]})})}function ze(h){const{isB2BUser:n}=h,[C]=kt(),a=mt(),[f,b]=q.useState(!1),[p,i]=q.useState([]),[S,N]=q.useState("Add to cart"),[Z,H]=q.useState(!1),[U]=zt(),m=K(({company:y})=>y.companyInfo.status),B=y=>{y&&!y.errors?k.success("",{jsx:pt({message:a("purchasedProducts.quickOrderPad.productsAdded"),link:Lt,linkText:a("purchasedProducts.quickOrderPad.viewCart"),isOutLink:!0,isCustomEvent:!0}),isClose:!0}):k.error("Error has occurred",{isClose:!0})},I=async y=>{const A=await jt(y);return A&&A.errors?k.error(A.errors[0].message,{isClose:!0}):k.success("",{jsx:pt({message:a("purchasedProducts.quickOrderPad.productsAdded"),link:Lt,linkText:a("purchasedProducts.quickOrderPad.viewCart"),isOutLink:!0,isCustomEvent:!0}),isClose:!0}),Ot(),A},Y=y=>t.jsxs(t.Fragment,{children:[t.jsx("p",{style:{margin:0},children:a("purchasedProducts.quickOrderPad.notEnoughStock",{variantSku:y.variantSku})}),t.jsx("p",{style:{margin:0},children:a("purchasedProducts.quickOrderPad.availableAmount",{availableAmount:y.AvailableAmount})})]}),M=(y,A)=>t.jsxs(t.Fragment,{children:[t.jsx("p",{style:{margin:0},children:a("purchasedProducts.quickOrderPad.outOfStockSku",{outOfStock:y.join(",")})}),t.jsx(ne,{href:A,sx:{color:"#FFFFFF"},children:a("purchasedProducts.quickOrderPad.downloadErrorsCSV")})]}),rt=y=>{const A=[],G=[],D=[],W=[],r=[],o=[];return y.forEach(c=>{const{products:x,qty:e}=c,{option:d,isStock:u,stock:l,purchasingDisabled:P,maxQuantity:j,minQuantity:v,variantSku:L,variantId:ot,productId:it,modifiers:R}=x;if(P==="1"||P){A.push(L);return}if(u==="1"&&l===0){o.push(L);return}if(u==="1"&&l>0&&l<Number(e)){D.push({variantSku:L,AvailableAmount:l});return}if(Number(v)>0&&Number(e)<Number(v)){W.push({variantSku:L,minQuantity:v});return}if(Number(j)>0&&Number(e)>Number(j)){r.push({variantSku:L,maxQuantity:j});return}const X=d.map(s=>({optionId:s.option_id,optionValue:s.id}));G.push({productId:parseInt(it,10)||0,variantId:parseInt(ot,10)||0,quantity:Number(e),optionSelections:X,allOptions:R})}),{notPurchaseSku:A,productItems:G,limitProduct:D,minLimitQuantity:W,maxLimitQuantity:r,outOfStock:o}},ct=async y=>{H(!0);try{const{stockErrorFile:A,validProduct:G}=y,{notPurchaseSku:D,productItems:W,limitProduct:r,minLimitQuantity:o,maxLimitQuantity:c,outOfStock:x}=rt(G);if(W.length>0){const e=await jt(W);B(e),Ot()}r.length>0&&r.forEach(e=>{k.warning("",{jsx:()=>Y(e)})}),D.length>0&&k.error(a("purchasedProducts.quickOrderPad.notPurchaseableSku",{notPurchaseSku:D.join(",")}),{isClose:!0}),x.length>0&&A&&k.error("",{jsx:()=>M(x,A),isClose:!0}),o.length>0&&o.forEach(e=>{k.error(a("purchasedProducts.quickOrderPad.minQuantityMessage",{minQuantity:e.minQuantity,sku:e.variantSku}),{isClose:!0})}),c.length>0&&c.forEach(e=>{k.error(a("purchasedProducts.quickOrderPad.maxQuantityMessage",{maxQuantity:e.maxQuantity,sku:e.variantSku}),{isClose:!0})}),b(!1)}finally{H(!1)}},tt=async y=>{const A=y.map(D=>({node:{...D,productsSearch:D}})),G=await Kt(A,a);try{G&&await I(y)}catch(D){vt.error(D)}return y},st=()=>{U&&m===0?k.info(a("purchasedProducts.quickOrderPad.addNProductsToCart")):b(!0)};return q.useEffect(()=>{(p==null?void 0:p.length)>0&&N(a("purchasedProducts.quickOrderPad.addNProductsToCart",{quantity:p.length}))},[p]),t.jsxs(se,{sx:{marginBottom:C?"8.5rem":"50px"},children:[t.jsx(Et,{children:t.jsxs(g,{children:[t.jsx(z,{variant:"h5",sx:{marginBottom:"1rem"},children:a("purchasedProducts.quickOrderPad.quickOrderPad")}),t.jsx(qe,{addToList:tt,searchDialogTitle:a("purchasedProducts.quickOrderPad.quickOrderPad"),type:"quickOrder",addButtonText:a("purchasedProducts.quickOrderPad.addToCart"),isB2BUser:n}),t.jsx(Tt,{}),t.jsx($e,{quickAddToList:I,buttonText:a("purchasedProducts.quickOrderPad.addProductsToCart")}),t.jsx(Tt,{}),t.jsx(g,{sx:{margin:"20px 0 0"},children:t.jsxs(gt,{variant:"text",onClick:()=>st(),children:[t.jsx(Ae,{sx:{marginRight:"8px"}}),a("purchasedProducts.quickOrderPad.bulkUploadCSV")]})})]})}),t.jsx(ke,{isOpen:f,setIsOpen:b,handleAddToList:ct,setProductData:i,addBtnText:S,isLoading:Z,isToCart:!0})]})}function Sr(){const h=K(wt),n=K(({b2bFeatures:N})=>N.masqueradeCompany.isAgenting),[C]=kt(),[a,f]=q.useState(!1),[b,p]=q.useState([]),{purchasabilityPermission:i}=K(Rt),S=h?i:!0;return t.jsxs(g,{sx:{width:"100%"},children:[t.jsx(g,{sx:{display:"flex",justifyContent:"center"},children:t.jsxs(at,{sx:{m:0,width:"100%"},container:!0,spacing:2,children:[t.jsx(at,{item:!0,xs:C?12:8,sx:{backgroundColor:"#ffffff",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px",pr:"16px"},children:t.jsx(_e,{setCheckedArr:p,setIsRequestLoading:f,isRequestLoading:a})}),t.jsx(at,{item:!0,xs:C?12:4,sx:{pt:C?"16px":"0px !important",pl:C?"0px !important":"16px"},children:S&&t.jsx(ze,{isB2BUser:h})})]})}),t.jsx(g,{sx:{position:"fixed",bottom:0,left:0,width:"100%",zIndex:"999"},children:t.jsx(Re,{checkedArr:b,isAgenting:n,setIsRequestLoading:f,isB2BUser:h})})]})}export{Sr as default};
//# sourceMappingURL=index-B5I_OYpf.js.map
