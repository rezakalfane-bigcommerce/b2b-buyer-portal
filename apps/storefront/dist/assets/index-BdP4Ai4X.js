import{j as e,B as c,y as M,T as be,d as D,$ as Le,a0 as H,a5 as Te}from"./mui-BOgrCzfx.js";import{r as u}from"./reactVendor-BTcQ-GDs.js";import{u as U,d as _,L as O}from"./router-DEI8QtBD.js";import{d as W}from"./useB2BCallback-DOyIFx1A.js";import{u as N}from"./lang-D1hDrxfH.js";import{B as je}from"./B3Card-BO6dxKHi.js";import{u as x,aC as J,a5 as Ie,aD as Be,aA as Fe,n as G,aE as K,k as Pe,a as $,I as ke,i as z,o as Se,aF as Re,G as Ae,C as He,af as E,ac as Ee,aG as qe,e as ve,ag as Me,aH as De,J as Ue,aI as _e,K as Oe,aJ as q,aj as We,P as Ne,aK as Je,aL as Ge}from"./react-setup-Ceu1rkpw.js";import{b as V}from"./base-BCVDEF8S.js";import"./load-functions-BIyT0cKp.js";import{l as Ke}from"./b3Login-BagfOhBm.js";import{b as Q,a as $e,c as ze}from"./login-RsGaznEG.js";import{a as Ve,i as Qe,l as v,b as Xe}from"./config-CtoVZeFM.js";import{u as Ye}from"./form-hNmOEDBo.js";import{B as Ze}from"./B3CustomForm-DysrR7vP.js";import{a as et,L as tt}from"./styled-si3H6Me9.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"./lodashEs-DKEtmQJE.js";import"../index.Dxi-ailt.js";import"./global-D7Yn0gGb.js";import"./muiIcon-dPEugcco.js";import"./dateFns-DCN-lSH3.js";import"./dropzone-BroiqFaF.js";import"./validatorRules-ByvbDKs6.js";function R(t){const{html:s,sx:n}=t;return e.jsx(c,{sx:{...n},dangerouslySetInnerHTML:{__html:s}})}const ot=()=>Q().then(t=>{if(t.data.logout.result!=="success")throw new Error("Failed to logout")}),st=()=>{const t=x(({b2bFeatures:n})=>n.masqueradeCompany.isAgenting),s=x(({b2bFeatures:n})=>n.masqueradeCompany.id);return u.useCallback(async()=>{t&&G(Number(s))},[t,s])},nt=()=>{const{selectCompanyHierarchyId:t}=x(({company:s})=>s.companyHierarchyInfo);return u.useCallback(async()=>{t&&await K()},[t])};function at(){const t=U(),s=st(),n=nt(),g=x(J),i=x(({company:d})=>d.tokens.B2BToken),[y]=_(),b=y.get("loginFlag");return u.useEffect(()=>{const d=setTimeout(()=>{window.location.href="/login"},3e3);return()=>{clearTimeout(d)}},[i]),u.useEffect(()=>{b==="loggedOutLogin"||!i?Promise.all([ot(),s(),n()]).catch(()=>{t("/orders")}).then(()=>{window.sessionStorage.clear(),Ie.dispatch(Be()),window.b2b.callbacks.dispatchEvent("on-logout")}):g&&t("/orders")},[n,s,g,b,t,i]),e.jsx(Fe,{})}function it(t){const{loginBtn:s,handleLoginSubmit:n,backgroundColor:g}=t,i=N(),y=M(),{control:b,handleSubmit:d,getValues:r,formState:{errors:B},setValue:F}=Ye({mode:"onSubmit"}),L=j=>{n(j)},h=Ve(i,d(L));return e.jsxs(c,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(be,{variant:"h5",sx:{margin:"20px 0",display:"flex",justifyContent:"center",alignItems:"center"},children:i("login.loginText.signInHeader")}),e.jsx(c,{sx:{width:"100%","& input":{bgcolor:"#F5F5F5",borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:e.jsxs("form",{onSubmit:d(L),children:[e.jsx(Ze,{formFields:h,errors:B,control:b,getValues:r,setValue:F}),e.jsxs(c,{sx:{display:"flex",justifyContent:"flex-start ",alignItems:"center",mt:2,gap:2},children:[e.jsx(D,{type:"submit",variant:"contained",sx:{backgroundColor:y.palette.primary.main},children:s}),e.jsx(Le,{component:O,color:Pe(g),to:"/forgotPassword",children:i("login.loginText.forgotPasswordText")})]})]})})]})}function rt(t){const{widgetBodyText:s,createAccountButtonText:n}=t,g=M(),[i]=$();return e.jsxs(c,{sx:{padding:i?"16px":"20px",borderRadius:"4px",mt:i?"0":"-25px"},children:[e.jsx(R,{sx:{minHeight:"250px","& .panel":{".panel-title":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontWeight:400,fontSize:"24px"}}},html:s}),e.jsx(c,{sx:{marginTop:"5px"},children:e.jsx(D,{component:O,to:"/register",variant:"contained",sx:{ml:i?0:1,backgroundColor:g.palette.primary.main},children:n})})]})}const lt=()=>{const t=x(({b2bFeatures:g})=>g.masqueradeCompany.isAgenting),s=x(({b2bFeatures:g})=>g.masqueradeCompany.id),n=z();return u.useCallback(async()=>{t&&(await G(Number(s)),n(Se()))},[s,n,t])},ct=()=>{const{selectCompanyHierarchyId:t}=x(({company:s})=>s.companyHierarchyInfo);return u.useCallback(async()=>{t&&await K()},[t])},gt=()=>{const t=lt(),s=ct();return async()=>{try{const{result:n}=(await Q()).data.logout;if(n!=="success")return;await Promise.all([s(),t()])}catch(n){V.error(n)}finally{window.sessionStorage.clear(),ke(),W("on-logout")}}};function dt(t){const{setOpenPage:s}=t,n=z(),g=gt(),i=x(J),y=x(({quoteInfo:o})=>o.quoteDetailToCheckoutUrl),[b,d]=u.useState(!0),[r]=$(),[B,F]=u.useState(!0),[L,h]=u.useState(),[j,X]=u.useState({emailAddress:"",password:""}),I=U(),m=N(),[P,Y]=_(),{state:{isCheckout:Z,logo:ee,registerEnabled:T}}=u.useContext(Ae),{state:{loginPageButton:te,loginPageDisplay:oe,loginPageHtml:se,portalStyle:{backgroundColor:ne="FEF9F5"}}}=u.useContext(He),{createAccountButtonText:ae,primaryButtonColor:ie,signInButtonText:re}=te,{displayStoreLogo:le,pageTitle:ce}=oe,{bottomHtmlRegionEnabled:ge,bottomHtmlRegionHtml:de,createAccountPanelHtml:ue,topHtmlRegionEnabled:me,topHtmlRegionHtml:pe}=se,p={loginTitle:ce||m("login.button.signIn"),loginBtn:re||m("login.button.signInUppercase"),createAccountButtonText:ae||m("login.button.createAccount"),btnColor:ie||"",widgetHeadText:me?pe:void 0,widgetBodyText:ue||qe,widgetFooterText:ge?de:void 0,logo:le?ee:void 0};u.useEffect(()=>{(async()=>{try{const o=P.get("loginFlag"),a=P.get("showTip")!=="false";if(F(a),Qe(o)&&h(o),o==="invoiceErrorTip"){const{tip:f}=v[o];E.error(m(f))}o==="loggedOutLogin"&&i&&await g(),d(!1)}finally{d(!1)}})()},[m,i,g,P]);const xe=(o,a="")=>{const{tip:f,alertType:w}=v[o];return{message:m(f,{email:a}),severity:w}},k=async o=>{const a=await Ge(o);h(a?"resetPassword":"accountIncorrect")},fe=async(o,a)=>{const{errors:f}=await ze({email:o,pass:a});if(f!=null&&f[0]){const{message:w}=f[0];if(w==="Reset password")return k(o),!0}return!1},he=async o=>{if(d(!0),X(o),Y(a=>(a.delete("loginFlag"),a)),Z)try{const a=await Xe(o);a.status===400&&a.type==="reset_password_before_login"?h("resetPassword"):a.type==="invalid_login"?h("accountIncorrect"):window.location.href=ve}catch(a){V.error(a),await k(o.emailAddress)}finally{d(!1)}else try{const a={email:o.emailAddress,password:o.password,storeHash:De,channelId:Me};if(await fe(o.emailAddress,o.password))return;const{login:{result:{token:w,storefrontLoginToken:A},errors:C}}=await $e({loginData:a});if(n(Ue(w)),_e(A),W("on-login",{storefrontToken:A}),C!=null&&C[0]||!w){if(C!=null&&C[0]){const{message:l}=C[0];if(l==="Operation cannot be performed as the storefront channel is not live"){h("accountPrelaunch"),d(!1);return}}k(o.emailAddress)}else{const l=await Oe(w);if(y){I(y);return}if((l==null?void 0:l.userType)===q.MULTIPLE_B2C&&(l==null?void 0:l.role)===We.SUPER_ADMIN){I("/dashboard");return}if(!Ke(I))return;(l==null?void 0:l.userType)===q.B2C&&I(Ne.ORDERS);const Ce=Je(Number(l==null?void 0:l.role));I(Ce)}}catch(a){E.error(m("login.loginTipInfo.accountIncorrect"))}finally{d(!1)}},ye=T?"100%":"50%",we=T?"50%":"auto",S=L&&xe(L,j==null?void 0:j.emailAddress);return e.jsx(je,{setOpenPage:s,children:e.jsx(et,{paddings:r?"0":"20px 20px",children:e.jsx(Ee,{isSpinning:b,tip:m("global.tips.loading"),background:"transparent",children:e.jsx(c,{sx:{display:"flex",flexDirection:"column",width:"100%",minHeight:"400px",minWidth:"343px"},children:p&&e.jsxs(e.Fragment,{children:[L&&B&&e.jsx(c,{sx:{padding:r?0:"0 5%",margin:"30px 0 0 0"},children:S&&e.jsx(H,{severity:S.severity,variant:"filled",children:S.message})}),y&&e.jsx(H,{severity:"error",variant:"filled",children:m("login.loginText.quoteDetailToCheckoutUrl")}),p.logo&&e.jsx(c,{sx:{margin:"20px 0",minHeight:"150px"},children:e.jsx(tt,{children:e.jsx(Te,{sx:{maxWidth:r?"70%":"250px"},onClick:()=>{window.location.href="/"},children:e.jsx("img",{src:p.logo,alt:m("login.registerLogo"),loading:"lazy"})})})}),p.widgetHeadText&&e.jsx(R,{sx:{minHeight:"48px",width:T||r?"100%":"50%"},html:p.widgetHeadText}),e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:e.jsx(c,{sx:{bgcolor:"#FFFFFF",borderRadius:"4px",margin:"20px 0",display:"flex",flexDirection:"column",justifyContent:"center",width:r?"auto":ye},children:e.jsxs(c,{sx:{mb:"20px",display:"flex",flexDirection:r?"column":"row",justifyContent:"center",width:r?"auto":"100%"},children:[e.jsx(c,{sx:{width:r?"auto":we,paddingRight:r?0:"2%",ml:"16px",mr:r?"16px":"",pb:T?"":"36px"},children:e.jsx(it,{loginBtn:p.loginBtn,handleLoginSubmit:he,backgroundColor:ne})}),T&&e.jsx(c,{sx:{flex:"1",paddingLeft:r?0:"2%"},children:e.jsx(rt,{createAccountButtonText:p.createAccountButtonText,widgetBodyText:p.widgetBodyText})})]})})}),p.widgetFooterText&&e.jsx(R,{sx:{minHeight:"48px",width:T||r?"100%":"50%"},html:p.widgetFooterText})]})})})})})}function Ut(t){return Re==="catalyst"?e.jsx(at,{}):e.jsx(dt,{...t})}export{Ut as default};
//# sourceMappingURL=index-BdP4Ai4X.js.map
