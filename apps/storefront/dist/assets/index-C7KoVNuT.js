import{j as s,s as De,w as ne,y as re,z as Se,L as Fe,ae as je,T as V,x as xe,B as X,I as he,af as Ie}from"./mui-BLXOPN2Y.js";import{r as c}from"./reactVendor-BTcQ-GDs.js";import{u as Y}from"./lang-DZEhsX8V.js";import{B as Ee}from"./B3Filter-DSoItPvE.js";import{ab as ge,af as P,ah as ye,ad as Le,ai as we,a as Be,ae as Ne,u as $,t as ke,G as Pe,aj as Ce,ac as ve,ak as Te,al as Oe,am as pe}from"./react-setup-CIpmLpp1.js";import"./load-functions-BRbpFqwb.js";import{b as Q}from"./base-BCVDEF8S.js";import{d as Re,u as ze,a as qe}from"./Edit-BsVW3PNw.js";import{c as Ue,u as Ae,a as Ve,b as Me,d as _e,e as $e,g as Ge,f as He,h as Je,i as Ke}from"./address-D67CS8fH.js";import{b as We,a as Xe,u as Qe,f as Ye,c as Ze}from"./config-CIjeTB-5.js";import{u as es}from"./form-hNmOEDBo.js";import{f as ss}from"./lodashEs-DKEtmQJE.js";import{B as ts}from"./B3CustomForm-Byn3vSHD.js";import{d as ie,v as as,g as be}from"./config-CvhQ8yfx.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./B3FilterMore-CI3BaAPY.js";import"./dateFns-CXOS6Mtj.js";import"./B3FilterSearch-By40D28Q.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.BYqSO1mW.js";import"./global-D7Yn0gGb.js";import"./router-DEI8QtBD.js";import"./muiIcon-DcrdeM0-.js";import"./dropzone-BOmS2zFM.js";import"./validatorRules-D57UV3M2.js";const is=De("div")(()=>({display:"flex","& div::first-of-type":{marginRight:"2rem"},"& div":{minWidth:"45%",display:"flex",flexDirection:"column"}}));function ns({addressFields:l,updateAddressList:a,companyId:h,isBCPermission:u,countries:f},F){const C=Y(),[D,g]=c.useState(!1),[p,j]=c.useState(""),[N,q]=c.useState(!1),[v,R]=c.useState(!1),[I,k]=c.useState(l),[M,G]=c.useState([]),[T,Z]=c.useState([]),[y,de]=c.useState(null),[L,U]=c.useState({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),z=!u,{control:H,handleSubmit:O,getValues:ee,formState:{errors:le},watch:J,setError:oe,setValue:w,reset:K}=es({mode:"all"}),se=async m=>{var o;try{const i=M.map(t=>({fieldName:ie(t.name),fieldValue:m[t.name]||t.default})),e=await as({extraFields:i});if(e.code!==200){const t=((o=e.data)==null?void 0:o.errMsg)||e.message||"",n=t.split(":");if(n.length>=2){const r=M.find(x=>ie(x.name)===n[0]);if(r)return oe(r.name,{type:"manual",message:n[1]}),R(!1),!1}throw t}return!0}catch(i){throw P.error(i),i}},te=()=>{K(),U({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),g(!1),j("")},W=()=>{O(async m=>{R(!0);try{if(!await se(m))return;const i=M.map(B=>({fieldName:ie(B.name),fieldValue:m[B.name]||B.default})),{country:e,state:t}=m;let n="",r="",x=t;f.forEach(B=>{const{countryName:d,countryCode:E,states:S}=B;if(E===e)if(n=d,S.length>0){const b=S.find(_=>_.stateCode===x||_.stateName===x);r=(b==null?void 0:b.stateName)||r,x=(b==null?void 0:b.stateCode)||x}else x="",r=t});const A={...m,companyId:Number(h),extraFields:i,isShipping:L.isShipping?1:0,isBilling:L.isBilling?1:0,isDefaultShipping:L.isDefaultShipping?1:0,isDefaultBilling:L.isDefaultBilling?1:0,country:n,countryCode:e,state:r,stateCode:x};if(p==="add")await Ue(A),P.success(C("addresses.addressForm.newAddressAdded"));else if(p==="edit"&&y){const{id:B}=y;await Ae({...A,id:Number(B)}),P.success(C("addresses.addressForm.addressUpdated"))}U({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),g(!1),await a(!0)}catch(o){P.error(o)}finally{R(!1)}})()},ce=()=>{O(async m=>{R(!0);try{const o=M.map(A=>({name:A.bcLabel,value:m[A.name]||A.default})),{country:i,state:e}=m;let t="",n="",r=e;f.forEach(A=>{const{countryName:B,countryCode:d,states:E}=A;if(d===i)if(t=B,E.length>0){const S=E.find(b=>b.stateCode===r||b.stateName===r);n=(S==null?void 0:S.stateName)||n,r=(S==null?void 0:S.stateCode)||r}else r="",n=e});const x={...m,formFields:o,country:t,countryCode:i,state:n,stateCode:r,addressType:""};if(p==="add")await Ve(x),P.success(C("addresses.addressForm.newAddressAdded"));else if(p==="edit"&&y){const{bcAddressId:A}=y;A&&await Me({...x,id:Number(A)}),P.success(C("addresses.addressForm.addressUpdated"))}g(!1),await a(!0)}catch(o){P.error(o)}finally{R(!1)}})()},fe=()=>{z?W():ce()},ue=(m,o)=>{m==="add"&&T.length>0&&I.forEach(i=>{const e=i;if(i.custom)if(z){const t=T.filter(n=>n.name===i.name)[0];e.default=t.default||""}else{const t=T.filter(n=>n.name===i.name||n.bcLabel===i.bcLabel)[0];e.default=t.default||""}}),K(),de(o),j(m),g(!0),q(!1)};c.useImperativeHandle(F,()=>({handleOpenAddEditAddressClick:ue}));const me=(m,o)=>{U(o==="isShipping"?{...L,[o]:m,isDefaultShipping:!1}:{...L,[o]:m,isDefaultBilling:!1})};c.useEffect(()=>{const m=JSON.parse(JSON.stringify(l));m.forEach(i=>{const e=i;return e.label=C(i.idLang)||i.label,!z&&i.fieldId==="field_21"&&(e.default=""),i}),k(m);const o=l.filter(i=>i.custom);if(G(o),T.length===0){const i=ss(l);Z(i)}},[l,T.length,z]);const ae=c.useCallback(()=>{if(y){const{isShipping:m,isBilling:o,isDefaultShipping:i,isDefaultBilling:e,state:t,stateCode:n,countryCode:r,extraFields:x}=y,A=f.filter(B=>B.countryCode===r);U({isShipping:m===1,isBilling:o===1,isDefaultShipping:i===1,isDefaultBilling:e===1}),I.forEach(B=>{const d=B;if(d.custom&&x.length>0)if(z){const E=ie(d.name),S=x.find(_=>_.fieldName===E),b=T.find(_=>_.name===E);S?(w(d.name,S.fieldValue||""),d.default=S.fieldValue||""):(w(d.name,""),d.default=b.default)}else{const E=x.find(b=>b.fieldName===d.name||b.fieldName===d.bcLabel),S=T.filter(b=>b.name===d.name||b.bcLabel===d.bcLabel)[0];E?(w(d.name,E.fieldValue||""),d.default=E.fieldValue||S.default):(w(d.name,""),d.default=S.default)}else if(d.name==="country")w(d.name,r);else if(d.name==="state"){if(w(d.name,n||t),A[0]){const{states:E}=A[0];E.length>0?(d.options=E,d.fieldType="dropdown",d.required=!0):(d.options=[],d.fieldType="text",d.required=!1)}}else w(d.name,y[d.name]==="undefined"?"":y[d.name])})}},[y,f,z,T,w,I]);return c.useEffect(()=>{D&&p==="edit"&&y&&!N&&(ae(),q(!0))},[D,p,y,N,ae]),c.useEffect(()=>{const m=i=>{var n;const e=((n=f.find(r=>r.countryCode===i))==null?void 0:n.states)||[],t=I.find(r=>r.name==="state");t&&(e.length>0?(t.fieldType="dropdown",t.options=e,t.required=!0):(t.fieldType="text",t.options=[],t.required=!1)),w("state",""),k([...I])},o=J((i,{name:e,type:t})=>{const{country:n}=i;e==="country"&&t==="change"&&m(n)});return()=>o.unsubscribe()},[I,f,J]),s.jsxs(ge,{isOpen:D,title:C(p==="add"?"addresses.addressForm.addNewAddress":"addresses.addressForm.editAddress"),leftSizeBtn:C("addresses.addressForm.cancel"),rightSizeBtn:C("addresses.addressForm.saveAddress"),handleLeftClick:te,handRightClick:fe,loading:v,isShowBordered:!0,children:[z&&s.jsxs(s.Fragment,{children:[s.jsx("p",{children:C("addresses.addressForm.selectAddressType")}),s.jsx(is,{children:We.map(m=>{const{child:o,name:i,idLang:e}=m;return s.jsxs("div",{children:[s.jsx(ne,{control:s.jsx(re,{checked:L[i],onChange:t=>{me(t.target.checked,i)}}),label:C(e)}),o&&s.jsx(ne,{control:s.jsx(re,{checked:L[o.name],onChange:()=>{U({...L,[o.name]:!L[o.name]})}}),label:C(o.idLang),sx:{display:L[i]?"":"none"}})]},i)})})]}),s.jsx(ts,{formFields:I,errors:le,control:H,getValues:ee,setValue:w})]})}const rs=c.forwardRef(ns),ds=xe("div")(({marginBottom:l})=>({marginBottom:l,"& > span:not(:last-child)":{marginRight:"4px"}})),ls=xe("div")(({theme:l})=>({display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:l.spacing(3)}));function os(l){const{item:a,onEdit:h,onDelete:u,onSetDefault:f,editPermission:F,updateActionsPermission:C=!1,deleteActionsPermission:D=!1,isBCPermission:g}=l,p=Se(),j=Y();return s.jsx(Fe,{children:s.jsxs(je,{sx:{color:"#313440",wordBreak:"break-word"},children:[a.label&&s.jsx(V,{variant:"h5",sx:{marginBottom:a.isDefaultShipping===1||a.isDefaultBilling===1?p.spacing(1):p.spacing(3),color:"rgba(0, 0, 0, 0.87)"},children:a.label}),s.jsxs(ds,{marginBottom:a.isDefaultShipping===1||a.isDefaultBilling===1?p.spacing(3):0,children:[a.isDefaultShipping===1&&s.jsx(ye,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:j("addresses.addressItemCard.defaultShipping")}),a.isDefaultBilling===1&&s.jsx(ye,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:j("addresses.addressItemCard.defaultBilling")})]}),s.jsx(V,{variant:"body1",children:"".concat(a.firstName," ").concat(a.lastName)}),s.jsx(V,{variant:"body1",children:a.company||""}),s.jsx(V,{variant:"body1",children:a.addressLine1}),s.jsx(V,{variant:"body1",children:a.addressLine2==="undefined"?"":a.addressLine2}),s.jsx(V,{variant:"body1",children:"".concat(a.city,", ").concat(a.state," ").concat(a.zipCode,", ").concat(a.country)}),s.jsx(V,{variant:"body1",children:a.phoneNumber}),F&&s.jsxs(ls,{children:[!g&&C&&s.jsx(Le,{variant:"text",sx:{ml:"-8px"},onClick:()=>{f(a)},children:j("addresses.addressItemCard.setAsDefault")}),s.jsxs(X,{sx:{flex:1,display:"flex",justifyContent:"flex-end"},children:[(C||g)&&s.jsx(he,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{h(a)},children:s.jsx(Re,{fontSize:"inherit"})}),(D||g)&&s.jsx(he,{"aria-label":"delete",size:"small",onClick:()=>{u(a)},children:s.jsx(we,{fontSize:"inherit"})})]})]})]})},a.id)}function cs(l){const{isOpen:a,setIsOpen:h,addressData:u,updateAddressList:f,setIsLoading:F,companyId:C,isBCPermission:D}=l,[g]=Be(),p=Y(),j=async()=>{if(u)try{F(!0),h(!1);const{id:N="",bcAddressId:q=""}=u;D?await $e({bcAddressId:q}):await _e({addressId:N,companyId:C}),P.success(p("addresses.deleteAddressDialog.successfullyDeleted")),f()}catch(N){F(!1)}};return s.jsx(ge,{isOpen:a,title:p("addresses.deleteAddressDialog.deleteAddress"),leftSizeBtn:p("addresses.deleteAddressDialog.cancel"),rightSizeBtn:p("addresses.deleteAddressDialog.delete"),handleLeftClick:()=>{h(!1)},handRightClick:j,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:s.jsx(X,{sx:{display:"flex",alignItems:g?"start":"center",justifyContent:g?"center":"start",width:g?"100%":"450px",height:"100%"},children:p("addresses.deleteAddressDialog.confirmDelete")})})}function fs(l){const{isOpen:a,setIsOpen:h,setIsLoading:u,addressData:f,updateAddressList:F,companyId:C}=l,[D]=Be(),g=Y(),[p,j]=c.useState();c.useEffect(()=>{j(f)},[f]);const N=v=>R=>{const{checked:I}=R.target;if(p){const k={...p};v==="isDefaultShipping"&&(k.isDefaultShipping=I?1:0,k.isShipping=I?1:k.isShipping),v==="isDefaultBilling"&&(k.isDefaultBilling=I?1:0,k.isBilling=I?1:k.isShipping),j(k)}},q=async()=>{try{u(!0),h(!1),await Ae({...p,companyId:C}),P.success(g("addresses.setDefaultDialog.successfullySet")),F()}catch(v){u(!1)}};return s.jsx(ge,{isOpen:a,title:g("addresses.setDefaultDialog.setDefaultAddress"),leftSizeBtn:g("addresses.setDefaultDialog.cancel"),rightSizeBtn:"set",handleLeftClick:()=>{h(!1)},handRightClick:q,children:s.jsx(X,{sx:{display:"flex",alignItems:D?"start":"center",justifyContent:D?"center%":"start",width:D?"100%":"450px",height:"100%"},children:p&&s.jsx(X,{sx:{padding:D?"0":"10px 0"},children:s.jsxs(Ie,{children:[s.jsx(ne,{control:s.jsx(re,{checked:p.isDefaultShipping===1,onChange:N("isDefaultShipping")}),label:g("addresses.setDefaultDialog.setDefaultShippingAddress")}),s.jsx(ne,{control:s.jsx(re,{checked:p.isDefaultBilling===1,onChange:N("isDefaultBilling")}),label:g("addresses.setDefaultDialog.setDefaultBillingAddress")})]})})})})}const us=l=>{if(l.length===0)return[];const a=l.filter(f=>f.visibleToEnduser)||[];if((a==null?void 0:a.length)===0)return[];const h=a.map(f=>({...f,groupId:4,visible:f.visibleToEnduser})),u=be(h).address;return u.map(f=>{const F=f;return F.custom=!0,f}),u},ms=async()=>{try{const{accountFormFields:l}=await Ne(1),a=l.filter(u=>u.groupId===4);return be(a).address}catch(l){Q.error(l)}},ps=async()=>{try{const l=await Ge(),a=us(l.addressExtraFields);return[...Xe,...a]}catch(l){Q.error(l)}return[]},gs=async(l,a)=>{let h=[];try{if(l){const u=await ps();u&&(h=u)}else h=await ms();return h.map(u=>{const f=u;return u.name==="country"&&(f.options=a,f.required=!0),u.name==="state"&&(f.fieldType="text",f.required=!1),u}),h}catch(u){Q.error(u)}return[]},hs=[pe.addressesCreateActionsPermission,pe.addressesUpdateActionsPermission,pe.addressesDeleteActionsPermission];function $s(){const l=$(ke),a=$(({company:e})=>e.companyInfo.id),h=$(({company:e})=>e.customer.role),u=$(({b2bFeatures:e})=>e.masqueradeCompany.id),f=$(({b2bFeatures:e})=>e.masqueradeCompany.isAgenting),{state:{addressConfig:F},dispatch:C}=c.useContext(Pe),{selectCompanyHierarchyId:D}=$(({company:e})=>e.companyHierarchyInfo),g=Y(),p=ze(),[j]=qe(),N=c.useRef(null),[q,v]=c.useState(!1),[R,I]=c.useState([]),[k,M]=c.useState([]),[G,T]=c.useState({search:""}),Z=h===Ce.SUPER_ADMIN&&f?u:a;let y=!1;(!l||h===Ce.SUPER_ADMIN&&!f)&&(y=!0),c.useEffect(()=>{(async()=>{const{countries:t}=await Oe();M(t),v(!0);try{const n=await gs(!y,t);I(n||[])}catch(n){Q.error(n)}finally{v(!1)}})()},[]);const de={},L=async(e=de)=>{let t=[],n=0;if(y){const{customerAddresses:{edges:r=[],totalCount:x}}=await Ke({...e});t=r.map(A=>({node:Ze(A.node)})),n=x}else{const{addresses:{edges:r=[],totalCount:x}}=await Je({companyId:Z,...e});t=r,n=x}return{edges:t,totalCount:n}},U=(e,t)=>{e==="search"&&T({...G,search:t})},z=e=>{T({...G,country:e.country||"",state:e.state||"",city:e.city||""})},H=()=>{var e;(e=j.current)==null||e.refresh()},[O,ee]=c.useState(!1),[le,J]=c.useState(!1),[oe,w]=c.useState(!1),[K,se]=c.useState(),[te,W,ce]=Qe(hs);c.useEffect(()=>{(async()=>{var t,n;if(y){ee(!0);return}if(W)try{let r=F;if(!r){const{addressConfig:B}=await He();r=B,C({type:"common",payload:{addressConfig:r}})}const x=h===3?"address_sales_rep":"address_admin",A=((t=(r||[]).find(B=>B.key==="address_book"))==null?void 0:t.isEnabled)==="1"&&((n=(r||[]).find(B=>B.key===x))==null?void 0:n.isEnabled)==="1";ee(A)}catch(r){Q.error(r)}})()},[F,W,y,h,D]);const fe=()=>{var e;if(!O){P.error(g("addresses.noPermissionToAdd"));return}(e=N.current)==null||e.handleOpenAddEditAddressClick("add")},ue=e=>{var t;if(!O){P.error(g("addresses.noPermissionToEdit"));return}(t=N.current)==null||t.handleOpenAddEditAddressClick("edit",e)},me=e=>{if(!O){P.error(g("addresses.noPermissionToEdit"));return}se({...e}),w(!0)},ae=e=>{se({...e}),J(!0)},m=c.useMemo(()=>({isEnabled:y||O&&te,customLabel:g("addresses.addNewAddress")}),[O,D,te]),o=JSON.parse(JSON.stringify(Ye));o.map(e=>{const t=e;return t.label=g(e.idLang),e});const i=Number(D)||Number(Z);return s.jsx(ve,{isSpinning:q,children:s.jsxs(X,{sx:{display:"flex",flexDirection:"column",flex:1},children:[s.jsx(Ee,{filterMoreInfo:o,handleChange:U,handleFilterChange:z,customButtonConfig:m,handleFilterCustomButtonClick:fe}),s.jsx(Te,{ref:j,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:L,searchParams:G,isCustomRender:!0,itemXs:p?3:4,requestLoading:v,tableKey:"id",renderItem:e=>s.jsx(os,{item:e,onEdit:()=>ue(e),onDelete:me,onSetDefault:ae,editPermission:O,updateActionsPermission:W,deleteActionsPermission:ce,isBCPermission:y},e.id)}),s.jsx(rs,{updateAddressList:H,addressFields:R,ref:N,companyId:i,isBCPermission:y,countries:k}),O&&!y&&s.jsx(fs,{isOpen:le,setIsOpen:J,setIsLoading:v,addressData:K,updateAddressList:H,companyId:i}),O&&s.jsx(cs,{isOpen:oe,setIsOpen:w,setIsLoading:v,addressData:K,updateAddressList:H,companyId:i,isBCPermission:y})]})})}export{$s as default};
//# sourceMappingURL=index-C7KoVNuT.js.map
