{"version":3,"file":"index-ClduCDgB.js","sources":["../../src/pages/ForgotPassword/index.tsx"],"sourcesContent":["import { useContext, useEffect, useState } from 'react';\nimport { SubmitHandler, useForm } from 'react-hook-form';\nimport { useNavigate } from 'react-router-dom';\nimport { useB3Lang } from '@b3/lang';\nimport { Box, ImageListItem, Typography } from '@mui/material';\n\nimport { B3Card, B3CustomForm } from '@/components';\nimport CustomButton from '@/components/button/CustomButton';\nimport { Captcha } from '@/components/form';\nimport B3Spin from '@/components/spin/B3Spin';\nimport { useMobile } from '@/hooks';\nimport { CustomStyleContext } from '@/shared/customStyleButton';\nimport { GlobalContext } from '@/shared/global';\nimport { getStorefrontToken, requestResetPassword } from '@/shared/service/b2b/graphql/recaptcha';\nimport b2bLogger from '@/utils/b3Logger';\n\nimport { getForgotPasswordFields, LoginConfig, sendEmail } from '../Login/config';\nimport { B3ResetPassWordButton, LoginImage } from '../Login/styled';\nimport { type PageProps } from '../PageProps';\n\ninterface ForgotPasswordProps extends PageProps {\n  logo?: string;\n  isEnabledOnStorefront: boolean;\n  storefrontSiteKey: string;\n}\n\nexport function ForgotPassword({\n  setOpenPage,\n  isEnabledOnStorefront,\n  storefrontSiteKey,\n  logo,\n}: ForgotPasswordProps) {\n  const [isMobile] = useMobile();\n  const [isLoading, setLoading] = useState<boolean>(false);\n  const b3Lang = useB3Lang();\n  const forgotPasswordFields = getForgotPasswordFields(b3Lang);\n  const [isCaptchaMissing, setIsCaptchaMissing] = useState(false);\n  const [captchaKey, setCaptchaKey] = useState('');\n\n  const {\n    control,\n    handleSubmit,\n    getValues,\n    formState: { errors },\n    setValue,\n    watch,\n  } = useForm<LoginConfig>({\n    mode: 'onSubmit',\n  });\n\n  const navigate = useNavigate();\n  const emailAddressReset = watch('emailAddress');\n\n  useEffect(() => {\n    if (captchaKey || !isEnabledOnStorefront) setIsCaptchaMissing(false);\n  }, [captchaKey, isEnabledOnStorefront]);\n\n  const handleLoginClick: SubmitHandler<LoginConfig> = async (data) => {\n    const { emailAddress } = data;\n\n    if (isEnabledOnStorefront && !captchaKey) {\n      setIsCaptchaMissing(true);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      if (isEnabledOnStorefront && captchaKey) {\n        try {\n          await requestResetPassword(captchaKey, emailAddressReset);\n          navigate('/login?loginFlag=receivePassword');\n          setLoading(false);\n        } catch (e) {\n          b2bLogger.error(e);\n        }\n      }\n\n      if (!isEnabledOnStorefront) {\n        await sendEmail(emailAddress);\n        setLoading(false);\n        navigate('/login?loginFlag=receivePassword');\n      }\n    } catch (e) {\n      b2bLogger.error(e);\n    }\n  };\n\n  return (\n    <B3Card setOpenPage={setOpenPage}>\n      <Box\n        sx={{\n          bgcolor: '#FFFFFF',\n          borderRadius: '4px',\n          display: 'flex',\n          flexDirection: 'column',\n          mr: 'auto',\n          ml: 'auto',\n          maxWidth: '537px',\n        }}\n      >\n        <Box sx={{ mt: '20px' }}>\n          {logo && (\n            <LoginImage>\n              <ImageListItem\n                sx={{\n                  maxWidth: isMobile ? '175px' : '250px',\n                }}\n                onClick={() => {\n                  window.location.href = '/';\n                }}\n              >\n                <img src={logo} alt={b3Lang('global.tips.registerLogo')} loading=\"lazy\" />\n              </ImageListItem>\n            </LoginImage>\n          )}\n        </Box>\n        <Box\n          sx={{\n            margin: '20px 0 0 0',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <Typography\n            variant=\"h5\"\n            sx={{\n              margin: '16px 0',\n            }}\n          >\n            {b3Lang('forgotPassword.resetPassword')}\n          </Typography>\n          <Typography\n            variant=\"body1\"\n            sx={{\n              margin: '0 16px 16px 16px',\n            }}\n          >\n            {b3Lang('forgotPassword.requestEmail')}\n          </Typography>\n          <B3CustomForm\n            formFields={forgotPasswordFields}\n            errors={errors}\n            control={control}\n            getValues={getValues}\n            setValue={setValue}\n            sx={{ margin: '0 16px', maxWidth: isMobile ? '311px' : '505px' }}\n          />\n          {isEnabledOnStorefront && isCaptchaMissing ? (\n            <Typography\n              variant=\"body1\"\n              sx={{\n                color: 'red',\n                display: 'flex',\n                alignSelf: 'flex-start',\n                marginLeft: '18px',\n                marginTop: '2px',\n                fontSize: '13px',\n              }}\n            >\n              {b3Lang('login.loginText.missingCaptcha')}\n            </Typography>\n          ) : (\n            ''\n          )}\n          {isEnabledOnStorefront ? (\n            <Box sx={{ marginTop: '20px' }}>\n              <Captcha\n                siteKey={storefrontSiteKey}\n                size=\"normal\"\n                email={emailAddressReset}\n                handleGetKey={setCaptchaKey}\n              />\n            </Box>\n          ) : (\n            ''\n          )}\n          <B3Spin isSpinning={isLoading} size={20} isFlex={false}>\n            <B3ResetPassWordButton>\n              <CustomButton\n                type=\"submit\"\n                size=\"medium\"\n                onClick={handleSubmit(handleLoginClick)}\n                variant=\"contained\"\n                sx={{ width: 'auto' }}\n              >\n                {b3Lang('forgotPassword.resetPasswordBtn')}\n              </CustomButton>\n            </B3ResetPassWordButton>\n          </B3Spin>\n        </Box>\n      </Box>\n    </B3Card>\n  );\n}\n\nexport default function Page({ setOpenPage }: PageProps) {\n  const { logo } = useContext(GlobalContext).state;\n  const { loginPageDisplay } = useContext(CustomStyleContext).state;\n  const [isEnabledOnStorefront, setIsEnabledOnStorefront] = useState(false);\n  const [storefrontSiteKey, setStorefrontSiteKey] = useState('');\n\n  useEffect(() => {\n    const getIsEnabledOnStorefront = async () => {\n      try {\n        const response = await getStorefrontToken();\n\n        if (response) {\n          setIsEnabledOnStorefront(response.isEnabledOnStorefront);\n          setStorefrontSiteKey(response.siteKey);\n        }\n      } catch (e) {\n        b2bLogger.error(e);\n      }\n    };\n\n    getIsEnabledOnStorefront();\n  }, []);\n\n  return (\n    <ForgotPassword\n      setOpenPage={setOpenPage}\n      logo={loginPageDisplay.displayStoreLogo ? logo : undefined}\n      isEnabledOnStorefront={isEnabledOnStorefront}\n      storefrontSiteKey={storefrontSiteKey}\n    />\n  );\n}\n"],"names":["ForgotPassword","setOpenPage","isEnabledOnStorefront","storefrontSiteKey","logo","isMobile","useMobile","isLoading","setLoading","useState","b3Lang","useB3Lang","forgotPasswordFields","getForgotPasswordFields","isCaptchaMissing","setIsCaptchaMissing","captchaKey","setCaptchaKey","control","handleSubmit","getValues","errors","setValue","watch","useForm","navigate","useNavigate","emailAddressReset","useEffect","handleLoginClick","data","emailAddress","requestResetPassword","e","b2bLogger","sendEmail","jsx","B3Card","jsxs","Box","LoginImage","ImageListItem","Typography","B3CustomForm","Captcha","B3Spin","B3ResetPassWordButton","CustomButton","Page","useContext","GlobalContext","loginPageDisplay","CustomStyleContext","setIsEnabledOnStorefront","setStorefrontSiteKey","response","getStorefrontToken"],"mappings":"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"}