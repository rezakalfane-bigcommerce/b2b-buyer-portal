import{j as s,o as ts,K as is,ad as ns,T as W,B as b,w as _,I as M}from"./mui-DDntJqep.js";import{r as i}from"./reactVendor-BTcQ-GDs.js";import{u as H}from"./lang-o717ABxZ.js";import{u as j,a0 as V,ab as J,b9 as os,ba as as,c5 as rs,c6 as cs,ag as T,c7 as ps,c8 as ls,af as K,r as ds,am as us,ar as hs,au as ms,ad as gs,ai as fs,a as Ls,G as Ss,ac as xs,ak as Cs,t as Bs,bJ as ys,c9 as bs,ca as js,bb as Is,bc as Ps}from"./react-setup-BZUAuJbV.js";import{B as ks}from"./B3Filter-CcvXJWrC.js";import"./load-functions-KyGF85Ss.js";import"./base-BCVDEF8S.js";import{d as vs,a as Es,u as Fs}from"./Edit-DrbG26cO.js";import{u as ws}from"./form-hNmOEDBo.js";import{B as Rs}from"./B3CustomForm-DbCZxrBC.js";import{g as As,S as zs,u as Ds}from"./ShoppingStatus-BVDXi2KL.js";import{u as Ns}from"./router-DEI8QtBD.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"./lodashEs-DKEtmQJE.js";import"../index.DCYrHh9G.js";import"./global-D7Yn0gGb.js";import"./muiIcon-CopSbzbS.js";import"./dateFns-CHpGt2JZ.js";import"./dropzone-CFnPmSOi.js";import"./B3FilterMore-BUscL8su.js";import"./B3FilterSearch-DJY7cQ6l.js";function Os({renderList:C,isB2BUser:e},B){const S=j(V),{selectCompanyHierarchyId:d}=j(({company:p})=>p.companyHierarchyInfo),[f,m]=i.useState(!1),[a,g]=i.useState(""),[n,u]=i.useState(null),[I,h]=i.useState(!1),[L,P]=i.useState([]),c=H(),{control:o,handleSubmit:E,getValues:F,formState:{errors:w},clearErrors:D,setValue:y}=ws({mode:"onSubmit"});i.useEffect(()=>{f&&a!=="add"&&n&&L.forEach(p=>{y(p.name,n[p.name])})},[n,f,y,a,L]);const k=()=>{L.forEach(p=>{y(p.name,"")}),D(),m(!1)},N=()=>{E(async p=>{h(!0);try{const l={...p};let x=e?os:as,R=c("shoppingLists.addSuccess");if(a==="edit")e?(x=rs,l.status=n==null?void 0:n.status):(x=cs,l.channelId=T),l.id=(n==null?void 0:n.id)||0,R=c("shoppingLists.updateSuccess");else if(a==="dup")x=e?ps:ls,l.sampleShoppingListId=(n==null?void 0:n.id)||0,R=c("shoppingLists.duplicateSuccess");else if(a==="add")if(e){const{submitShoppingListPermission:O}=S;d&&(l.companyId=Number(d)),l.status=O?30:0}else l.channelId=T;await x(l),k(),K.success(R),C()}finally{h(!1)}})()},z=(p,l)=>{const x=As(c);P(x),l&&u(l),g(p),m(!0)};i.useImperativeHandle(B,()=>({handleOpenAddEditShoppingListsClick:z}));const v=()=>c(a==="edit"?"shoppingLists.edit":a==="add"?"shoppingLists.createNewShoppingList":"shoppingLists.duplicateShoppingList");return s.jsx(J,{isOpen:f,title:v(),leftSizeBtn:c("shoppingLists.cancel"),rightSizeBtn:c("shoppingLists.save"),handleLeftClick:k,handRightClick:N,loading:I,children:s.jsx(Rs,{formFields:L,errors:w,control:o,getValues:F,setValue:y})})}const Ms=i.forwardRef(Os);var $={},Us=ts;Object.defineProperty($,"__esModule",{value:!0});var X=$.default=void 0,qs=Us(ds()),Ts=s;X=$.default=(0,qs.default)((0,Ts.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const _s=_("div")(()=>({display:"flex",alignItems:"center",justifyContent:"space-between"})),U=_(W)(()=>({fontWeight:"500",paddingRight:"5px"})),q=_(b)(()=>({display:"flex",alignItems:"center",justifyContent:"start"}));function Hs(C){const{item:e,onEdit:B,onDelete:S,onCopy:d,isPermissions:f,isB2BUser:m}=C,a=H(),[g,n]=i.useState(!0),{submitShoppingListPermission:u,approveShoppingListPermission:I}=j(V),h=o=>u?!(o===30||o===0):o===40,L=o=>u?!(o===20||o===30):!1,P=Ns(),c=o=>P("/shoppingList/".concat(o.id),{state:{from:"shoppingList"}});return i.useEffect(()=>{if(m){const{companyInfo:o,customerInfo:E}=e,{shoppingListCreateActionsPermission:F}=us,w=hs({code:F,companyId:Number((o==null?void 0:o.companyId)||0),userId:Number(E.userId)});n(w)}},[e,m]),s.jsx(is,{sx:{"& .b2b-card-content":{paddingBottom:"16px"}},children:s.jsxs(ns,{className:"b2b-card-content",sx:{color:"#313440"},children:[s.jsx(W,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)",width:"100%",wordBreak:"break-all"},children:e.name}),s.jsxs(b,{sx:{pt:"8px",pb:"20px"},children:[m&&(u||I&&e.approvedFlag)&&s.jsx(b,{sx:{pb:"25px"},children:s.jsx(zs,{status:e.status})}),s.jsx(b,{sx:{width:"100%",wordBreak:"break-all"},children:e.description}),m&&s.jsxs(q,{children:[s.jsx(U,{children:a("shoppingLists.card.createdBy")}),e.customerInfo.firstName," ",e.customerInfo.lastName]}),s.jsxs(q,{children:[s.jsx(U,{children:a("shoppingLists.card.products")}),e.products.totalCount]}),s.jsxs(q,{children:[s.jsx(U,{children:a("shoppingLists.card.lastActivity")}),"".concat(ms(e.updatedAt))]})]}),s.jsxs(_s,{children:[s.jsx(gs,{sx:{m:"0 0 0 -8px",minWidth:0},variant:"text",onClick:()=>c(e),children:a("shoppingLists.card.view")}),s.jsxs(b,{sx:{display:f?"block":"none"},children:[!h(e.status)&&g&&s.jsx(M,{"aria-label":"edit",size:"medium",sx:{marginRight:"8px"},onClick:()=>{B(e)},children:s.jsx(vs,{fontSize:"inherit"})}),s.jsx(M,{"aria-label":"duplicate",size:"medium",sx:{marginRight:"8px"},onClick:()=>{d(e)},children:s.jsx(X,{fontSize:"inherit"})}),!L(e.status)&&g&&s.jsx(M,{"aria-label":"delete",size:"medium",onClick:()=>{S(e)},children:s.jsx(fs,{fontSize:"inherit"})})]})]})]})},e.id)}function Vs(){const C=j(({b2bFeatures:g})=>g.masqueradeCompany.id),e=j(Bs),B=j(({company:g})=>g.companyInfo.id),{shoppingListCreateActionsPermission:S,submitShoppingListPermission:d}=j(V),f=B||C;return{isB2BUser:e,shoppingListCreateActionsPermission:S,submitShoppingListPermission:d,deleteShoppingList:e?bs:js,getUserShoppingLists:e?()=>ys(Number(f),1):()=>Promise.resolve({})}}function ge(){const[C,e]=i.useState(!1),[B,S]=i.useState(!1),[d,f]=i.useState(null),[m,a]=i.useState([]),g=Ds(),[n]=Ls(),u=H(),[I]=Es(),{isB2BUser:h,shoppingListCreateActionsPermission:L,submitShoppingListPermission:P,deleteShoppingList:c,getUserShoppingLists:o}=Vs(),{state:{openAPPParams:E},dispatch:F}=i.useContext(Ss);i.useEffect(()=>{(async()=>{a(g(P,await o()))})(),E.shoppingListBtn&&F({type:"common",payload:{openAPPParams:{quoteBtn:"",shoppingListBtn:""}}})},[]);const w=Fs(),D={isEnabled:h?L:!0,customLabel:u("shoppingLists.createNew"),customButtonStyle:{fontSize:"15px",fontWeight:"500",width:"140px",padding:"0"}},y=P?"":[0,40],k={search:"",createdBy:"",status:y,isDefault:!0},[N,z]=i.useState(k),v=i.useRef(null),p=()=>{var t;(t=I.current)==null||t.refresh()},l=(t,r)=>{if(t==="search"){const A={...k,search:r};z(A)}},x=t=>{const{status:r}=t,A=r===""||r===99?y:r,es={...k,createdBy:t.createdBy,status:A,isDefault:r===""};z(es)},R=async t=>{const{edges:r,totalCount:A}=h?await Is(t):await Ps({offset:t.offset,first:t.first,search:t.search,channelId:T});return{edges:r,totalCount:A}},O=()=>{var t;(t=v.current)==null||t.handleOpenAddEditShoppingListsClick("add")},Q=t=>{var r;(r=v.current)==null||r.handleOpenAddEditShoppingListsClick("edit",t)},Y=t=>{var r;(r=v.current)==null||r.handleOpenAddEditShoppingListsClick("dup",t)},Z=t=>{f(t),S(!0)},G=()=>{S(!1)},ss=async()=>{if(d)try{e(!0),G(),await c((d==null?void 0:d.id)||0),K.success(u("shoppingLists.deleteSuccess"))}finally{e(!1),p()}};return s.jsx(xs,{isSpinning:C,children:s.jsxs(b,{sx:{display:"flex",flexDirection:"column",flex:1},children:[s.jsx(ks,{showB3FilterMoreIcon:h,filterMoreInfo:m,handleChange:l,handleFilterChange:x,customButtonConfig:D,handleFilterCustomButtonClick:O}),s.jsx(Cs,{columnItems:[],ref:I,rowsPerPageOptions:[12,24,36],getRequestList:R,searchParams:N,isCustomRender:!0,itemXs:w?3:4,requestLoading:e,renderItem:t=>s.jsx(Hs,{item:t,isPermissions:h?L:!0,onEdit:Q,onDelete:Z,onCopy:Y,isB2BUser:h},t.id||"")}),s.jsx(Ms,{renderList:p,ref:v,isB2BUser:h}),s.jsx(J,{isOpen:B,title:u("shoppingLists.deleteShoppingList"),leftSizeBtn:u("shoppingLists.cancel"),rightSizeBtn:u("shoppingLists.delete"),handleLeftClick:G,handRightClick:ss,row:d,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:s.jsx(b,{sx:{display:"flex",justifyContent:n?"center%":"start",width:n?"100%":"450px",height:"100%"},children:u("shoppingLists.confirmDelete")})})]})})}export{ge as default};
//# sourceMappingURL=index-D-LdPVTv.js.map
