import{j as r,K as ae,ad as re,T as X,w as ne,B as G,I as $}from"./mui-BOgrCzfx.js";import{r as o}from"./reactVendor-BTcQ-GDs.js";import{u as Q}from"./lang-D1hDrxfH.js";import{u as L,ab as W,aJ as P,af as Z,ag as le,am as ee,ar as K,ai as oe,ah as ie,a as de,aj as ce,a0 as ue,bs as me,ac as fe,ak as pe}from"./react-setup-Ceu1rkpw.js";import{B as xe}from"./B3Filter-C2nFVgTN.js";import"./load-functions-BIyT0cKp.js";import{b as ge}from"./base-BCVDEF8S.js";import{d as he,u as be,a as ye}from"./Edit-B5D5DWrB.js";import{g as Ie,b as Ce,a as Ee,d as Re,e as Ne}from"./users-CaDR22O0.js";import{u as Fe}from"./form-hNmOEDBo.js";import{l as Ue}from"./lodashEs-DKEtmQJE.js";import{B as Se}from"./B3CustomForm-DysrR7vP.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.Dxi-ailt.js";import"./global-D7Yn0gGb.js";import"./router-DEI8QtBD.js";import"./muiIcon-dPEugcco.js";import"./dateFns-DCN-lSH3.js";import"./dropzone-BroiqFaF.js";import"./B3FilterMore-Bo_zU5Pg.js";import"./B3FilterSearch-OtVT6Fm0.js";const Be=()=>[{label:"Admin",name:"Admin",value:0,idLang:"userManagement.userRole.admin"},{label:"Senior buyer",name:"Senior Buyer",value:1,idLang:"userManagement.userRole.seniorBuyer"},{label:"Junior buyer",name:"Junior Buyer",value:2,idLang:"userManagement.userRole.juniorBuyer"}],se=c=>[{name:"companyRoleId",label:c("userManagement.config.userRole"),required:!1,default:"",defaultName:"",fieldType:"roleAutocomplete",xs:12,disabled:!1,variant:"filled",size:"small"}],Me=(c,n,l=!1)=>{const u=se(n);return u[0].required=!0,u[0].disabled=l,[...u,{name:"email",label:n("userManagement.config.email"),required:!0,fieldType:"text",xs:12,disabled:c==="edit",default:"",variant:"filled",size:"small"},{name:"firstName",label:n("userManagement.config.firstName"),required:!0,default:"",fieldType:"text",xs:6,variant:"filled",size:"small"},{name:"lastName",label:n("userManagement.config.lastName"),required:!0,fieldType:"text",xs:6,default:"",variant:"filled",size:"small"},{name:"phone",label:n("userManagement.config.phoneNumber"),required:!1,fieldType:"text",xs:12,default:"",variant:"filled",size:"small"}]},Le={3:"global.emailValidate.multipleCustomer",4:"global.emailValidate.companyUsed",5:"global.emailValidate.alreadyExits",6:"global.emailValidate.usedSuperAdmin"},je={0:"text",1:"multiline",2:"number",3:"dropdown"},ke=c=>c.map(l=>{const{listOfValue:u}=l,i=je[l.fieldType],x={isExtraFields:!0,name:l.fieldName,label:l.labelName,required:l.isRequired,default:l.defaultValue||"",fieldType:i,xs:12,variant:"filled",size:"small"};switch(i){case"dropdown":if(u){const a=u==null?void 0:u.map(y=>({label:y,value:y}));a.length>0&&(x.options=a)}break;case"number":x.max=l.maximumValue||"";break;case"mutiline":x.rows=l.numberOfRows||"";break;default:x.maxLength=l.maximumLength||"";break}return x}),we=async()=>{let c=[];try{const{userExtraFields:n}=await Ie(),l=n.filter(i=>i.visibleToEnduser);c=ke(l)}catch(n){ge.error(n)}return c};function Ae({companyId:c,renderList:n},l){const u=L(({company:s})=>s.customer.b2bId),[i,x]=o.useState(!1),[a,y]=o.useState(""),[b,j]=o.useState(null),[k,I]=o.useState(!1),[C,B]=o.useState([]),[h,M]=o.useState([]),g=Q(),{control:F,handleSubmit:m,getValues:w,formState:{errors:T},clearErrors:E,setValue:U,setError:O}=Fe({mode:"onSubmit"}),q=async()=>{const s=await we();M(s)};o.useEffect(()=>{h.length===0&&q()},[h.length]);const _=s=>{const t=Object.keys(s),f=[];return h.forEach(p=>{if(t.includes(p.name)){const R={fieldName:p.name||"",fieldValue:s[p.name]||""};f.push(R)}}),f};o.useEffect(()=>{if(i){const s=C.map(t=>{const f=t;return a==="edit"&&b&&U(t.name,b[t.name]),f});B(s)}},[b,i,a]);const v=()=>{C.forEach(s=>{U(s.name,""),s.isExtraFields&&U(s.name,s.default||"")}),E(),x(!1)},z=async s=>{const{userType:t,userInfo:{companyName:f}}=await Ee({email:s,companyId:c,channelId:le}),p=[P.DOES_NOT_EXIST,P.B2C,P.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL].includes(t);return p||O("email",{type:"custom",message:g(Le[t],{companyName:f?"(".concat(f,")"):"",email:s})}),{isValid:p,userType:t}},D=()=>{m(async s=>{I(!0);const t=_(s);let f=g("userManagement.addUserSuccessfully");try{const p={companyId:c,companyRoleId:Number(s.companyRoleId),...s,extraFields:t};if(a!=="edit"){const{isValid:R,userType:S}=await z(s.email);if(!R){I(!1);return}S===P.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL&&(p.addChannel=!0,f=g("userManagement.userDetected",{email:s.email}))}a==="edit"&&(p.userId=(b==null?void 0:b.id)||"",f=g("userManagement.updateUserSuccessfully"),delete p.email),await Ce(p),v(),Z.success(f),n()}finally{I(!1)}})()},V=(s,t)=>{const f=Me(s,g,s==="edit"?u===Number(t.id):!1);if(s==="edit"){const R=t.extraFields||[];let S=t;if(R&&R.length>0){const e={};R.forEach(d=>{e[d.fieldName]=d.fieldValue}),S={...t,...e}}j(S);const A=f.find(e=>e.name==="companyRoleId")||null;A&&(A.defaultName=(t==null?void 0:t.companyRoleName)||"",A.default=(t==null?void 0:t.companyRoleId)||"")}const p=Ue(f,h);B(p),y(s),x(!0)};return o.useImperativeHandle(l,()=>({handleOpenAddEditUserClick:V})),r.jsx(W,{isOpen:i,title:g(a==="edit"?"userManagement.editUser":"userManagement.addNewUser"),leftSizeBtn:g("userManagement.cancel"),rightSizeBtn:g("userManagement.saveUser"),handleLeftClick:v,handRightClick:D,loading:k,isShowBordered:!0,children:r.jsx(Se,{formFields:C,errors:T,control:F,getValues:w,setValue:U})})}const Te=o.forwardRef(Ae),ve=ne("div")(()=>({display:"flex",alignItems:"center",justifyContent:"space-between"}));function De(c){const{item:n,onEdit:l,onDelete:u}=c,{companyInfo:i,id:x,companyRoleName:a,firstName:y,lastName:b,email:j}=n,{userUpdateActionsPermission:k,userDeleteActionsPermission:I}=ee,C=K({code:k,companyId:Number((i==null?void 0:i.companyId)||0),userId:Number(x)}),B=K({code:I,companyId:Number((i==null?void 0:i.companyId)||0),userId:Number(x)}),h=()=>Be().map(m=>Number(m.value)===2?a!=="Junior Buyer"?{color:"#ce93d8",textColor:"black",...m,label:a,name:a}:{color:"#D9DCE9",textColor:"black",...m}:Number(m.value)===1?{color:"rgba(237, 108, 2, 0.3)",textColor:"black",...m}:{color:"#C4DD6C",textColor:"black",...m}),M=g=>{const m=h().find(w=>w.name===g);return m?r.jsx(ie,{color:m.color,textColor:m.textColor,children:m.label}):null};return r.jsx(ae,{children:r.jsxs(re,{sx:{color:"#313440"},children:[r.jsxs(X,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)"},children:[y," ",b]}),r.jsx(X,{sx:{p:"15px 0"},variant:"body1",children:j}),r.jsxs(ve,{children:[M(a),r.jsxs(G,{children:[C&&r.jsx($,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{l(n)},children:r.jsx(he,{fontSize:"inherit"})}),B&&r.jsx($,{"aria-label":"delete",size:"small",onClick:()=>{u(n)},children:r.jsx(oe,{fontSize:"inherit"})})]})]})]})},x)}function is(){const[c,n]=o.useState(!1),[l,u]=o.useState(!1),[i,x]=o.useState({createdAt:0,email:"",firstName:"",id:"",lastName:"",phone:"",role:0,updatedAt:0,extraFields:[],companyRoleName:"",companyRoleId:"",masqueradingCompanyId:"",companyInfo:null}),a=Q(),[y]=de(),b=be(),j=L(({b2bFeatures:e})=>e.masqueradeCompany.id),k=L(({company:e})=>e.customer.role),I=L(({company:e})=>e.companyInfo),C=Number(k)===ce.SUPER_ADMIN?j:I==null?void 0:I.id,B=L(ue),{selectCompanyHierarchyId:h}=L(({company:e})=>e.companyHierarchyInfo),M=B.userCreateActionsPermission,g=o.useMemo(()=>{const{userCreateActionsPermission:e}=ee,d=me(e,Number(h));return{isEnabled:M&&d,customLabel:a("userManagement.addUser")}},[M,h]),F=o.useRef(null),[m]=ye(),w={search:"",companyRoleId:"",companyId:C,q:""},T=se(a),[E,U]=o.useState(w),[O,q]=o.useState(T),[_,v]=o.useState(""),z=async e=>{const d=await Re(e),{users:{edges:N,totalCount:H}}=d;return{edges:N,totalCount:H}},D=()=>{var e;(e=m.current)==null||e.refresh()},V=()=>{const e=T.map(d=>{var Y;const N=d,H=(Y=d.options)==null?void 0:Y.map(J=>{const te=J;return te.label=a(J.idLang),J});return N.options=H,N.setValueName=v,N.default=E.companyRoleId,N.defaultName=E.companyRoleId?_:"",d});return q(e),e},s=(e,d)=>{const N={...E,q:d};U(N)},t=e=>{const d={...E,companyRoleId:e.companyRoleId,offset:0};U(d)},f=()=>{var e;(e=F.current)==null||e.handleOpenAddEditUserClick("add")},p=e=>{var d;(d=F.current)==null||d.handleOpenAddEditUserClick("edit",e)},R=e=>{x(e),u(!0)},S=()=>{u(!1)},A=async e=>{if(e)try{n(!0),S(),await Ne({userId:e.id||"",companyId:h||C}),Z.success(a("userManagement.deleteUserSuccessfully"))}finally{n(!1),D()}};return o.useEffect(()=>{V()},[E,E.companyRoleId]),r.jsx(fe,{isSpinning:c,children:r.jsxs(G,{sx:{display:"flex",flexDirection:"column",flex:1},children:[r.jsx(xe,{filterMoreInfo:O,handleChange:s,handleFilterChange:t,customButtonConfig:g,handleFilterCustomButtonClick:f}),r.jsx(pe,{ref:m,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:z,searchParams:E||{},isCustomRender:!0,itemXs:b?3:4,requestLoading:n,renderItem:e=>r.jsx(De,{item:e,onEdit:p,onDelete:R},e.id||"")}),r.jsx(Te,{companyId:h||C,renderList:D,ref:F}),r.jsx(W,{isOpen:l,title:a("userManagement.deleteUser"),leftSizeBtn:a("userManagement.cancel"),rightSizeBtn:a("userManagement.delete"),handleLeftClick:S,handRightClick:A,row:i,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:r.jsx(G,{sx:{display:"flex",justifyContent:y?"center%":"start",width:y?"100%":"450px",height:"100%"},children:a("userManagement.confirmDelete")})})]})})}export{is as default};
//# sourceMappingURL=index-DDSxH1tf.js.map
