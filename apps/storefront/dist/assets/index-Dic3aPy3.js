import{j as n,I as cn,s as ln,Y as Q,X as dn,G as ie,B as p,T as S,d as fe,L as Pe,ae as ke,f as Ae,ag as Be,x as un}from"./mui-BLXOPN2Y.js";import{r as u}from"./reactVendor-BTcQ-GDs.js";import{u as K}from"./lang-DZEhsX8V.js";import{f as je}from"./lodashEs-DKEtmQJE.js";import{u as E,a0 as De,am as Te,ar as pn,af as re,a as ce,as as oe,ah as mn,ab as Le,ac as le,at as Fe,au as Z,av as he,aw as ae,ax as xn,a4 as fn,ay as hn,G as yn,ak as bn,aj as gn,az as we}from"./react-setup-Dk2lMx-W.js";import"./load-functions-adwiw1MZ.js";import{b as me}from"./base-BCVDEF8S.js";import{i as vn,g as Oe,f as W,a as Cn,b as In,c as jn,e as wn,d as Sn}from"./payment-DJqhQqMV.js";import{u as Nn}from"./useSort-CwDaxthI.js";import{B as Pn}from"./B2BAutoCompleteCheckbox-BzccPesl.js";import{B as kn}from"./B3Filter-DubIZzth.js";import{d as An}from"./MoreHoriz-DdgZHNSz.js";import{u as de,a as Bn}from"./router-DEI8QtBD.js";import{R as Dn}from"./resizable-C5N8YmSB.js";import{P as Tn}from"./pdfobject-DRLodwXF.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.COFs9ak5.js";import"./global-D7Yn0gGb.js";import"./muiIcon-DcrdeM0-.js";import"./dateFns-CXOS6Mtj.js";import"./dropzone-BOmS2zFM.js";import"./b3checkout-DzpbYa4z.js";import"./B3FilterMore-D_dyTzyv.js";import"./form-hNmOEDBo.js";import"./B3CustomForm-WDZRXEWC.js";import"./B3FilterSearch-DKl870sh.js";const Ln=i=>new Promise((t,r)=>{fetch(i).then(a=>a.blob()).then(a=>{const y=new Blob([a],{type:"application/pdf"}),g=window.URL.createObjectURL(y);t(g)}).catch(a=>{r(a)})}),Re=async(i,t=!1)=>{const{invoicePdf:{url:r}}=await vn(Number(i),t);return r},ye=async(i,t=!1)=>{let r="";try{return r=await Re(i,t),await Ln(r)}catch(a){return r}},Fn=ln(dn)(()=>({"& .MuiPaper-elevation":{boxShadow:"0px 1px 0px -1px rgba(0, 0, 0, 0.1), 0px 1px 6px rgba(0, 0, 0, 0.07), 0px 1px 4px rgba(0, 0, 0, 0.06)",borderRadius:"4px"}}));function Ee({row:i,setIsRequestLoading:t,setInvoiceId:r,handleOpenHistoryModal:a,isCurrentCompany:y,invoicePay:g}){const f=E(({global:v})=>v.storeInfo.platform),x=u.useRef(null),[T,A]=u.useState(!1),[d,D]=u.useState(!0),I=de(),N=K(),{invoicePayPermission:C,purchasabilityPermission:$}=E(De),{getOrderPermission:O}=Te,[F,V]=u.useState(!1),P=()=>{A(!1)},_=()=>{const{id:v}=i;r(v),A(!0)},z=async v=>{const{id:k}=i;P(),t(!0);const L=await ye(k,v);if(t(!1),!L){re.error("pdf url resolution error");return}const{href:j}=window.location;j.includes("invoice")&&window.open(L,"_blank","fullscreen=yes")},U=()=>{const{orderNumber:v}=i;P(),I("/orderDetail/".concat(v))},X=async()=>{P();const{openBalance:v,originalBalance:k,id:L}=i,j={lineItems:[{invoiceId:Number(L),amount:v.value==="."?"0":"".concat(Number(v.value))}],currency:(v==null?void 0:v.code)||k.code};if(v.value==="."||Number(v.value)===0){re.error("The payment amount entered has an invalid value.",{isClose:!0});return}await Oe(j,f,!1)},ee=async()=>{P(),a(!0)},B=async()=>{const{id:v}=i;P(),t(!0);const k=await Re(v);t(!1);const L=document.createElement("a");L.href=k,L.target="_blank",L.download="file.pdf",L.click()};return u.useEffect(()=>{const{openBalance:v,orderUserId:k,companyInfo:L}=i,j=Number(v.value)>0&&C&&$;D(j),D(y?j:j&&g);const M=pn({code:O,companyId:Number(L.companyId),userId:Number(k)});V(M)},[]),n.jsxs(n.Fragment,{children:[n.jsx(cn,{onClick:_,ref:x,children:n.jsx(An,{})}),n.jsxs(Fn,{id:"basic-menu",anchorEl:x.current,open:T,onClose:P,MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[n.jsx(Q,{sx:{color:"primary.main"},onClick:()=>z(i.status!==2&&C&&$),children:N("invoice.actions.viewInvoice")},"View-invoice"),F&&n.jsx(Q,{sx:{color:"primary.main"},onClick:U,children:N("invoice.actions.viewOrder")},"View-Order"),i.status!==0&&n.jsx(Q,{sx:{color:"primary.main"},onClick:ee,children:N("invoice.actions.viewPaymentHistory")},"View-payment-history"),d&&n.jsx(Q,{sx:{color:"primary.main"},onClick:X,children:N("invoice.actions.pay")},"Pay"),n.jsx(Q,{sx:{color:"primary.main"},onClick:()=>z(i.status!==2&&C&&$),children:N("invoice.actions.print")},"Print"),n.jsx(Q,{sx:{color:"primary.main"},onClick:()=>B(),children:N("invoice.actions.download")},"Download")]})]})}function On(i){const t=E(({global:N})=>N.storeInfo.platform),r=K(),[a]=ce(),[y,g]=u.useState(0),[f,x]=u.useState("$"),T=E(({b2bFeatures:N})=>N.masqueradeCompany.isAgenting),A=a?{alignItems:"flex-start",flexDirection:"column"}:{alignItems:"center"},{selectedPay:d,decimalPlaces:D}=i,I=async()=>{const N=[];let C="SGD";if(d.length>0){if(d.forEach(F=>{const{node:{id:V,openBalance:P,originalBalance:_}}=F,z=W(Number(P.originValue),D)===P.value?Number(P.originValue):Number(P.value);N.push({invoiceId:Number(V),amount:P.value==="."?"0":"".concat(Number(z))}),C=(P==null?void 0:P.code)||_.code}),N.find(F=>F.amount==="."||Number(F.amount)===0)){re.error(r("invoice.footer.invalidNameError"),{isClose:!0});return}await Oe({lineItems:N,currency:C},t,!1)}};return u.useEffect(()=>{if(d.length>0){const N=O=>{let F=0;O.forEach(V=>{const{node:{openBalance:P}}=V;F+=P.value==="."?0:Number(P.value)}),g(W(F,D))},{node:{openBalance:C}}=d[0],$=oe(C.code);x($),N(d)}},[D,d]),n.jsxs(ie,{sx:{position:"fixed",bottom:a&&T?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:a?"0 0 1rem 0":"0 40px 1rem 40px",height:a?"8rem":"auto",marginLeft:0,display:"flex",flexWrap:"nowrap",zIndex:"999"},container:!0,spacing:2,children:[n.jsx(ie,{item:!0,sx:{display:a?"none":"block",width:"290px",paddingLeft:"20px"}}),n.jsx(ie,{item:!0,sx:a?{flexBasis:"100%"}:{flexBasis:"690px",flexGrow:1},children:n.jsxs(p,{sx:{width:"100%",pr:"20px",display:"flex",zIndex:"999",justifyContent:"space-between",...A},children:[n.jsx(S,{sx:{color:"#000000",fontSize:"16px",fontWeight:"400"},children:r("invoice.footer.invoiceSelected",{invoices:d.length})}),n.jsxs(p,{sx:{display:"flex",alignItems:"center",flexWrap:a?"wrap":"nowrap",width:a?"100%":"auto"},children:[n.jsx(S,{variant:"h6",sx:{fontSize:"16px",fontWeight:"700",color:"#000000"},children:r("invoice.footer.totalPayment",{total:"".concat(f).concat(y)})}),n.jsx(p,{sx:{display:"flex",alignItems:"center",marginTop:a?"0.5rem":0,width:a?"100%":"auto"},children:n.jsx(fe,{variant:"contained",sx:{marginLeft:a?0:"1rem",width:a?"100%":"auto"},onClick:()=>{I()},children:r("invoice.footer.payInvoices")})})]})]})}),n.jsx(ie,{item:!0,sx:a?{flexBasis:"100%",display:a?"none":"block"}:{flexBasis:"0",display:a?"none":"block"}})]})}function $e(i){const{code:t}=i,a=(y=>({0:{textColor:"#000000",name:"Open",color:"#F1C224"},1:{textColor:"#FFFFFF",name:"Partially paid",color:"#516FAE"},2:{textColor:"#000000",name:"Paid",color:"#C4DD6C"},3:{textColor:"#FFFFFF",name:"Overdue",color:"#D32F2F"}})[y]||{})(t);return a.name?n.jsx(mn,{color:a.color,textColor:a.textColor,children:a.name}):null}function te({title:i}){return n.jsxs(S,{sx:{fontWeight:"bold",pr:"5px"},children:[i,":"]})}function Rn({list:i}){return n.jsx(n.Fragment,{children:i.map(t=>{const{node:{createdAt:r,amount:a,paymentType:y,transactionType:g,referenceNumber:f,id:x}}=t;return n.jsx(Pe,{sx:{mb:"10px"},children:n.jsxs(ke,{sx:{color:"#313440",wordBreak:"break-word"},children:[n.jsxs(p,{sx:{display:"flex"},children:[n.jsx(te,{title:"Date received"}),n.jsx(S,{variant:"body1",children:"".concat(Z(Number(r)))})]}),n.jsxs(p,{sx:{display:"flex"},children:[n.jsx(te,{title:"Amount"}),n.jsx(S,{variant:"body1",children:he(a.code,Number((a==null?void 0:a.value)||0))})]}),n.jsxs(p,{sx:{display:"flex"},children:[n.jsx(te,{title:"Transaction type"}),n.jsx(S,{variant:"body1",children:g})]}),n.jsxs(p,{sx:{display:"flex"},children:[n.jsx(te,{title:"Payment type"}),n.jsx(S,{variant:"body1",children:y})]}),n.jsxs(p,{sx:{display:"flex"},children:[n.jsx(te,{title:"Reference"}),n.jsx(S,{variant:"body1",children:f||"–"})]})]})},x)})})}function En({open:i,setOpen:t,currentInvoiceId:r}){const a=K(),[y]=ce(),[g,f]=u.useState(!1),[x,T]=u.useState([]);return u.useEffect(()=>{i&&r&&(async()=>{f(!0);const{allReceiptLines:{edges:d=[]}}=await Cn(Number(r));T(d),f(!1)})()},[i,r]),n.jsx(Le,{isOpen:i,leftSizeBtn:"",rightSizeBtn:"ok",title:a("invoice.paymentHistory.title"),showLeftBtn:!1,handRightClick:()=>t(!1),children:n.jsx(p,{sx:{width:y?"100%":"384px",maxHeight:"600px"},children:n.jsx(le,{isSpinning:g,children:n.jsx(p,{sx:{display:"flex",flexDirection:"column",flex:1},children:x.length?n.jsx(Rn,{list:x}):n.jsx(Fe,{})})})})})}const G={NORMAL:"normal",DETAIL:"detail",CHECKOUT:"checkout"},$n=[{key:"open",value:0,label:"Open"},{key:"partialPaid",value:1,label:"Partially paid"},{key:"paid",value:2,label:"Paid"},{key:"overdue",value:3,label:"Overdue"}],Vn=[{name:"status",label:"Status",required:!1,default:"",fieldType:"dropdown",xs:12,variant:"filled",size:"small",options:$n}],Se={status:"invoice.filterStatus.title",open:"invoice.filterStatus.open",partialPaid:"invoice.filterStatus.partiallyPaid",paid:"invoice.filterStatus.paid",overdue:"invoice.filterStatus.overdue"},Ve="id",He={id:"invoiceNumber",orderNumber:"orderNumber",createdAt:"createdAt",updatedAt:"dueDate",originalBalance:"originalBalanceAmount",openBalance:"openBalanceAmount",status:"status"},Ne={invoiceNumber:"invoice_number",orderNumber:"order_number",createdAt:"created_at",dueDate:"due_date",originalBalanceAmount:"original_balance_amount",openBalanceAmount:"open_balance_amount"};function xe({title:i,withColon:t=!0}){return n.jsx(S,{sx:{fontWeight:"bold",pr:"5px"},children:t?"".concat(i,":"):i})}function Hn({isRow:i=!0,type:t="",value:r,label:a,code:y}){const g=()=>{if(t==="time")return Z(Number(r))||"";if(t==="currency"){const f=Number(r||0);return he(y,f)}if(t==="paymentType"){let f="".concat(r).trim();return r&&(f=f.slice(0,1).toUpperCase()+f.slice(1).toLowerCase()),f}return r||"–"};return n.jsxs(p,{sx:{display:"flex",flexDirection:i?"row":"column"},children:[n.jsx(xe,{title:a}),n.jsx(S,{variant:"body1",children:"".concat(g())})]})}function zn({list:i}){var f;const{receiptLineSet:{edges:t=[]},details:r}=i,a=((f=r==null?void 0:r.paymentDetails)==null?void 0:f.comment)||"",y=K(),g=[{key:"paymentId",label:"Payment#",type:"",isRow:!0,idLang:"payment.paymentNumber"},{key:"createdAt",label:"Payment received on",type:"time",isRow:!0,idLang:"payment.paymentReceivedOn"},{key:"transactionType",label:"Transaction type",type:"",isRow:!0,idLang:"payment.transactionType"},{key:"paymentType",label:"Payment type",type:"paymentType",isRow:!0,idLang:"payment.paymentType"},{key:"totalAmount",label:"Payment total",type:"currency",isRow:!0,idLang:"payment.paymentTotal"},{key:"referenceNumber",label:"Reference",type:"",isRow:!0,idLang:"payment.reference"}];return n.jsxs(p,{children:[g.map(x=>n.jsx(Hn,{isRow:!!x.isRow,type:x.type,value:i[x.key],code:(i==null?void 0:i.totalCode)||"SGD",label:y(x.idLang)})),n.jsxs(p,{sx:{display:"flex",flexDirection:"column",mb:"30px"},children:[n.jsx(xe,{title:y("payment.paymentComment")}),n.jsx(S,{sx:{maxHeight:"50px"},children:a})]}),n.jsxs(p,{sx:{display:"flex",flexDirection:"column"},children:[n.jsx(xe,{title:y("payment.invoicesPaid"),withColon:!1}),n.jsxs(S,{variant:"body1",children:[y("payment.paymentTowardsInvoices")," "]})]}),n.jsxs(p,{children:[n.jsxs(p,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between",fontWeight:500},children:[n.jsx(S,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:y("payment.invoiceNumber")}),n.jsx(S,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:y("payment.amountPaid")})]}),t.map(x=>{const{invoiceNumber:T,amount:{value:A,code:d}}=x.node,D=Number(A||0),I=he(d,D);return n.jsxs(p,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between"},children:[n.jsx(S,{children:T}),n.jsx(S,{children:I})]})})]})]})}function Un({receiptId:i,type:t}){const[r]=ce(),[a,y]=u.useState(!1),[g,f]=u.useState(!1),[x,T]=u.useState(null),A=de(),d=K();u.useEffect(()=>{const N=async()=>{y(!0);const{receipt:C}=await In(Number(i));T(C),f(!0),y(!1)};t===G.CHECKOUT&&i&&N()},[i,t]);const D=()=>{f(!1),A("/invoice")},I=()=>n.jsx(fe,{onClick:D,variant:"text",children:d("payment.okButton")});return n.jsx(Le,{isOpen:g,leftSizeBtn:"",customActions:I,title:d("payment.paymentSuccess"),showLeftBtn:!1,children:n.jsx(p,{sx:{width:r?"100%":"384px",maxHeight:"600px"},children:n.jsx(le,{isSpinning:a,children:n.jsx(p,{sx:{display:"flex",flexDirection:"column",flex:1},children:x?n.jsx(zn,{list:x}):n.jsx(Fe,{})})})})})}const Mn=300;function Wn({row:i}){var T,A;const t=u.useRef(null),r=u.useRef(null),[a,y]=u.useState(!1),[g,f]=u.useState(Mn),x=(d,{size:D})=>{f(D.height)};return u.useEffect(()=>((async()=>{y(!0);const{id:D}=i,I=await ye(D);if(!I){re.error("pdf url resolution error");return}t!=null&&t.current&&(Tn.embed(I,t.current),y(!1))})(),()=>{t.current=null}),[i]),n.jsx(le,{isSpinning:a,children:n.jsx(p,{ref:r,sx:{display:"flex",flexWrap:"wrap",width:"100%","& .box":{display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",width:"100%","& .react-resizable":{position:"relative"},"& .react-resizable-handle":{position:"absolute",width:"100%",height:"30px",backgroundRepeat:"no-repeat",backgroundOrigin:"content-box",boxSizing:"border-box"},"& .react-resizable-handle-s":{cursor:"ns-resize",bottom:0}}},children:n.jsx(Dn,{className:"box",height:g,minConstraints:[((T=r==null?void 0:r.current)==null?void 0:T.offsetWidth)||0,0],width:((A=r.current)==null?void 0:A.offsetWidth)||0,onResize:x,resizeHandles:["s"],children:n.jsx("div",{style:{width:"100%",height:"".concat(g,"px")},children:n.jsx("div",{ref:t,style:{height:"100%",width:"100%"}})})})})})}const _n=un(p)(()=>({"& > span":{padding:"0 9px 0 0"}}));function qn(i){const t=new Date().getTime(),{item:r,checkBox:a,handleSetSelectedInvoiceAccount:y,handleViewInvoice:g,setIsRequestLoading:f,setInvoiceId:x,handleOpenHistoryModal:T,selectedPay:A=[],handleGetCorrespondingCurrency:d,addBottom:D,isCurrentCompany:I,invoicePay:N}=i,C=K(),$=de(),{id:O,status:F,dueDate:V,openBalance:P,companyInfo:_}=r,z=P.code||"USD",U=d(z);let X=r.status;F===0&&t>V*1e3&&(X=3);const ee=[{key:"orderNumber",title:C("invoice.invoiceItemCardHeader.order"),render:()=>n.jsx(p,{sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{$("/orderDetail/".concat(r.orderNumber))},children:(r==null?void 0:r.orderNumber)||"-"})},{key:"createdAt",title:C("invoice.invoiceItemCardHeader.invoiceDate"),render:()=>"".concat(r.createdAt?Z(Number(r.createdAt)):"–")},{key:"updatedAt",title:C("invoice.invoiceItemCardHeader.dueDate"),render:()=>{const{dueDate:B,status:v}=r,k=t>B*1e3&&v!==2;return n.jsx(S,{sx:{color:k?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:"".concat(r.dueDate?Z(Number(r.dueDate)):"–")})}},{key:"originalBalance",title:C("invoice.invoiceItemCardHeader.invoiceTotal"),render:()=>{const{originalBalance:B}=r,v=Number(B.value);return ae(v||0)}},{key:"openBalance",title:C("invoice.invoiceItemCardHeader.amountDue"),render:()=>{const{openBalance:B}=r,v=Number(B.value);return ae(v||0)}},{key:"openBalanceToPay",title:C("invoice.invoiceItemCardHeader.amountToPay"),render:()=>{const{openBalance:B,id:v}=r;let k=B.value,L=!0;if(A.length>0){const j=A.find(R=>{const{node:{id:M}}=R;return Number(M)===Number(v)});if(j){const{node:{openBalance:R}}=j;L=!1,k=R.value,Number(B.value)===0&&(L=!0)}}return n.jsx(Ae,{disabled:L,variant:"filled",value:k,InputProps:{startAdornment:n.jsx(Be,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:U||"$"})},sx:{"& input":{paddingTop:"8px"}},onChange:j=>{var M;const R=(M=j.target)==null?void 0:M.value;y(R,v)},type:"number"})}}];return n.jsx(Pe,{sx:{marginBottom:A.length>0&&D?"5rem":0},children:n.jsxs(ke,{sx:{color:"rgba(0, 0, 0, 0.6)"},children:[n.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:"0.5rem"},children:[n.jsx(_n,{children:a&&a(!!(r!=null&&r.disableCurrentCheckbox))}),n.jsx(S,{variant:"h6",sx:{color:"rgba(0, 0, 0, 0.87)"},children:n.jsx(p,{sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{g(O,F,_.companyId)},children:O||"-"})})]}),n.jsx(p,{sx:{mb:"0.5rem"},children:n.jsx(Ee,{row:r,setInvoiceId:x,handleOpenHistoryModal:T,setIsRequestLoading:f,isCurrentCompany:I,invoicePay:N})})]}),n.jsx(p,{sx:{mb:"1rem"},children:n.jsx($e,{code:X})}),ee.map(B=>n.jsxs(p,{sx:{display:"flex",alignItems:"center",mt:"4px"},children:[n.jsx(S,{sx:{fontWeight:"bold",color:"rgba(0, 0, 0, 0.87)",mr:"5px",whiteSpace:"nowrap"},children:"".concat(B.title,":")}),n.jsx(p,{sx:{color:"black",wordBreak:"break-all"},children:B!=null&&B.render?B.render():r[B.key]})]},B.key))]})})}const Gn={q:"",first:10,offset:0,orderBy:"-".concat(He[Ve]),companyIds:[]};function Kn(){const i=E(({company:d})=>d.customer.role),t=E(({b2bFeatures:d})=>d.masqueradeCompany.isAgenting),r=E(({company:d})=>d.companyInfo.id),{selectCompanyHierarchyId:a,isEnabledCompanyHierarchy:y}=E(({company:d})=>d.companyHierarchyInfo),g=E(({b2bFeatures:d})=>d.masqueradeCompany.id),{invoicePayPermission:f,purchasabilityPermission:x}=E(De),T=i===gn.SUPER_ADMIN&&t?Number(g):Number(r),{invoice:A}=E(({company:d})=>d.pagesSubsidiariesPermission);return{isAgenting:t,selectCompanyHierarchyId:a,isEnabledCompanyHierarchy:y,invoicePayPermission:f,purchasabilityPermission:x,currentCompanyId:T,invoiceSubViewPermission:A}}function wt(){const i=new Date().getTime(),t=K(),{isAgenting:r,selectCompanyHierarchyId:a,isEnabledCompanyHierarchy:y,invoicePayPermission:g,purchasabilityPermission:f,currentCompanyId:x,invoiceSubViewPermission:T}=Kn(),A=de(),[d]=ce(),D=u.useRef(null),{decimal_places:I=2}=xn(),[N,C]=u.useState(!1),[$,O]=u.useState(!1),[F,V]=u.useState(""),[P,_]=u.useState(""),[z,U]=u.useState(""),[X,ee]=u.useState(0),[B,v]=u.useState(0),[k,L]=u.useState([]),[j,R]=u.useState([]),[M,ze]=u.useState([]),[l,q]=u.useState({}),[Ue,Me]=u.useState(t("invoice.exportCsvText")),[We,ue]=u.useState(!1),[Y,se]=u.useState([]),[be,_e]=u.useState(g),J=fn({level:hn.COMPANY_SUBSIDIARIES,code:Te.invoicePayPermission}),{state:{bcLanguage:qe}}=u.useContext(yn),[Ge,Ke,Xe]=Nn(He,Ve,l,q),ne=Bn(),pe=e=>Object.keys(e).some(o=>o!=="first"&&o!=="offset"&&o!=="orderBy"&&e[o]),Ye=e=>{if(We){se(e),ue(!1);return}Y.length||se(e);const o=[...Y];e.forEach(s=>{const c=(s==null?void 0:s.node)||s;Y.some(m=>m.node.id===c.id)||o.push(s)}),se(o)},Je=async()=>{try{C(!0);const{invoiceStats:e}=await Sn(l!=null&&l.status?Number(l.status):0,Number(I),(l==null?void 0:l.companyIds)||[]);if(e){const{overDueBalance:o,totalBalance:s}=e;ee(Number(W(Number(s),I))),v(Number(W(Number(o),I)))}}catch(e){me.error(e)}finally{C(!1)}},Qe=(e,o)=>{e==="search"&&(q({...l,q:o}),ue(!0),U(G.NORMAL))},Ze=e=>{const o=e!=null&&e.startValue?we(new Date(e==null?void 0:e.startValue).getTime()/1e3):"",s=e!=null&&e.endValue?we(new Date(e==null?void 0:e.endValue).getTime()/1e3,!0):"",c=(e==null?void 0:e.status)===3?0:e==null?void 0:e.status,h={status:"".concat(c)||"",beginDateAt:o,endDateAt:s,beginDueDateAt:(e==null?void 0:e.status)===0?parseInt("".concat(i/1e3),10):"",endDueDateAt:(e==null?void 0:e.status)===3?parseInt("".concat(i/1e3),10):""};q({...l,...h}),ue(!0),U(G.NORMAL)},en=e=>{var o;if(e.length>0){const s=((o=D.current)==null?void 0:o.getCacheList())||[],h=e.map(m=>s.find(w=>{const{node:H}=w;return Number(H.id)===Number(m)})).filter(m=>m&&!m.node.disableCurrentCheckbox);L([...h])}else L([])},ge=async(e,o,s)=>{try{const c=Number(s)===Number(x)?g:J;C(!0);const m=await ye(e,f&&c&&o!==2);if(!m){re.error(t("invoice.pdfUrlResolutionError"));return}const{href:b}=window.location;if(!b.includes("invoice"))return;window.open(m,"_blank","fullscreen=yes")}catch(c){me.error(c)}finally{C(!1)}},nn=(e,o)=>{const s=k.find(c=>{const{node:{id:h}}=c;return Number(h)===Number(o)});if(j.length>0){const c=j.map(h=>{const{node:{id:m,openBalance:b}}=h,{node:{openBalance:w}}=s;return Number(m)===Number(o)&&(b.value=Number(w.value)<Number(e)?w.value:e),h});R(c)}},tn=async()=>{try{C(!0);const s=((l?pe(l):!1)?Y.filter(w=>k.some(H=>{var Ce,Ie;return((Ce=w==null?void 0:w.node)==null?void 0:Ce.id)===((Ie=H==null?void 0:H.node)==null?void 0:Ie.id)})):k).map(w=>w.node.id),c=l!=null&&l.status?[Number(l.status)]:[];let h="-invoice_number";if(l!=null&&l.orderBy){const w=String(l.orderBy);h=w.includes("-")?"-".concat(Ne[w.split("-")[1]]):Ne[w]}const m={search:(l==null?void 0:l.q)||"",idIn:"".concat(s||""),orderNumber:"",beginDateAt:(l==null?void 0:l.beginDateAt)||null,endDateAt:(l==null?void 0:l.endDateAt)||null,status:c,orderBy:h,companyIds:(l==null?void 0:l.companyIds)||[]},{invoicesExport:b}=await wn({invoiceFilterData:m,lang:qe||"en"});b!=null&&b.url&&window.open(b==null?void 0:b.url,"_blank")}catch(e){me.error(e)}finally{C(!1)}};u.useEffect(()=>{const e={...Gn,companyIds:[Number(a)||Number(x)]};if(ne!=null&&ne.search){const o=new URLSearchParams(ne.search),s=o.get("invoiceId")||"",c=o.get("receiptId")||"";s&&(q({...e,q:s}),U(G.DETAIL)),c&&(U(G.CHECKOUT),q({...e}),_(c))}else U(G.NORMAL),q({...e})},[ne,a]);const on=e=>{const o=e.includes(-1)?[]:e;q({...l,companyIds:o}),_e(e.includes(x)||e.includes(-1)?g:J)};u.useEffect(()=>{const e=k.filter(o=>{const{node:{openBalance:s}}=o;return Number(s.value)!==0})||[];if(e.length>0)if(j.length===0)R(je(e));else{const o=e.map(s=>{const{node:{id:c,openBalance:h}}=s,m=j.find(b=>{const{node:{id:w}}=b;return Number(c)===Number(w)});if(m){const{node:{openBalance:b}}=m;h.value=b.value}return s});R(je(o))}else R([])},[k]);const rn=async e=>{const{invoices:{edges:o,totalCount:s}}=await jn(e),c=o;return z===G.DETAIL&&c.length&&c.forEach(h=>{const m=h;m.node.isCollapse=!0}),c.forEach(h=>{const{node:{openBalance:m}}=h,b=h;b.node.disableCurrentCheckbox=!1,m.originValue="".concat(Number(m.value)),m.value=W(Number(m.value),I),b.node.disableCurrentCheckbox=Number(m.value)===0;const{companyInfo:w}=b.node;Number(w.companyId)!==Number(x)&&(b.node.disableCurrentCheckbox=!J||Number(m.value)===0)}),ze(c),Je(),l&&pe(l)&&c.length?Ye(c):se([]),{edges:c,totalCount:s}},ve=(e,o)=>{let s=e;if(e.includes(".")){const c=e.split("."),h=I===0?0:c[1].length-Number(I);if(c[1]&&h>0){const m=c[0]+c[1];s="".concat(m.slice(0,-I),".").concat(m.slice(-I))}c[1]&&h===0&&(s=W(Number(e),I))}else s.length>1?(s="".concat(e.slice(0,1),".").concat(e.slice(-1)),Number(I)===0&&(s=e)):s=e;nn(s,o)},sn=[{key:"id",title:t("invoice.headers.invoice"),isSortable:!0,render:e=>n.jsx(p,{sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},onClick:()=>{const o=(e==null?void 0:e.companyInfo)||{};ge(e.id,e.status,o==null?void 0:o.companyId)},children:e!=null&&e.invoiceNumber?e==null?void 0:e.invoiceNumber:e==null?void 0:e.id}),width:"8%"},{key:"companyInfo",title:t("invoice.headers.companyName"),isSortable:!1,render:e=>{const{companyName:o}=(e==null?void 0:e.companyInfo)||{};return n.jsx(p,{children:o})},width:"15%"},{key:"orderNumber",title:t("invoice.headers.order"),isSortable:!0,render:e=>n.jsx(p,{sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},onClick:()=>{A("/orderDetail/".concat(e.orderNumber))},children:(e==null?void 0:e.orderNumber)||"-"}),width:"12%"},{key:"createdAt",title:t("invoice.headers.invoiceDate"),isSortable:!0,render:e=>"".concat(e.createdAt?Z(Number(e.createdAt)):"–"),width:"15%"},{key:"updatedAt",title:t("invoice.headers.dueDate"),isSortable:!0,render:e=>{const{dueDate:o,status:s}=e,c=i>o*1e3&&s!==2;return n.jsx(S,{sx:{color:c?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:"".concat(e.dueDate?Z(Number(e.dueDate)):"–")})},width:"15%"},{key:"originalBalance",title:t("invoice.headers.invoiceTotal"),isSortable:!0,render:e=>{const{originalBalance:o}=e,s=W(Number(o.value),I),c=oe(o.code);return"".concat(c).concat(s||0)},width:"10%"},{key:"openBalance",title:t("invoice.headers.amountDue"),isSortable:!0,render:e=>{const{openBalance:o}=e,s=W(Number(o.value),I),c=oe(o.code);return"".concat(c).concat(s||0)},width:"10%"},{key:"openBalanceToPay",title:t("invoice.headers.amountToPay"),render:e=>{const{openBalance:o,id:s}=e,c=o.code||"USD";let h=o.value,m=!0;if(j.length>0){const b=j.find(w=>{const{node:{id:H}}=w;return Number(H)===Number(s)});if(b){const{node:{openBalance:w}}=b;m=!1,h=w.value,Number(o.value)===0&&(m=!0)}}return n.jsx(Ae,{disabled:m,variant:"filled",value:h||"",InputProps:{startAdornment:n.jsx(Be,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:oe(c)})},sx:{"& input":{paddingTop:"8px"},'& input[type="number"]::-webkit-inner-spin-button, & input[type="number"]::-webkit-outer-spin-button':{WebkitAppearance:"none",margin:0}},onChange:b=>{var H;const w=(H=b.target)==null?void 0:H.value;ve(w,s)},type:"number"})},width:"15%"},{key:"status",title:t("invoice.headers.status"),isSortable:!0,render:e=>{const{status:o,dueDate:s}=e;let c=e.status;return o===0&&i>s*1e3&&(c=3),n.jsx($e,{code:c})}},{key:"companyName",title:t("invoice.headers.action"),render:e=>{const{id:o,companyInfo:s}=e;let c=e;if(j.length>0){const h=j.find(m=>{const{node:{id:b}}=m;return Number(b)===Number(o)});h&&(c=h.node)}return n.jsx(Ee,{row:c,setInvoiceId:V,handleOpenHistoryModal:O,setIsRequestLoading:C,isCurrentCompany:Number(x)===Number(s.companyId),invoicePay:Number(x)===Number(s.companyId)?g:J})},width:"10%"}];u.useEffect(()=>{let e=t("invoice.exportCsvText");const o=l?pe(l):!1,s=o?Y.filter(c=>k.some(h=>{var m,b;return((m=c==null?void 0:c.node)==null?void 0:m.id)===((b=h==null?void 0:h.node)==null?void 0:b.id)})):k;o?e=s.length>0?t("invoice.exportSelectedAsCsv"):t("invoice.exportFilteredAsCsv"):e=s.length>0?t("invoice.exportSelectedAsCsv"):t("invoice.exportCsvText"),Me(e)},[k,l,Y]);const an=Vn.map(e=>{const o=e;return e.name==="status"&&(o.label=t(Se.status)),o.options=e.options.map(s=>{const c=s;return c.label=t(Se[s.key]),s}),e});return n.jsxs(le,{isSpinning:N,children:[n.jsxs(p,{sx:{overflowX:"auto",display:"flex",flexDirection:"column",flex:1,position:"relative"},children:[n.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:d?"flex-start":"center",flexDirection:d?"column":"row"},children:[n.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:d?"flex-start":"center",flexDirection:d?"column":"row",width:d?"100%":"auto","& > div":{width:d?"100%":"auto"}},children:[y&&T&&n.jsx(p,{sx:{mr:d?0:"10px",mb:"30px"},children:n.jsx(Pn,{handleChangeCompanyIds:on})}),n.jsx(kn,{filterMoreInfo:an,handleChange:Qe,handleFilterChange:Ze,startPicker:{isEnabled:!0,label:t("invoice.filter.from"),defaultValue:typeof(l==null?void 0:l.beginDateAt)=="number"?Number(l.beginDateAt)*1e3:"",pickerKey:"start"},endPicker:{isEnabled:!0,label:t("invoice.filter.to"),defaultValue:typeof(l==null?void 0:l.endDateAt)=="number"?Number(l.endDateAt)*1e3:"",pickerKey:"end"},searchValue:(l==null?void 0:l.q)||"",pcContainerWidth:"36rem",pcSearchContainerWidth:"80%"})]}),n.jsxs(p,{sx:{display:"flex",marginBottom:"30px",flexDirection:document.body.clientWidth<=465?"column":"row"},children:[n.jsx(S,{sx:{fontSize:"24px",color:"#000000"},children:t("invoice.openUnpaid",{unpaid:ae(X)})}),document.body.clientWidth>=465&&n.jsx(S,{sx:{fontSize:"24px",margin:"0 8px"},children:"|"}),n.jsx(S,{sx:{fontSize:"24px",color:"#D32F2F"},children:t("invoice.overdueAmount",{overdue:ae(B)})})]})]}),n.jsx(bn,{ref:D,columnItems:sn,rowsPerPageOptions:[10,20,30],getRequestList:rn,searchParams:l,isCustomRender:!1,requestLoading:C,tableKey:"id",showCheckbox:be&&f,showSelectAllCheckbox:!d&&be&&f,disableCheckbox:!1,applyAllDisableCheckbox:!1,getSelectCheckbox:en,CollapseComponent:Wn,sortDirection:Ke,orderBy:Xe,sortByFn:Ge,isSelectOtherPageCheckbox:!0,hover:!0,isAutoRefresh:!1,renderItem:(e,o,s)=>n.jsx(qn,{item:e,checkBox:s,handleSetSelectedInvoiceAccount:ve,handleViewInvoice:ge,setIsRequestLoading:C,setInvoiceId:V,handleOpenHistoryModal:O,selectedPay:j,handleGetCorrespondingCurrency:oe,addBottom:M.length-1===o,isCurrentCompany:Number(x)===Number(e.companyInfo.companyId),invoicePay:Number(x)===Number(e.companyInfo.companyId)?g:J})}),M.length>0&&!d&&n.jsx(p,{sx:{position:"absolute",bottom:"8px",left:"20px"},children:n.jsx(fe,{variant:"text",onClick:tn,children:Ue})})]}),j.length>0&&((g||J)&&f||r)&&n.jsx(On,{selectedPay:j,decimalPlaces:I}),n.jsx(En,{open:$,currentInvoiceId:F,setOpen:O}),n.jsx(Un,{receiptId:Number(P),type:z})]})}export{wt as default};
//# sourceMappingURL=index-Dic3aPy3.js.map
