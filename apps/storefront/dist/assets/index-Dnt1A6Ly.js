import{z as H,j as n,L as X,ae as Y,x as Z,B as L,T as I}from"./mui-Cw0dwOiN.js";import{r as x}from"./reactVendor-BTcQ-GDs.js";import{u as k}from"./lang-6J3-0YIA.js";import{B as v}from"./B3Filter-CIkbjOhg.js";import{a5 as $,bg as ee,aM as te,au as A,aw as se,a as ae,G as re,ac as oe,ak as ne,u as N,t as ie,bf as le,bJ as de,ag as F}from"./react-setup-DSYWb28G.js";import"./load-functions-DL5N0fkL.js";import"./base-BCVDEF8S.js";import{Q as M,o as ue,p as ce}from"./QuoteStatus-DRzrIG5s.js";import{u as pe}from"./useSort-CwDaxthI.js";import{u as me}from"./router-DEI8QtBD.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./B3FilterMore-CgQ4nWa9.js";import"./form-hNmOEDBo.js";import"./B3CustomForm-B8D1YiOY.js";import"./lodashEs-DKEtmQJE.js";import"./muiIcon-BiFRwRtm.js";import"./dateFns-CeqDayOU.js";import"./B3FilterSearch-D1P6QGaK.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.hStmN1DJ.js";import"./global-D7Yn0gGb.js";import"./dropzone-Cizh2goU.js";const be={subtotal:0,shipping:0,tax:0,grandTotal:0},{decimal_places:ye=2}=te(),E=a=>parseFloat(a.toFixed(ye)),ge=()=>{const{draftQuoteList:a}=$.getState().quoteInfo,{showInclusiveTaxPrice:e}=$.getState().global;return a.reduce((d,i)=>{const{basePrice:u,taxPrice:r=0,quantity:o,additionalCalculatedPrices:q=[]}=i.node;let{subtotal:b,grandTotal:h,tax:s}=d;const{shipping:c}=d;let C=0,g=0;return q.forEach(y=>{C+=y.additionalCalculatedPriceTax,g+=y.additionalCalculatedPrice}),b+=E(ee(Number(u)+g,Number(r))*o),s+=E((Number(r)+C)*o),h=e?b+c:b+c+s,{grandTotal:h,shipping:c,tax:s,subtotal:b}},{...be})},fe=Z("div")({display:"flex",flexDirection:"column",alignItems:"start",marginBottom:"1rem"});function xe(a){const{item:e,goToDetail:l}=a,d=H(),i=k(),u=d.palette.primary.main,r=[{key:"quoteTitle",title:i("quotes.quoteItemCard.title")},{key:"salesRepEmail",title:i("quotes.quoteItemCard.salesRep")},{key:"createdBy",title:i("quotes.quoteItemCard.createdBy")},{key:"createdAt",title:i("quotes.quoteItemCard.dateCreated"),render:()=>"".concat(Number(e.status)!==0?A(Number(e.createdAt)):e.createdAt)},{key:"updatedAt",title:i("quotes.quoteItemCard.lastUpdate"),render:()=>"".concat(Number(e.status)!==0?A(Number(e.updatedAt)):e.updatedAt)},{key:"expiredAt",title:i("quotes.quoteItemCard.expirationDate"),render:()=>"".concat(Number(e.status)!==0?A(Number(e.expiredAt)):e.expiredAt)},{key:"totalAmount",title:i("quotes.quoteItemCard.subtotal"),render:()=>{const{totalAmount:o}=e;return se(Number(o))}}];return n.jsx(X,{children:n.jsxs(Y,{sx:{color:"rgba(0, 0, 0, 0.6)"},children:[n.jsxs(fe,{children:[n.jsx(L,{sx:{display:"flex",alignItems:"center",mb:"1rem"},children:n.jsx(I,{variant:"h6",sx:{color:"rgba(0, 0, 0, 0.87)"},children:e.quoteNumber})}),n.jsx(L,{children:n.jsx(M,{code:e.status})})]}),r.map(o=>n.jsxs(L,{sx:{display:"flex"},children:[n.jsx(I,{sx:{fontWeight:"bold",color:"rgba(0, 0, 0, 0.87)",mr:"5px",whiteSpace:"nowrap"},children:"".concat(o.title,":")}),n.jsx(I,{sx:{color:"black",wordBreak:"break-all"},children:o!=null&&o.render?o.render():e[o.key]})]},o.key)),n.jsx(L,{onClick:()=>l(e,Number(e.status)),sx:{mt:"1rem",pl:0,color:u||"#1976D2",cursor:"pointer",fontWeight:"bold",display:"inline-block"},children:i("quotes.quoteItemCard.view")})]})})}const qe=[{idLangCustomLabel:"quotes.open",statusCode:1},{idLangCustomLabel:"quotes.ordered",statusCode:4},{idLangCustomLabel:"quotes.expired",statusCode:5}],Q="quoteNumber",D={quoteNumber:"quoteNumber",quoteTitle:"quoteTitle",salesRep:"salesRep",createdBy:"createdBy",createdAt:"createdAt",updatedAt:"updatedAt",expiredAt:"expiredAt",status:"status"};function Ce(){const a=N(({company:s})=>s.companyInfo.id),e=N(({company:s})=>s.customer),l=N(ie),d=N(({quoteInfo:s})=>s.draftQuoteList.length),i=N(({b2bFeatures:s})=>s.masqueradeCompany.id),u=k(),r=a||i,o=s=>l?ue({...s,channelId:F}):ce({...s,channelId:F}),q=()=>[{name:"status",label:u("quotes.quoteStatus"),required:!1,default:"",fieldType:"dropdown",options:qe.map(({idLangCustomLabel:s,...c})=>({customLabel:u(s),...c})),replaceOptions:{label:"customLabel",value:"statusCode"},xs:12,variant:"filled",size:"small"}],b=async()=>{var g,y,f,R;const s=await de(Number(r),2),c=((y=(g=s==null?void 0:s.createdByUser)==null?void 0:g.results)==null?void 0:y.createdBy.map(p=>({createdBy:p.email?"".concat(p.name," (").concat(p.email,")"):"".concat(p.name)})))||[],C=((R=(f=s==null?void 0:s.createdByUser)==null?void 0:f.results)==null?void 0:R.salesRep.map(p=>({salesRep:"".concat(p.salesRep||p.salesRepEmail)})))||[];return[...q(),{name:"createdBy",label:u("quotes.createdBy"),required:!1,default:"",fieldType:"dropdown",options:c,replaceOptions:{label:"createdBy",value:"createdBy"},xs:12,variant:"filled",size:"small"},{name:"salesRep",label:u("quotes.salesRep"),required:!1,default:"",fieldType:"dropdown",options:C,replaceOptions:{label:"salesRep",value:"salesRep"},xs:12,variant:"filled",size:"small"}]};return{companyId:r,isB2BUser:l,draftQuoteListLength:d,customer:e,getQuotesList:o,getAvailableFilters:async()=>l?b():q()}}const Be=()=>{const a=k();return x.useMemo(()=>[{key:"quoteNumber",title:a("quotes.quoteNumber"),isSortable:!0},{key:"quoteTitle",title:a("quotes.title"),isSortable:!0},{key:"salesRep",title:a("quotes.salesRep"),render:e=>"".concat(e.salesRep||e.salesRepEmail),isSortable:!0},{key:"createdBy",title:a("quotes.createdBy"),isSortable:!0},{key:"createdAt",title:a("quotes.dateCreated"),render:e=>"".concat(Number(e.status)!==0?A(Number(e.createdAt)):e.createdAt),isSortable:!0},{key:"updatedAt",title:a("quotes.lastUpdate"),render:e=>"".concat(Number(e.status)!==0?A(Number(e.updatedAt)):e.updatedAt),isSortable:!0},{key:"expiredAt",title:a("quotes.expirationDate"),render:e=>"".concat(Number(e.status)!==0?A(Number(e.expiredAt)):e.expiredAt),isSortable:!0},{key:"totalAmount",title:a("quotes.subtotal"),render:e=>{const{totalAmount:l,currency:d}=e,i=d;return le(Number(l),{currency:i,isConversionRate:!1,useCurrentCurrency:!!d})},style:{textAlign:"right"}},{key:"status",title:a("quotes.status"),render:e=>n.jsx(M,{code:e.status}),isSortable:!0}],[a])};function _e(){const{getAvailableFilters:a,draftQuoteListLength:e,customer:l,getQuotesList:d}=Ce(),i=Be(),u={q:"",orderBy:"-".concat(D[Q]),createdBy:"",salesRep:"",status:"",dateCreatedBeginAt:"",dateCreatedEndAt:""},[r,o]=x.useState(u),[q,b]=x.useState(!1),[h,s]=x.useState([]),[c,C,g]=pe(D,Q,r,o),y=me(),f=k(),[R]=ae(),{state:{openAPPParams:p},dispatch:U}=x.useContext(re);x.useEffect(()=>{a().then(t=>s(t)),p.quoteBtn&&U({type:"common",payload:{openAPPParams:{quoteBtn:"",shoppingListBtn:""}}})},[]);const T=(t,m)=>{Number(m)===0?y("/quoteDraft"):y("/quoteDetail/".concat(t.id,"?date=").concat(t.createdAt))},K=x.useCallback(async t=>{const{edges:m=[],totalCount:V}=await d(t);if(t.offset===0&&e){const B=ge(),P={node:{quoteNumber:"—",quoteTitle:"—",createdAt:"—",salesRepEmail:"—",createdBy:"".concat(l.firstName," ").concat(l.lastName),updatedAt:"—",expiredAt:"—",totalAmount:B==null?void 0:B.grandTotal,status:0,taxTotal:B==null?void 0:B.tax}},{status:G,createdBy:w,salesRep:W,dateCreatedBeginAt:J,dateCreatedEndAt:_}=r,j=!G&&!W&&!J&&!_;if(w&&j){const S=/^[^(]+/.exec(w);(S!=null&&S.length?S[0].trim():"")===P.node.createdBy&&m.unshift(P)}else j&&m.unshift(P)}return{edges:m,totalCount:V}},[d,e,l.firstName,l.lastName,r]),O=(t,m)=>{t==="search"&&o({...r,q:m})},z=t=>{const m={createdBy:(t==null?void 0:t.createdBy)||"",status:(t==null?void 0:t.status)||"",salesRep:(t==null?void 0:t.salesRep)||"",dateCreatedBeginAt:(t==null?void 0:t.startValue)||"",dateCreatedEndAt:(t==null?void 0:t.endValue)||""};o({...r,...m})};return n.jsx(oe,{isSpinning:q,children:n.jsxs(L,{sx:{display:"flex",flexDirection:"column",flex:1},children:[n.jsx(v,{filterMoreInfo:h,startPicker:{isEnabled:!0,label:f("quotes.from"),defaultValue:(r==null?void 0:r.dateCreatedBeginAt)||"",pickerKey:"start"},endPicker:{isEnabled:!0,label:f("quotes.to"),defaultValue:(r==null?void 0:r.dateCreatedEndAt)||"",pickerKey:"end"},handleChange:O,handleFilterChange:z}),n.jsx(ne,{columnItems:i,rowsPerPageOptions:[10,20,30],getRequestList:K,searchParams:r,isCustomRender:!1,requestLoading:b,tableKey:"quoteNumber",sortDirection:C,orderBy:g,sortByFn:c,labelRowsPerPage:f(R?"quotes.cardsPerPage":"quotes.quotesPerPage"),renderItem:t=>n.jsx(xe,{item:t,goToDetail:T}),onClickRow:t=>{T(t,Number(t.status))},hover:!0})]})})}export{_e as default};
//# sourceMappingURL=index-Dnt1A6Ly.js.map
