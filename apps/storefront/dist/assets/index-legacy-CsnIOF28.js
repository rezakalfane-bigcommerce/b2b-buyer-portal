System.register(["./mui-legacy-CLOaLEk9.js","./reactVendor-legacy-CtYIj4Ma.js","./lang-legacy-TODaA4m_.js","./react-setup-legacy-0xe2iPqH.js","./B3Filter-legacy-CxyeHakf.js","./load-functions-legacy-PJaV-5hU.js","./base-legacy-D2P4nFX7.js","./Edit-legacy-DOzuKUdR.js","./users-legacy-CSdOP61H.js","./form-legacy-CAo5v63e.js","./lodashEs-legacy-5FC1NR51.js","./B3CustomForm-legacy-B_8DkWdD.js","./intl-legacy-B7uNycgM.js","./eCache-legacy-CW-H9Ud9.js","./redux-legacy-D5ZHjMNV.js","./toolkit-legacy-uWyLsHZ1.js","../index-legacy.BB7DfOW7.js","./global-legacy-B1EgakWG.js","./router-legacy-s4T0V6vG.js","./muiIcon-legacy-D-EcFXKh.js","./dateFns-legacy-C2RUCIEF.js","./dropzone-legacy-CIQbZZBD.js","./B3FilterMore-legacy-D4g3gDK2.js","./B3FilterSearch-legacy-DembA-ug.js"],(function(e,a){"use strict";var l,n,t,s,r,i,o,d,u,c,m,f,y,g,p,h,x,b,j,I,N,C,S,R,E,M,B,k,F,v,w,A,T,V,L,U,z;return{setters:[e=>{l=e.j,n=e.L,t=e.ae,s=e.T,r=e.x,i=e.B,o=e.I},e=>{d=e.r},e=>{u=e.u},e=>{c=e.u,m=e.ab,f=e.aJ,y=e.af,g=e.ag,p=e.am,h=e.ar,x=e.ai,b=e.ah,j=e.a,I=e.aj,N=e.a0,C=e.bs,S=e.ac,R=e.ak},e=>{E=e.B},null,e=>{M=e.b},e=>{B=e.d,k=e.u,F=e.a},e=>{v=e.g,w=e.b,A=e.a,T=e.d,V=e.e},e=>{L=e.u},e=>{U=e.l},e=>{z=e.B},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",(function(){const[e,a]=d.useState(!1),[n,t]=d.useState(!1),[s,r]=d.useState({createdAt:0,email:"",firstName:"",id:"",lastName:"",phone:"",role:0,updatedAt:0,extraFields:[],companyRoleName:"",companyRoleId:"",masqueradingCompanyId:"",companyInfo:null}),o=u(),[f]=j(),g=k(),h=c((({b2bFeatures:e})=>e.masqueradeCompany.id)),x=c((({company:e})=>e.customer.role)),b=c((({company:e})=>e.companyInfo)),M=Number(x)===I.SUPER_ADMIN?h:b?.id,B=c(N),{selectCompanyHierarchyId:v}=c((({company:e})=>e.companyHierarchyInfo)),w=B.userCreateActionsPermission,A=d.useMemo((()=>{const{userCreateActionsPermission:e}=p,a=C(e,Number(v));return{isEnabled:w&&a,customLabel:o("userManagement.addUser")}}),[w,v]),L=d.useRef(null),[U]=F(),z={search:"",companyRoleId:"",companyId:M,q:""},q=D(o),[O,_]=d.useState(z),[H,X]=d.useState(q),[Y,Z]=d.useState(""),$=()=>{U.current?.refresh()},G=e=>{L.current?.handleOpenAddEditUserClick("edit",e)},K=e=>{r(e),t(!0)},Q=()=>{t(!1)};return d.useEffect((()=>{(()=>{const e=q.map((e=>{const a=e,l=e.options?.map((e=>(e.label=o(e.idLang),e)));return a.options=l,a.setValueName=Z,a.default=O.companyRoleId,a.defaultName=O.companyRoleId?Y:"",e}));X(e)})()}),[O,O.companyRoleId]),l.jsx(S,{isSpinning:e,children:l.jsxs(i,{sx:{display:"flex",flexDirection:"column",flex:1},children:[l.jsx(E,{filterMoreInfo:H,handleChange:(e,a)=>{const l={...O,q:a};_(l)},handleFilterChange:e=>{const a={...O,companyRoleId:e.companyRoleId,offset:0};_(a)},customButtonConfig:A,handleFilterCustomButtonClick:()=>{L.current?.handleOpenAddEditUserClick("add")}}),l.jsx(R,{ref:U,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:async e=>{const a=await T(e),{users:{edges:l,totalCount:n}}=a;return{edges:l,totalCount:n}},searchParams:O||{},isCustomRender:!0,itemXs:g?3:4,requestLoading:a,renderItem:e=>l.jsx(J,{item:e,onEdit:G,onDelete:K},e.id||"")}),l.jsx(P,{companyId:v||M,renderList:$,ref:L}),l.jsx(m,{isOpen:n,title:o("userManagement.deleteUser"),leftSizeBtn:o("userManagement.cancel"),rightSizeBtn:o("userManagement.delete"),handleLeftClick:Q,handRightClick:async e=>{if(e)try{a(!0),Q(),await V({userId:e.id||"",companyId:v||M}),y.success(o("userManagement.deleteUserSuccessfully"))}finally{a(!1),$()}},row:s,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:l.jsx(i,{sx:{display:"flex",justifyContent:f?"center%":"start",width:f?"100%":"450px",height:"100%"},children:o("userManagement.confirmDelete")})})]})})}));const a=()=>[{label:"Admin",name:"Admin",value:0,idLang:"userManagement.userRole.admin"},{label:"Senior buyer",name:"Senior Buyer",value:1,idLang:"userManagement.userRole.seniorBuyer"},{label:"Junior buyer",name:"Junior Buyer",value:2,idLang:"userManagement.userRole.juniorBuyer"}],D=e=>[{name:"companyRoleId",label:e("userManagement.config.userRole"),required:!1,default:"",defaultName:"",fieldType:"roleAutocomplete",xs:12,disabled:!1,variant:"filled",size:"small"}],q={3:"global.emailValidate.multipleCustomer",4:"global.emailValidate.companyUsed",5:"global.emailValidate.alreadyExits",6:"global.emailValidate.usedSuperAdmin"},O={0:"text",1:"multiline",2:"number",3:"dropdown"},_=async()=>{let e=[];try{const{userExtraFields:a}=await v();e=(e=>e.map((e=>{const{listOfValue:a}=e,l=O[e.fieldType],n={isExtraFields:!0,name:e.fieldName,label:e.labelName,required:e.isRequired,default:e.defaultValue||"",fieldType:l,xs:12,variant:"filled",size:"small"};switch(l){case"dropdown":if(a){const e=a?.map((e=>({label:e,value:e})));e.length>0&&(n.options=e)}break;case"number":n.max=e.maximumValue||"";break;case"mutiline":n.rows=e.numberOfRows||"";break;default:n.maxLength=e.maximumLength||""}return n})))(a.filter((e=>e.visibleToEnduser)))}catch(a){M.error(a)}return e},P=d.forwardRef((function({companyId:e,renderList:a},n){const t=c((({company:e})=>e.customer.b2bId)),[s,r]=d.useState(!1),[i,o]=d.useState(""),[p,h]=d.useState(null),[x,b]=d.useState(!1),[j,I]=d.useState([]),[N,C]=d.useState([]),S=u(),{control:R,handleSubmit:E,getValues:M,formState:{errors:B},clearErrors:k,setValue:F,setError:v}=L({mode:"onSubmit"});d.useEffect((()=>{0===N.length&&(async()=>{const e=await _();C(e)})()}),[N.length]),d.useEffect((()=>{if(s){const e=j.map((e=>{const a=e;return"edit"===i&&p&&F(e.name,p[e.name]),a}));I(e)}}),[p,s,i]);const T=()=>{j.forEach((e=>{F(e.name,""),e.isExtraFields&&F(e.name,e.default||"")})),k(),r(!1)},V=(e,a)=>{const l=((e,a,l=!1)=>{const n=D(a);return n[0].required=!0,n[0].disabled=l,[...n,{name:"email",label:a("userManagement.config.email"),required:!0,fieldType:"text",xs:12,disabled:"edit"===e,default:"",variant:"filled",size:"small"},{name:"firstName",label:a("userManagement.config.firstName"),required:!0,default:"",fieldType:"text",xs:6,variant:"filled",size:"small"},{name:"lastName",label:a("userManagement.config.lastName"),required:!0,fieldType:"text",xs:6,default:"",variant:"filled",size:"small"},{name:"phone",label:a("userManagement.config.phoneNumber"),required:!1,fieldType:"text",xs:12,default:"",variant:"filled",size:"small"}]})(e,S,"edit"===e&&t===Number(a.id));if("edit"===e){const e=a.extraFields||[];let n=a;if(e&&e.length>0){const l={};e.forEach((e=>{l[e.fieldName]=e.fieldValue})),n={...a,...l}}h(n);const t=l.find((e=>"companyRoleId"===e.name))||null;t&&(t.defaultName=a?.companyRoleName||"",t.default=a?.companyRoleId||"")}const n=U(l,N);I(n),o(e),r(!0)};return d.useImperativeHandle(n,(()=>({handleOpenAddEditUserClick:V}))),l.jsx(m,{isOpen:s,title:S("edit"===i?"userManagement.editUser":"userManagement.addNewUser"),leftSizeBtn:S("userManagement.cancel"),rightSizeBtn:S("userManagement.saveUser"),handleLeftClick:T,handRightClick:()=>{E((async l=>{b(!0);const n=(e=>{const a=Object.keys(e),l=[];return N.forEach((n=>{if(a.includes(n.name)){const a={fieldName:n.name||"",fieldValue:e[n.name]||""};l.push(a)}})),l})(l);let t=S("userManagement.addUserSuccessfully");try{const s={companyId:e,companyRoleId:Number(l.companyRoleId),...l,extraFields:n};if("edit"!==i){const{isValid:a,userType:n}=await(async a=>{const{userType:l,userInfo:{companyName:n}}=await A({email:a,companyId:e,channelId:g}),t=[f.DOES_NOT_EXIST,f.B2C,f.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL].includes(l);return t||v("email",{type:"custom",message:S(q[l],{companyName:n?`(${n})`:"",email:a})}),{isValid:t,userType:l}})(l.email);if(!a)return void b(!1);n===f.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL&&(s.addChannel=!0,t=S("userManagement.userDetected",{email:l.email}))}"edit"===i&&(s.userId=p?.id||"",t=S("userManagement.updateUserSuccessfully"),delete s.email),await w(s),T(),y.success(t),a()}finally{b(!1)}}))()},loading:x,isShowBordered:!0,children:l.jsx(z,{formFields:j,errors:B,control:R,getValues:M,setValue:F})})})),H=r("div")((()=>({display:"flex",alignItems:"center",justifyContent:"space-between"})));function J(e){const{item:r,onEdit:d,onDelete:u}=e,{companyInfo:c,id:m,companyRoleName:f,firstName:y,lastName:g,email:j}=r,{userUpdateActionsPermission:I,userDeleteActionsPermission:N}=p,C=h({code:I,companyId:Number(c?.companyId||0),userId:Number(m)}),S=h({code:N,companyId:Number(c?.companyId||0),userId:Number(m)});return l.jsx(n,{children:l.jsxs(t,{sx:{color:"#313440"},children:[l.jsxs(s,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)"},children:[y," ",g]}),l.jsx(s,{sx:{p:"15px 0"},variant:"body1",children:j}),l.jsxs(H,{children:[(e=>{const n=a().map((e=>2===Number(e.value)?"Junior Buyer"!==f?{color:"#ce93d8",textColor:"black",...e,label:f,name:f}:{color:"#D9DCE9",textColor:"black",...e}:1===Number(e.value)?{color:"rgba(237, 108, 2, 0.3)",textColor:"black",...e}:{color:"#C4DD6C",textColor:"black",...e})).find((a=>a.name===e));return n?l.jsx(b,{color:n.color,textColor:n.textColor,children:n.label}):null})(f),l.jsxs(i,{children:[C&&l.jsx(o,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{d(r)},children:l.jsx(B,{fontSize:"inherit"})}),S&&l.jsx(o,{"aria-label":"delete",size:"small",onClick:()=>{u(r)},children:l.jsx(x,{fontSize:"inherit"})})]})]})]})},m)}}}}));
//# sourceMappingURL=index-legacy-CsnIOF28.js.map
