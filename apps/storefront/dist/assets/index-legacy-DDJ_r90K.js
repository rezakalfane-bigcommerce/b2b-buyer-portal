System.register(["./mui-legacy-nJi-LPwx.js","./reactVendor-legacy-CtYIj4Ma.js","./lang-legacy-1f-gtWXv.js","./B3Filter-legacy-Dn314qq4.js","./react-setup-legacy-DuBzGPOI.js","./load-functions-legacy-Cd9k4nWw.js","./base-legacy-D2P4nFX7.js","./Edit-legacy-BK8HCqme.js","./address-legacy-DrGhFOXI.js","./config-legacy-B1B3AYRd.js","./form-legacy-CAo5v63e.js","./lodashEs-legacy-5FC1NR51.js","./B3CustomForm-legacy-CZbiJ61c.js","./config-legacy-BvlvzZXH.js","./intl-legacy-B7uNycgM.js","./eCache-legacy-CW-H9Ud9.js","./B3FilterMore-legacy-D080M85H.js","./dateFns-legacy-Bs-ooDPO.js","./B3FilterSearch-legacy-CRbD-f_e.js","./redux-legacy-D5ZHjMNV.js","./toolkit-legacy-uWyLsHZ1.js","../index-legacy.CUzweyJF.js","./global-legacy-B1EgakWG.js","./router-legacy-s4T0V6vG.js","./muiIcon-legacy-CbXEHT38.js","./dropzone-legacy-C0uLCPXC.js","./validatorRules-legacy-CEy9rryY.js"],(function(e,s){"use strict";var t,a,i,n,d,l,r,o,c,u,f,g,m,p,h,y,x,j,S,C,D,b,B,A,I,w,F,L,E,k,N,v,P,O,T,z,R,V,q,_,M,$,U,J,H,G,K,W,X,Z,Q,Y,ee,se,te;return{setters:[e=>{t=e.j,a=e.s,i=e.w,n=e.y,d=e.z,l=e.L,r=e.ae,o=e.T,c=e.x,u=e.B,f=e.I,g=e.af},e=>{m=e.r},e=>{p=e.u},e=>{h=e.B},e=>{y=e.ab,x=e.af,j=e.ah,S=e.ad,C=e.ai,D=e.a,b=e.ae,B=e.u,A=e.t,I=e.G,w=e.aj,F=e.ac,L=e.ak,E=e.al,k=e.am},null,e=>{N=e.b},e=>{v=e.d,P=e.u,O=e.a},e=>{T=e.c,z=e.u,R=e.a,V=e.b,q=e.d,_=e.e,M=e.g,$=e.f,U=e.h,J=e.i},e=>{H=e.b,G=e.a,K=e.u,W=e.f,X=e.c},e=>{Z=e.u},e=>{Q=e.f},e=>{Y=e.B},e=>{ee=e.d,se=e.v,te=e.g},null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",(function(){const e=B(A),s=B((({company:e})=>e.companyInfo.id)),a=B((({company:e})=>e.customer.role)),i=B((({b2bFeatures:e})=>e.masqueradeCompany.id)),n=B((({b2bFeatures:e})=>e.masqueradeCompany.isAgenting)),{state:{addressConfig:d},dispatch:l}=m.useContext(I),{selectCompanyHierarchyId:r}=B((({company:e})=>e.companyHierarchyInfo)),o=p(),c=P(),[f]=O(),g=m.useRef(null),[y,j]=m.useState(!1),[S,C]=m.useState([]),[D,b]=m.useState([]),[k,v]=m.useState({search:""}),T=a===w.SUPER_ADMIN&&n?i:s;let z=!1;e&&(a!==w.SUPER_ADMIN||n)||(z=!0),m.useEffect((()=>{(async()=>{const{countries:e}=await E();b(e),j(!0);try{const s=await ce(!z,e);C(s||[])}catch(s){N.error(s)}finally{j(!1)}})()}),[]);const R={},V=()=>{f.current?.refresh()},[q,_]=m.useState(!1),[M,H]=m.useState(!1),[G,Z]=m.useState(!1),[Q,Y]=m.useState(),[ee,se,te]=K(ue);m.useEffect((()=>{(async()=>{if(z)_(!0);else if(se)try{let e=d;if(!e){const{addressConfig:s}=await $();e=s,l({type:"common",payload:{addressConfig:e}})}const s=3===a?"address_sales_rep":"address_admin",t="1"===(e||[]).find((e=>"address_book"===e.key))?.isEnabled&&"1"===(e||[]).find((e=>e.key===s))?.isEnabled;_(t)}catch(e){N.error(e)}})()}),[d,se,z,a,r]);const ie=e=>{q?(Y({...e}),Z(!0)):x.error(o("addresses.noPermissionToEdit"))},ne=e=>{Y({...e}),H(!0)},oe=m.useMemo((()=>({isEnabled:z||q&&ee,customLabel:o("addresses.addNewAddress")})),[q,r,ee]),fe=JSON.parse(JSON.stringify(W));fe.map((e=>(e.label=o(e.idLang),e)));const ge=Number(r)||Number(T);return t.jsx(F,{isSpinning:y,children:t.jsxs(u,{sx:{display:"flex",flexDirection:"column",flex:1},children:[t.jsx(h,{filterMoreInfo:fe,handleChange:(e,s)=>{"search"===e&&v({...k,search:s})},handleFilterChange:e=>{v({...k,country:e.country||"",state:e.state||"",city:e.city||""})},customButtonConfig:oe,handleFilterCustomButtonClick:()=>{q?g.current?.handleOpenAddEditAddressClick("add"):x.error(o("addresses.noPermissionToAdd"))}}),t.jsx(L,{ref:f,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:async(e=R)=>{let s=[],t=0;if(z){const{customerAddresses:{edges:a=[],totalCount:i}}=await J({...e});s=a.map((e=>({node:X(e.node)}))),t=i}else{const{addresses:{edges:a=[],totalCount:i}}=await U({companyId:T,...e});s=a,t=i}return{edges:s,totalCount:t}},searchParams:k,isCustomRender:!0,itemXs:c?3:4,requestLoading:j,tableKey:"id",renderItem:e=>t.jsx(de,{item:e,onEdit:()=>(e=>{q?g.current?.handleOpenAddEditAddressClick("edit",e):x.error(o("addresses.noPermissionToEdit"))})(e),onDelete:ie,onSetDefault:ne,editPermission:q,updateActionsPermission:se,deleteActionsPermission:te,isBCPermission:z},e.id)}),t.jsx(ae,{updateAddressList:V,addressFields:S,ref:g,companyId:ge,isBCPermission:z,countries:D}),q&&!z&&t.jsx(re,{isOpen:M,setIsOpen:H,setIsLoading:j,addressData:Q,updateAddressList:V,companyId:ge}),q&&t.jsx(le,{isOpen:G,setIsOpen:Z,setIsLoading:j,addressData:Q,updateAddressList:V,companyId:ge,isBCPermission:z})]})})}));const s=a("div")((()=>({display:"flex","& div::first-of-type":{marginRight:"2rem"},"& div":{minWidth:"45%",display:"flex",flexDirection:"column"}}))),ae=m.forwardRef((function({addressFields:e,updateAddressList:a,companyId:d,isBCPermission:l,countries:r},o){const c=p(),[u,f]=m.useState(!1),[g,h]=m.useState(""),[j,S]=m.useState(!1),[C,D]=m.useState(!1),[b,B]=m.useState(e),[A,I]=m.useState([]),[w,F]=m.useState([]),[L,E]=m.useState(null),[k,N]=m.useState({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),v=!l,{control:P,handleSubmit:O,getValues:q,formState:{errors:_},watch:M,setError:$,setValue:U,reset:J}=Z({mode:"all"}),G=()=>{O((async e=>{D(!0);try{const s=await(async e=>{try{const s=A.map((s=>({fieldName:ee(s.name),fieldValue:e[s.name]||s.default}))),t=await se({extraFields:s});if(200!==t.code){const e=t.data?.errMsg||t.message||"",s=e.split(":");if(s.length>=2){const e=A.find((e=>ee(e.name)===s[0]));if(e)return $(e.name,{type:"manual",message:s[1]}),D(!1),!1}throw e}return!0}catch(s){throw x.error(s),s}})(e);if(!s)return;const t=A.map((s=>({fieldName:ee(s.name),fieldValue:e[s.name]||s.default}))),{country:i,state:n}=e;let l="",o="",u=n;r.forEach((e=>{const{countryName:s,countryCode:t,states:a}=e;if(t===i)if(l=s,a.length>0){const e=a.find((e=>e.stateCode===u||e.stateName===u));o=e?.stateName||o,u=e?.stateCode||u}else u="",o=n}));const m={...e,companyId:Number(d),extraFields:t,isShipping:k.isShipping?1:0,isBilling:k.isBilling?1:0,isDefaultShipping:k.isDefaultShipping?1:0,isDefaultBilling:k.isDefaultBilling?1:0,country:l,countryCode:i,state:o,stateCode:u};if("add"===g)await T(m),x.success(c("addresses.addressForm.newAddressAdded"));else if("edit"===g&&L){const{id:e}=L;await z({...m,id:Number(e)}),x.success(c("addresses.addressForm.addressUpdated"))}N({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),f(!1),await a(!0)}catch(s){x.error(s)}finally{D(!1)}}))()},K=(e,s)=>{"add"===e&&w.length>0&&b.forEach((e=>{const s=e;if(e.custom)if(v){const t=w.filter((s=>s.name===e.name))[0];s.default=t.default||""}else{const t=w.filter((s=>s.name===e.name||s.bcLabel===e.bcLabel))[0];s.default=t.default||""}})),J(),E(s),h(e),f(!0),S(!1)};m.useImperativeHandle(o,(()=>({handleOpenAddEditAddressClick:K}))),m.useEffect((()=>{const s=JSON.parse(JSON.stringify(e));s.forEach((e=>{const s=e;return s.label=c(e.idLang)||e.label,v||"field_21"!==e.fieldId||(s.default=""),e})),B(s);const t=e.filter((e=>e.custom));if(I(t),0===w.length){const s=Q(e);F(s)}}),[e,w.length,v]);const W=m.useCallback((()=>{if(L){const{isShipping:e,isBilling:s,isDefaultShipping:t,isDefaultBilling:a,state:i,stateCode:n,countryCode:d,extraFields:l}=L,o=r.filter((e=>e.countryCode===d));N({isShipping:1===e,isBilling:1===s,isDefaultShipping:1===t,isDefaultBilling:1===a}),b.forEach((e=>{const s=e;if(s.custom&&l.length>0)if(v){const e=ee(s.name),t=l.find((s=>s.fieldName===e)),a=w.find((s=>s.name===e));t?(U(s.name,t.fieldValue||""),s.default=t.fieldValue||""):(U(s.name,""),s.default=a.default)}else{const e=l.find((e=>e.fieldName===s.name||e.fieldName===s.bcLabel)),t=w.filter((e=>e.name===s.name||e.bcLabel===s.bcLabel))[0];e?(U(s.name,e.fieldValue||""),s.default=e.fieldValue||t.default):(U(s.name,""),s.default=t.default)}else if("country"===s.name)U(s.name,d);else if("state"===s.name){if(U(s.name,n||i),o[0]){const{states:e}=o[0];e.length>0?(s.options=e,s.fieldType="dropdown",s.required=!0):(s.options=[],s.fieldType="text",s.required=!1)}}else U(s.name,"undefined"===L[s.name]?"":L[s.name])}))}}),[L,r,v,w,U,b]);return m.useEffect((()=>{u&&"edit"===g&&L&&!j&&(W(),S(!0))}),[u,g,L,j,W]),m.useEffect((()=>{const e=M(((e,{name:s,type:t})=>{const{country:a}=e;"country"===s&&"change"===t&&(e=>{const s=r.find((s=>s.countryCode===e))?.states||[],t=b.find((e=>"state"===e.name));t&&(s.length>0?(t.fieldType="dropdown",t.options=s,t.required=!0):(t.fieldType="text",t.options=[],t.required=!1)),U("state",""),B([...b])})(a)}));return()=>e.unsubscribe()}),[b,r,M]),t.jsxs(y,{isOpen:u,title:c("add"===g?"addresses.addressForm.addNewAddress":"addresses.addressForm.editAddress"),leftSizeBtn:c("addresses.addressForm.cancel"),rightSizeBtn:c("addresses.addressForm.saveAddress"),handleLeftClick:()=>{J(),N({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),f(!1),h("")},handRightClick:()=>{v?G():O((async e=>{D(!0);try{const s=A.map((s=>({name:s.bcLabel,value:e[s.name]||s.default}))),{country:t,state:i}=e;let n="",d="",l=i;r.forEach((e=>{const{countryName:s,countryCode:a,states:r}=e;if(a===t)if(n=s,r.length>0){const e=r.find((e=>e.stateCode===l||e.stateName===l));d=e?.stateName||d,l=e?.stateCode||l}else l="",d=i}));const o={...e,formFields:s,country:n,countryCode:t,state:d,stateCode:l,addressType:""};if("add"===g)await R(o),x.success(c("addresses.addressForm.newAddressAdded"));else if("edit"===g&&L){const{bcAddressId:e}=L;e&&await V({...o,id:Number(e)}),x.success(c("addresses.addressForm.addressUpdated"))}f(!1),await a(!0)}catch(s){x.error(s)}finally{D(!1)}}))()},loading:C,isShowBordered:!0,children:[v&&t.jsxs(t.Fragment,{children:[t.jsx("p",{children:c("addresses.addressForm.selectAddressType")}),t.jsx(s,{children:H.map((e=>{const{child:s,name:a,idLang:d}=e;return t.jsxs("div",{children:[t.jsx(i,{control:t.jsx(n,{checked:k[a],onChange:e=>{((e,s)=>{N("isShipping"===s?{...k,[s]:e,isDefaultShipping:!1}:{...k,[s]:e,isDefaultBilling:!1})})(e.target.checked,a)}}),label:c(d)}),s&&t.jsx(i,{control:t.jsx(n,{checked:k[s.name],onChange:()=>{N({...k,[s.name]:!k[s.name]})}}),label:c(s.idLang),sx:{display:k[a]?"":"none"}})]},a)}))})]}),t.jsx(Y,{formFields:b,errors:_,control:P,getValues:q,setValue:U})]})})),ie=c("div")((({marginBottom:e})=>({marginBottom:e,"& > span:not(:last-child)":{marginRight:"4px"}}))),ne=c("div")((({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:e.spacing(3)})));function de(e){const{item:s,onEdit:a,onDelete:i,onSetDefault:n,editPermission:c,updateActionsPermission:g=!1,deleteActionsPermission:m=!1,isBCPermission:h}=e,y=d(),x=p();return t.jsx(l,{children:t.jsxs(r,{sx:{color:"#313440",wordBreak:"break-word"},children:[s.label&&t.jsx(o,{variant:"h5",sx:{marginBottom:1===s.isDefaultShipping||1===s.isDefaultBilling?y.spacing(1):y.spacing(3),color:"rgba(0, 0, 0, 0.87)"},children:s.label}),t.jsxs(ie,{marginBottom:1===s.isDefaultShipping||1===s.isDefaultBilling?y.spacing(3):0,children:[1===s.isDefaultShipping&&t.jsx(j,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:x("addresses.addressItemCard.defaultShipping")}),1===s.isDefaultBilling&&t.jsx(j,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:x("addresses.addressItemCard.defaultBilling")})]}),t.jsx(o,{variant:"body1",children:`${s.firstName} ${s.lastName}`}),t.jsx(o,{variant:"body1",children:s.company||""}),t.jsx(o,{variant:"body1",children:s.addressLine1}),t.jsx(o,{variant:"body1",children:"undefined"===s.addressLine2?"":s.addressLine2}),t.jsx(o,{variant:"body1",children:`${s.city}, ${s.state} ${s.zipCode}, ${s.country}`}),t.jsx(o,{variant:"body1",children:s.phoneNumber}),c&&t.jsxs(ne,{children:[!h&&g&&t.jsx(S,{variant:"text",sx:{ml:"-8px"},onClick:()=>{n(s)},children:x("addresses.addressItemCard.setAsDefault")}),t.jsxs(u,{sx:{flex:1,display:"flex",justifyContent:"flex-end"},children:[(g||h)&&t.jsx(f,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{a(s)},children:t.jsx(v,{fontSize:"inherit"})}),(m||h)&&t.jsx(f,{"aria-label":"delete",size:"small",onClick:()=>{i(s)},children:t.jsx(C,{fontSize:"inherit"})})]})]})]})},s.id)}function le(e){const{isOpen:s,setIsOpen:a,addressData:i,updateAddressList:n,setIsLoading:d,companyId:l,isBCPermission:r}=e,[o]=D(),c=p();return t.jsx(y,{isOpen:s,title:c("addresses.deleteAddressDialog.deleteAddress"),leftSizeBtn:c("addresses.deleteAddressDialog.cancel"),rightSizeBtn:c("addresses.deleteAddressDialog.delete"),handleLeftClick:()=>{a(!1)},handRightClick:async()=>{if(i)try{d(!0),a(!1);const{id:e="",bcAddressId:s=""}=i;r?await _({bcAddressId:s}):await q({addressId:e,companyId:l}),x.success(c("addresses.deleteAddressDialog.successfullyDeleted")),n()}catch(e){d(!1)}},rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:t.jsx(u,{sx:{display:"flex",alignItems:o?"start":"center",justifyContent:o?"center":"start",width:o?"100%":"450px",height:"100%"},children:c("addresses.deleteAddressDialog.confirmDelete")})})}function re(e){const{isOpen:s,setIsOpen:a,setIsLoading:d,addressData:l,updateAddressList:r,companyId:o}=e,[c]=D(),f=p(),[h,j]=m.useState();m.useEffect((()=>{j(l)}),[l]);const S=e=>s=>{const{checked:t}=s.target;if(h){const s={...h};"isDefaultShipping"===e&&(s.isDefaultShipping=t?1:0,s.isShipping=t?1:s.isShipping),"isDefaultBilling"===e&&(s.isDefaultBilling=t?1:0,s.isBilling=t?1:s.isShipping),j(s)}};return t.jsx(y,{isOpen:s,title:f("addresses.setDefaultDialog.setDefaultAddress"),leftSizeBtn:f("addresses.setDefaultDialog.cancel"),rightSizeBtn:"set",handleLeftClick:()=>{a(!1)},handRightClick:async()=>{try{d(!0),a(!1),await z({...h,companyId:o}),x.success(f("addresses.setDefaultDialog.successfullySet")),r()}catch(e){d(!1)}},children:t.jsx(u,{sx:{display:"flex",alignItems:c?"start":"center",justifyContent:c?"center%":"start",width:c?"100%":"450px",height:"100%"},children:h&&t.jsx(u,{sx:{padding:c?"0":"10px 0"},children:t.jsxs(g,{children:[t.jsx(i,{control:t.jsx(n,{checked:1===h.isDefaultShipping,onChange:S("isDefaultShipping")}),label:f("addresses.setDefaultDialog.setDefaultShippingAddress")}),t.jsx(i,{control:t.jsx(n,{checked:1===h.isDefaultBilling,onChange:S("isDefaultBilling")}),label:f("addresses.setDefaultDialog.setDefaultBillingAddress")})]})})})})}const oe=async()=>{try{const e=(e=>{if(0===e.length)return[];const s=e.filter((e=>e.visibleToEnduser))||[];if(0===s?.length)return[];const t=s.map((e=>({...e,groupId:4,visible:e.visibleToEnduser}))),a=te(t).address;return a.map((e=>(e.custom=!0,e))),a})((await M()).addressExtraFields);return[...G,...e]}catch(e){N.error(e)}return[]},ce=async(e,s)=>{let t=[];try{if(e){const e=await oe();e&&(t=e)}else t=await(async()=>{try{const{accountFormFields:e}=await b(1),s=e.filter((e=>4===e.groupId));return te(s).address}catch(e){N.error(e)}})();return t.map((e=>{const t=e;return"country"===e.name&&(t.options=s,t.required=!0),"state"===e.name&&(t.fieldType="text",t.required=!1),e})),t}catch(a){N.error(a)}return[]},ue=[k.addressesCreateActionsPermission,k.addressesUpdateActionsPermission,k.addressesDeleteActionsPermission]}}}));
//# sourceMappingURL=index-legacy-DDJ_r90K.js.map
