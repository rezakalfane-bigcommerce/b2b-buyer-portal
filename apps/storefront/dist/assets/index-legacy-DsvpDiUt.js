System.register(["./mui-legacy-nJi-LPwx.js","./reactVendor-legacy-CtYIj4Ma.js","./lang-legacy-1f-gtWXv.js","./lodashEs-legacy-5FC1NR51.js","./react-setup-legacy-DuBzGPOI.js","./load-functions-legacy-Cd9k4nWw.js","./base-legacy-D2P4nFX7.js","./payment-legacy-DXBQIlu5.js","./useSort-legacy-CfCrn6Eb.js","./B2BAutoCompleteCheckbox-legacy-BgCZYlUq.js","./B3Filter-legacy-Dn314qq4.js","./MoreHoriz-legacy-DxERGJVA.js","./router-legacy-s4T0V6vG.js","./resizable-legacy-df33v27g.js","./pdfobject-legacy-CMgZlEc9.js","./intl-legacy-B7uNycgM.js","./eCache-legacy-CW-H9Ud9.js","./redux-legacy-D5ZHjMNV.js","./toolkit-legacy-uWyLsHZ1.js","../index-legacy.CUzweyJF.js","./global-legacy-B1EgakWG.js","./muiIcon-legacy-CbXEHT38.js","./dateFns-legacy-Bs-ooDPO.js","./dropzone-legacy-C0uLCPXC.js","./b3checkout-legacy-BMah2JXQ.js","./B3FilterMore-legacy-D080M85H.js","./form-legacy-CAo5v63e.js","./B3CustomForm-legacy-CZbiJ61c.js","./B3FilterSearch-legacy-CRbD-f_e.js"],(function(e,n){"use strict";var t,i,r,a,o,s,l,c,d,u,p,m,x,y,h,b,f,v,g,j,C,w,N,I,k,S,D,B,P,A,R,T,F,L,E,O,$,z,H,V,W,q,M,_,U,G,K,X,Y,Z,J,Q,ee,ne,te;return{setters:[e=>{t=e.j,i=e.I,r=e.s,a=e.Y,o=e.X,s=e.G,l=e.B,c=e.T,d=e.d,u=e.L,p=e.ae,m=e.f,x=e.ag,y=e.x},e=>{h=e.r},e=>{b=e.u},e=>{f=e.f},e=>{v=e.u,g=e.a0,j=e.am,C=e.ar,w=e.af,N=e.a,I=e.as,k=e.ah,S=e.ab,D=e.ac,B=e.at,P=e.au,A=e.av,R=e.aw,T=e.ax,F=e.a4,L=e.ay,E=e.G,O=e.ak,$=e.aj,z=e.az},null,e=>{H=e.b},e=>{V=e.i,W=e.g,q=e.f,M=e.a,_=e.b,U=e.c,G=e.e,K=e.d},e=>{X=e.u},e=>{Y=e.B},e=>{Z=e.B},e=>{J=e.d},e=>{Q=e.u,ee=e.a},e=>{ne=e.R},e=>{te=e.P},null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",(function(){const e=(new Date).getTime(),n=b(),{isAgenting:i,selectCompanyHierarchyId:r,isEnabledCompanyHierarchy:a,invoicePayPermission:o,purchasabilityPermission:s,currentCompanyId:u,invoiceSubViewPermission:p}=function(){const e=v((({company:e})=>e.customer.role)),n=v((({b2bFeatures:e})=>e.masqueradeCompany.isAgenting)),t=v((({company:e})=>e.companyInfo.id)),{selectCompanyHierarchyId:i,isEnabledCompanyHierarchy:r}=v((({company:e})=>e.companyHierarchyInfo)),a=v((({b2bFeatures:e})=>e.masqueradeCompany.id)),{invoicePayPermission:o,purchasabilityPermission:s}=v(g),l=e===$.SUPER_ADMIN&&n?Number(a):Number(t),{invoice:c}=v((({company:e})=>e.pagesSubsidiariesPermission));return{isAgenting:n,selectCompanyHierarchyId:i,isEnabledCompanyHierarchy:r,invoicePayPermission:o,purchasabilityPermission:s,currentCompanyId:l,invoiceSubViewPermission:c}}(),y=Q(),[C]=N(),k=h.useRef(null),{decimal_places:S=2}=T(),[B,A]=h.useState(!1),[V,W]=h.useState(!1),[M,_]=h.useState(""),[J,ne]=h.useState(""),[te,re]=h.useState(""),[le,ce]=h.useState(0),[be,fe]=h.useState(0),[ve,je]=h.useState([]),[we,ke]=h.useState([]),[Se,De]=h.useState([]),[Be,Pe]=h.useState({}),[Ae,Re]=h.useState(n("invoice.exportCsvText")),[Te,Fe]=h.useState(!1),[Le,Ee]=h.useState([]),[Oe,$e]=h.useState(o),ze=F({level:L.COMPANY_SUBSIDIARIES,code:j.invoicePayPermission}),{state:{bcLanguage:He}}=h.useContext(E),[Ve,We,qe]=X(ye,xe,Be,Pe),Me=ee(),_e=e=>Object.keys(e).some((n=>"first"!==n&&"offset"!==n&&"orderBy"!==n&&e[n])),Ue=async(e,t,i)=>{try{const r=Number(i)===Number(u)?o:ze;A(!0);const a=s&&r&&2!==t,l=await ie(e,a);if(!l)return void w.error(n("invoice.pdfUrlResolutionError"));const{href:c}=window.location;if(!c.includes("invoice"))return;window.open(l,"_blank","fullscreen=yes")}catch(r){H.error(r)}finally{A(!1)}};h.useEffect((()=>{const e={...Ie,companyIds:[Number(r)||Number(u)]};if(Me?.search){const n=new URLSearchParams(Me.search),t=n.get("invoiceId")||"",i=n.get("receiptId")||"";t&&(Pe({...e,q:t}),re(ue.DETAIL)),i&&(re(ue.CHECKOUT),Pe({...e}),ne(i))}else re(ue.NORMAL),Pe({...e})}),[Me,r]),h.useEffect((()=>{const e=ve.filter((e=>{const{node:{openBalance:n}}=e;return 0!==Number(n.value)}))||[];if(e.length>0)if(0===we.length)ke(f(e));else{const n=e.map((e=>{const{node:{id:n,openBalance:t}}=e,i=we.find((e=>{const{node:{id:t}}=e;return Number(n)===Number(t)}));if(i){const{node:{openBalance:e}}=i;t.value=e.value}return e}));ke(f(n))}else ke([])}),[ve]);const Ge=(e,n)=>{let t=e;if(e.includes(".")){const n=e.split("."),i=0===S?0:n[1].length-Number(S);if(n[1]&&i>0){const e=n[0]+n[1];t=`${e.slice(0,-S)}.${e.slice(-S)}`}n[1]&&0===i&&(t=q(Number(e),S))}else t.length>1?(t=`${e.slice(0,1)}.${e.slice(-1)}`,0===Number(S)&&(t=e)):t=e;((e,n)=>{const t=ve.find((e=>{const{node:{id:t}}=e;return Number(t)===Number(n)}));if(we.length>0){const i=we.map((i=>{const{node:{id:r,openBalance:a}}=i,{node:{openBalance:o}}=t;return Number(r)===Number(n)&&(a.value=Number(o.value)<Number(e)?o.value:e),i}));ke(i)}})(t,n)},Ke=[{key:"id",title:n("invoice.headers.invoice"),isSortable:!0,render:e=>t.jsx(l,{sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},onClick:()=>{const n=e?.companyInfo||{};Ue(e.id,e.status,n?.companyId)},children:e?.invoiceNumber?e?.invoiceNumber:e?.id}),width:"8%"},{key:"companyInfo",title:n("invoice.headers.companyName"),isSortable:!1,render:e=>{const{companyName:n}=e?.companyInfo||{};return t.jsx(l,{children:n})},width:"15%"},{key:"orderNumber",title:n("invoice.headers.order"),isSortable:!0,render:e=>t.jsx(l,{sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},onClick:()=>{y(`/orderDetail/${e.orderNumber}`)},children:e?.orderNumber||"-"}),width:"12%"},{key:"createdAt",title:n("invoice.headers.invoiceDate"),isSortable:!0,render:e=>`${e.createdAt?P(Number(e.createdAt)):"–"}`,width:"15%"},{key:"updatedAt",title:n("invoice.headers.dueDate"),isSortable:!0,render:n=>{const{dueDate:i,status:r}=n,a=e>1e3*i&&2!==r;return t.jsx(c,{sx:{color:a?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:`${n.dueDate?P(Number(n.dueDate)):"–"}`})},width:"15%"},{key:"originalBalance",title:n("invoice.headers.invoiceTotal"),isSortable:!0,render:e=>{const{originalBalance:n}=e,t=q(Number(n.value),S);return`${I(n.code)}${t||0}`},width:"10%"},{key:"openBalance",title:n("invoice.headers.amountDue"),isSortable:!0,render:e=>{const{openBalance:n}=e,t=q(Number(n.value),S);return`${I(n.code)}${t||0}`},width:"10%"},{key:"openBalanceToPay",title:n("invoice.headers.amountToPay"),render:e=>{const{openBalance:n,id:i}=e,r=n.code||"USD";let a=n.value,o=!0;if(we.length>0){const e=we.find((e=>{const{node:{id:n}}=e;return Number(n)===Number(i)}));if(e){const{node:{openBalance:t}}=e;o=!1,a=t.value,0===Number(n.value)&&(o=!0)}}return t.jsx(m,{disabled:o,variant:"filled",value:a||"",InputProps:{startAdornment:t.jsx(x,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:I(r)})},sx:{"& input":{paddingTop:"8px"},'& input[type="number"]::-webkit-inner-spin-button, & input[type="number"]::-webkit-outer-spin-button':{WebkitAppearance:"none",margin:0}},onChange:e=>{const n=e.target?.value;Ge(n,i)},type:"number"})},width:"15%"},{key:"status",title:n("invoice.headers.status"),isSortable:!0,render:n=>{const{status:i,dueDate:r}=n;let a=n.status;return 0===i&&e>1e3*r&&(a=3),t.jsx(se,{code:a})}},{key:"companyName",title:n("invoice.headers.action"),render:e=>{const{id:n,companyInfo:i}=e;let r=e;if(we.length>0){const e=we.find((e=>{const{node:{id:t}}=e;return Number(t)===Number(n)}));e&&(r=e.node)}return t.jsx(ae,{row:r,setInvoiceId:_,handleOpenHistoryModal:W,setIsRequestLoading:A,isCurrentCompany:Number(u)===Number(i.companyId),invoicePay:Number(u)===Number(i.companyId)?o:ze})},width:"10%"}];h.useEffect((()=>{let e=n("invoice.exportCsvText");const t=!!Be&&_e(Be),i=t?Le.filter((e=>ve.some((n=>e?.node?.id===n?.node?.id)))):ve;e=t?i.length>0?n("invoice.exportSelectedAsCsv"):n("invoice.exportFilteredAsCsv"):i.length>0?n("invoice.exportSelectedAsCsv"):n("invoice.exportCsvText"),Re(e)}),[ve,Be,Le]);const Xe=pe.map((e=>{const t=e;return"status"===e.name&&(t.label=n(me.status)),t.options=e.options.map((e=>(e.label=n(me[e.key]),e))),e}));return t.jsxs(D,{isSpinning:B,children:[t.jsxs(l,{sx:{overflowX:"auto",display:"flex",flexDirection:"column",flex:1,position:"relative"},children:[t.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:C?"flex-start":"center",flexDirection:C?"column":"row"},children:[t.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:C?"flex-start":"center",flexDirection:C?"column":"row",width:C?"100%":"auto","& > div":{width:C?"100%":"auto"}},children:[a&&p&&t.jsx(l,{sx:{mr:C?0:"10px",mb:"30px"},children:t.jsx(Y,{handleChangeCompanyIds:e=>{const n=e.includes(-1)?[]:e;Pe({...Be,companyIds:n}),$e(e.includes(u)||e.includes(-1)?o:ze)}})}),t.jsx(Z,{filterMoreInfo:Xe,handleChange:(e,n)=>{"search"===e&&(Pe({...Be,q:n}),Fe(!0),re(ue.NORMAL))},handleFilterChange:n=>{const t=n?.startValue?z(new Date(n?.startValue).getTime()/1e3):"",i=n?.endValue?z(new Date(n?.endValue).getTime()/1e3,!0):"",r={status:`${3===n?.status?0:n?.status}`||"",beginDateAt:t,endDateAt:i,beginDueDateAt:0===n?.status?parseInt(""+e/1e3,10):"",endDueDateAt:3===n?.status?parseInt(""+e/1e3,10):""};Pe({...Be,...r}),Fe(!0),re(ue.NORMAL)},startPicker:{isEnabled:!0,label:n("invoice.filter.from"),defaultValue:"number"==typeof Be?.beginDateAt?1e3*Number(Be.beginDateAt):"",pickerKey:"start"},endPicker:{isEnabled:!0,label:n("invoice.filter.to"),defaultValue:"number"==typeof Be?.endDateAt?1e3*Number(Be.endDateAt):"",pickerKey:"end"},searchValue:Be?.q||"",pcContainerWidth:"36rem",pcSearchContainerWidth:"80%"})]}),t.jsxs(l,{sx:{display:"flex",marginBottom:"30px",flexDirection:document.body.clientWidth<=465?"column":"row"},children:[t.jsx(c,{sx:{fontSize:"24px",color:"#000000"},children:n("invoice.openUnpaid",{unpaid:R(le)})}),document.body.clientWidth>=465&&t.jsx(c,{sx:{fontSize:"24px",margin:"0 8px"},children:"|"}),t.jsx(c,{sx:{fontSize:"24px",color:"#D32F2F"},children:n("invoice.overdueAmount",{overdue:R(be)})})]})]}),t.jsx(O,{ref:k,columnItems:Ke,rowsPerPageOptions:[10,20,30],getRequestList:async e=>{const{invoices:{edges:n,totalCount:t}}=await U(e),i=n;return te===ue.DETAIL&&i.length&&i.forEach((e=>{e.node.isCollapse=!0})),i.forEach((e=>{const{node:{openBalance:n}}=e,t=e;t.node.disableCurrentCheckbox=!1,n.originValue=`${Number(n.value)}`,n.value=q(Number(n.value),S),t.node.disableCurrentCheckbox=0===Number(n.value);const{companyInfo:i}=t.node;Number(i.companyId)!==Number(u)&&(t.node.disableCurrentCheckbox=!ze||0===Number(n.value))})),De(i),(async()=>{try{A(!0);const{invoiceStats:e}=await K(Be?.status?Number(Be.status):0,Number(S),Be?.companyIds||[]);if(e){const{overDueBalance:n,totalBalance:t}=e;ce(Number(q(Number(t),S))),fe(Number(q(Number(n),S)))}}catch(e){H.error(e)}finally{A(!1)}})(),Be&&_e(Be)&&i.length?(e=>{if(Te)return Ee(e),void Fe(!1);Le.length||Ee(e);const n=[...Le];e.forEach((e=>{const t=e?.node||e;Le.some((e=>e.node.id===t.id))||n.push(e)})),Ee(n)})(i):Ee([]),{edges:i,totalCount:t}},searchParams:Be,isCustomRender:!1,requestLoading:A,tableKey:"id",showCheckbox:Oe&&s,showSelectAllCheckbox:!C&&Oe&&s,disableCheckbox:!1,applyAllDisableCheckbox:!1,getSelectCheckbox:e=>{if(e.length>0){const n=k.current?.getCacheList()||[],t=e.map((e=>n.find((n=>{const{node:t}=n;return Number(t.id)===Number(e)})))).filter((e=>e&&!e.node.disableCurrentCheckbox));je([...t])}else je([])},CollapseComponent:Ce,sortDirection:We,orderBy:qe,sortByFn:Ve,isSelectOtherPageCheckbox:!0,hover:!0,isAutoRefresh:!1,renderItem:(e,n,i)=>t.jsx(Ne,{item:e,checkBox:i,handleSetSelectedInvoiceAccount:Ge,handleViewInvoice:Ue,setIsRequestLoading:A,setInvoiceId:_,handleOpenHistoryModal:W,selectedPay:we,handleGetCorrespondingCurrency:I,addBottom:Se.length-1===n,isCurrentCompany:Number(u)===Number(e.companyInfo.companyId),invoicePay:Number(u)===Number(e.companyInfo.companyId)?o:ze})}),Se.length>0&&!C&&t.jsx(l,{sx:{position:"absolute",bottom:"8px",left:"20px"},children:t.jsx(d,{variant:"text",onClick:async()=>{try{A(!0);const e=(Be&&_e(Be)?Le.filter((e=>ve.some((n=>e?.node?.id===n?.node?.id)))):ve).map((e=>e.node.id)),n=Be?.status?[Number(Be.status)]:[];let t="-invoice_number";if(Be?.orderBy){const e=String(Be.orderBy);t=e.includes("-")?`-${he[e.split("-")[1]]}`:he[e]}const i={search:Be?.q||"",idIn:`${e||""}`,orderNumber:"",beginDateAt:Be?.beginDateAt||null,endDateAt:Be?.endDateAt||null,status:n,orderBy:t,companyIds:Be?.companyIds||[]},{invoicesExport:r}=await G({invoiceFilterData:i,lang:He||"en"});r?.url&&window.open(r?.url,"_blank")}catch(e){H.error(e)}finally{A(!1)}},children:Ae})})]}),we.length>0&&((o||ze)&&s||i)&&t.jsx(oe,{selectedPay:we,decimalPlaces:S}),t.jsx(de,{open:V,currentInvoiceId:M,setOpen:W}),t.jsx(ge,{receiptId:Number(J),type:te})]})}));const n=async(e,n=!1)=>{const{invoicePdf:{url:t}}=await V(Number(e),n);return t},ie=async(e,t=!1)=>{let i="";try{i=await n(e,t);const r=await(e=>new Promise(((n,t)=>{fetch(e).then((e=>e.blob())).then((e=>{const t=new Blob([e],{type:"application/pdf"}),i=window.URL.createObjectURL(t);n(i)})).catch((e=>{t(e)}))})))(i);return r}catch(r){return i}},re=r(o)((()=>({"& .MuiPaper-elevation":{boxShadow:"0px 1px 0px -1px rgba(0, 0, 0, 0.1), 0px 1px 6px rgba(0, 0, 0, 0.07), 0px 1px 4px rgba(0, 0, 0, 0.06)",borderRadius:"4px"}})));function ae({row:e,setIsRequestLoading:r,setInvoiceId:o,handleOpenHistoryModal:s,isCurrentCompany:l,invoicePay:c}){const d=v((({global:e})=>e.storeInfo.platform)),u=h.useRef(null),[p,m]=h.useState(!1),[x,y]=h.useState(!0),f=Q(),N=b(),{invoicePayPermission:I,purchasabilityPermission:k}=v(g),{getOrderPermission:S}=j,[D,B]=h.useState(!1),P=()=>{m(!1)},A=async n=>{const{id:t}=e;P(),r(!0);const i=await ie(t,n);if(r(!1),!i)return void w.error("pdf url resolution error");const{href:a}=window.location;a.includes("invoice")&&window.open(i,"_blank","fullscreen=yes")};return h.useEffect((()=>{const{openBalance:n,orderUserId:t,companyInfo:i}=e,r=Number(n.value)>0&&I&&k;y(r),y(l?r:r&&c);const a=C({code:S,companyId:Number(i.companyId),userId:Number(t)});B(a)}),[]),t.jsxs(t.Fragment,{children:[t.jsx(i,{onClick:()=>{const{id:n}=e;o(n),m(!0)},ref:u,children:t.jsx(J,{})}),t.jsxs(re,{id:"basic-menu",anchorEl:u.current,open:p,onClose:P,MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[t.jsx(a,{sx:{color:"primary.main"},onClick:()=>A(2!==e.status&&I&&k),children:N("invoice.actions.viewInvoice")},"View-invoice"),D&&t.jsx(a,{sx:{color:"primary.main"},onClick:()=>{const{orderNumber:n}=e;P(),f(`/orderDetail/${n}`)},children:N("invoice.actions.viewOrder")},"View-Order"),0!==e.status&&t.jsx(a,{sx:{color:"primary.main"},onClick:async()=>{P(),s(!0)},children:N("invoice.actions.viewPaymentHistory")},"View-payment-history"),x&&t.jsx(a,{sx:{color:"primary.main"},onClick:async()=>{P();const{openBalance:n,originalBalance:t,id:i}=e,r={lineItems:[{invoiceId:Number(i),amount:"."===n.value?"0":`${Number(n.value)}`}],currency:n?.code||t.code};"."!==n.value&&0!==Number(n.value)?await W(r,d,!1):w.error("The payment amount entered has an invalid value.",{isClose:!0})},children:N("invoice.actions.pay")},"Pay"),t.jsx(a,{sx:{color:"primary.main"},onClick:()=>A(2!==e.status&&I&&k),children:N("invoice.actions.print")},"Print"),t.jsx(a,{sx:{color:"primary.main"},onClick:()=>(async()=>{const{id:t}=e;P(),r(!0);const i=await n(t);r(!1);const a=document.createElement("a");a.href=i,a.target="_blank",a.download="file.pdf",a.click()})(),children:N("invoice.actions.download")},"Download")]})]})}function oe(e){const n=v((({global:e})=>e.storeInfo.platform)),i=b(),[r]=N(),[a,o]=h.useState(0),[u,p]=h.useState("$"),m=v((({b2bFeatures:e})=>e.masqueradeCompany.isAgenting)),x=r?{alignItems:"flex-start",flexDirection:"column"}:{alignItems:"center"},{selectedPay:y,decimalPlaces:f}=e;return h.useEffect((()=>{if(y.length>0){const e=e=>{let n=0;e.forEach((e=>{const{node:{openBalance:t}}=e;n+="."===t.value?0:Number(t.value)})),o(q(n,f))},{node:{openBalance:n}}=y[0],t=I(n.code);p(t),e(y)}}),[f,y]),t.jsxs(s,{sx:{position:"fixed",bottom:r&&m?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:r?"0 0 1rem 0":"0 40px 1rem 40px",height:r?"8rem":"auto",marginLeft:0,display:"flex",flexWrap:"nowrap",zIndex:"999"},container:!0,spacing:2,children:[t.jsx(s,{item:!0,sx:{display:r?"none":"block",width:"290px",paddingLeft:"20px"}}),t.jsx(s,{item:!0,sx:r?{flexBasis:"100%"}:{flexBasis:"690px",flexGrow:1},children:t.jsxs(l,{sx:{width:"100%",pr:"20px",display:"flex",zIndex:"999",justifyContent:"space-between",...x},children:[t.jsx(c,{sx:{color:"#000000",fontSize:"16px",fontWeight:"400"},children:i("invoice.footer.invoiceSelected",{invoices:y.length})}),t.jsxs(l,{sx:{display:"flex",alignItems:"center",flexWrap:r?"wrap":"nowrap",width:r?"100%":"auto"},children:[t.jsx(c,{variant:"h6",sx:{fontSize:"16px",fontWeight:"700",color:"#000000"},children:i("invoice.footer.totalPayment",{total:`${u}${a}`})}),t.jsx(l,{sx:{display:"flex",alignItems:"center",marginTop:r?"0.5rem":0,width:r?"100%":"auto"},children:t.jsx(d,{variant:"contained",sx:{marginLeft:r?0:"1rem",width:r?"100%":"auto"},onClick:()=>{(async()=>{const e=[];let t="SGD";if(y.length>0){if(y.forEach((n=>{const{node:{id:i,openBalance:r,originalBalance:a}}=n,o=q(Number(r.originValue),f)===r.value?Number(r.originValue):Number(r.value);e.push({invoiceId:Number(i),amount:"."===r.value?"0":`${Number(o)}`}),t=r?.code||a.code})),e.find((e=>"."===e.amount||0===Number(e.amount))))return void w.error(i("invoice.footer.invalidNameError"),{isClose:!0});const r={lineItems:e,currency:t};await W(r,n,!1)}})()},children:i("invoice.footer.payInvoices")})})]})]})}),t.jsx(s,{item:!0,sx:r?{flexBasis:"100%",display:r?"none":"block"}:{flexBasis:"0",display:r?"none":"block"}})]})}function se(e){const{code:n}=e,i={0:{textColor:"#000000",name:"Open",color:"#F1C224"},1:{textColor:"#FFFFFF",name:"Partially paid",color:"#516FAE"},2:{textColor:"#000000",name:"Paid",color:"#C4DD6C"},3:{textColor:"#FFFFFF",name:"Overdue",color:"#D32F2F"}}[n]||{};return i.name?t.jsx(k,{color:i.color,textColor:i.textColor,children:i.name}):null}function le({title:e}){return t.jsxs(c,{sx:{fontWeight:"bold",pr:"5px"},children:[e,":"]})}function ce({list:e}){return t.jsx(t.Fragment,{children:e.map((e=>{const{node:{createdAt:n,amount:i,paymentType:r,transactionType:a,referenceNumber:o,id:s}}=e;return t.jsx(u,{sx:{mb:"10px"},children:t.jsxs(p,{sx:{color:"#313440",wordBreak:"break-word"},children:[t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(le,{title:"Date received"}),t.jsx(c,{variant:"body1",children:`${P(Number(n))}`})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(le,{title:"Amount"}),t.jsx(c,{variant:"body1",children:A(i.code,Number(i?.value||0))})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(le,{title:"Transaction type"}),t.jsx(c,{variant:"body1",children:a})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(le,{title:"Payment type"}),t.jsx(c,{variant:"body1",children:r})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(le,{title:"Reference"}),t.jsx(c,{variant:"body1",children:o||"–"})]})]})},s)}))})}function de({open:e,setOpen:n,currentInvoiceId:i}){const r=b(),[a]=N(),[o,s]=h.useState(!1),[c,d]=h.useState([]);return h.useEffect((()=>{e&&i&&(async()=>{s(!0);const{allReceiptLines:{edges:e=[]}}=await M(Number(i));d(e),s(!1)})()}),[e,i]),t.jsx(S,{isOpen:e,leftSizeBtn:"",rightSizeBtn:"ok",title:r("invoice.paymentHistory.title"),showLeftBtn:!1,handRightClick:()=>n(!1),children:t.jsx(l,{sx:{width:a?"100%":"384px",maxHeight:"600px"},children:t.jsx(D,{isSpinning:o,children:t.jsx(l,{sx:{display:"flex",flexDirection:"column",flex:1},children:c.length?t.jsx(ce,{list:c}):t.jsx(B,{})})})})})}const ue={NORMAL:"normal",DETAIL:"detail",CHECKOUT:"checkout"},pe=[{name:"status",label:"Status",required:!1,default:"",fieldType:"dropdown",xs:12,variant:"filled",size:"small",options:[{key:"open",value:0,label:"Open"},{key:"partialPaid",value:1,label:"Partially paid"},{key:"paid",value:2,label:"Paid"},{key:"overdue",value:3,label:"Overdue"}]}],me={status:"invoice.filterStatus.title",open:"invoice.filterStatus.open",partialPaid:"invoice.filterStatus.partiallyPaid",paid:"invoice.filterStatus.paid",overdue:"invoice.filterStatus.overdue"},xe="id",ye={id:"invoiceNumber",orderNumber:"orderNumber",createdAt:"createdAt",updatedAt:"dueDate",originalBalance:"originalBalanceAmount",openBalance:"openBalanceAmount",status:"status"},he={invoiceNumber:"invoice_number",orderNumber:"order_number",createdAt:"created_at",dueDate:"due_date",originalBalanceAmount:"original_balance_amount",openBalanceAmount:"open_balance_amount"};function be({title:e,withColon:n=!0}){return t.jsx(c,{sx:{fontWeight:"bold",pr:"5px"},children:n?`${e}:`:e})}function fe({isRow:e=!0,type:n="",value:i,label:r,code:a}){return t.jsxs(l,{sx:{display:"flex",flexDirection:e?"row":"column"},children:[t.jsx(be,{title:r}),t.jsx(c,{variant:"body1",children:`${(()=>{if("time"===n)return P(Number(i))||"";if("currency"===n){const e=Number(i||0);return A(a,e)}if("paymentType"===n){let e=`${i}`.trim();return i&&(e=e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()),e}return i||"–"})()}`})]})}function ve({list:e}){const{receiptLineSet:{edges:n=[]},details:i}=e,r=i?.paymentDetails?.comment||"",a=b();return t.jsxs(l,{children:[[{key:"paymentId",label:"Payment#",type:"",isRow:!0,idLang:"payment.paymentNumber"},{key:"createdAt",label:"Payment received on",type:"time",isRow:!0,idLang:"payment.paymentReceivedOn"},{key:"transactionType",label:"Transaction type",type:"",isRow:!0,idLang:"payment.transactionType"},{key:"paymentType",label:"Payment type",type:"paymentType",isRow:!0,idLang:"payment.paymentType"},{key:"totalAmount",label:"Payment total",type:"currency",isRow:!0,idLang:"payment.paymentTotal"},{key:"referenceNumber",label:"Reference",type:"",isRow:!0,idLang:"payment.reference"}].map((n=>t.jsx(fe,{isRow:!!n.isRow,type:n.type,value:e[n.key],code:e?.totalCode||"SGD",label:a(n.idLang)}))),t.jsxs(l,{sx:{display:"flex",flexDirection:"column",mb:"30px"},children:[t.jsx(be,{title:a("payment.paymentComment")}),t.jsx(c,{sx:{maxHeight:"50px"},children:r})]}),t.jsxs(l,{sx:{display:"flex",flexDirection:"column"},children:[t.jsx(be,{title:a("payment.invoicesPaid"),withColon:!1}),t.jsxs(c,{variant:"body1",children:[a("payment.paymentTowardsInvoices")," "]})]}),t.jsxs(l,{children:[t.jsxs(l,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between",fontWeight:500},children:[t.jsx(c,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:a("payment.invoiceNumber")}),t.jsx(c,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:a("payment.amountPaid")})]}),n.map((e=>{const{invoiceNumber:n,amount:{value:i,code:r}}=e.node,a=Number(i||0),o=A(r,a);return t.jsxs(l,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between"},children:[t.jsx(c,{children:n}),t.jsx(c,{children:o})]})}))]})]})}function ge({receiptId:e,type:n}){const[i]=N(),[r,a]=h.useState(!1),[o,s]=h.useState(!1),[c,u]=h.useState(null),p=Q(),m=b();h.useEffect((()=>{n===ue.CHECKOUT&&e&&(async()=>{a(!0);const{receipt:n}=await _(Number(e));u(n),s(!0),a(!1)})()}),[e,n]);const x=()=>{s(!1),p("/invoice")};return t.jsx(S,{isOpen:o,leftSizeBtn:"",customActions:()=>t.jsx(d,{onClick:x,variant:"text",children:m("payment.okButton")}),title:m("payment.paymentSuccess"),showLeftBtn:!1,children:t.jsx(l,{sx:{width:i?"100%":"384px",maxHeight:"600px"},children:t.jsx(D,{isSpinning:r,children:t.jsx(l,{sx:{display:"flex",flexDirection:"column",flex:1},children:c?t.jsx(ve,{list:c}):t.jsx(B,{})})})})})}const je=300;function Ce({row:e}){const n=h.useRef(null),i=h.useRef(null),[r,a]=h.useState(!1),[o,s]=h.useState(je);return h.useEffect((()=>((async()=>{a(!0);const{id:t}=e,i=await ie(t);i?n?.current&&(te.embed(i,n.current),a(!1)):w.error("pdf url resolution error")})(),()=>{n.current=null})),[e]),t.jsx(D,{isSpinning:r,children:t.jsx(l,{ref:i,sx:{display:"flex",flexWrap:"wrap",width:"100%","& .box":{display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",width:"100%","& .react-resizable":{position:"relative"},"& .react-resizable-handle":{position:"absolute",width:"100%",height:"30px",backgroundRepeat:"no-repeat",backgroundOrigin:"content-box",boxSizing:"border-box"},"& .react-resizable-handle-s":{cursor:"ns-resize",bottom:0}}},children:t.jsx(ne,{className:"box",height:o,minConstraints:[i?.current?.offsetWidth||0,0],width:i.current?.offsetWidth||0,onResize:(e,{size:n})=>{s(n.height)},resizeHandles:["s"],children:t.jsx("div",{style:{width:"100%",height:`${o}px`},children:t.jsx("div",{ref:n,style:{height:"100%",width:"100%"}})})})})})}const we=y(l)((()=>({"& > span":{padding:"0 9px 0 0"}})));function Ne(e){const n=(new Date).getTime(),{item:i,checkBox:r,handleSetSelectedInvoiceAccount:a,handleViewInvoice:o,setIsRequestLoading:s,setInvoiceId:d,handleOpenHistoryModal:y,selectedPay:h=[],handleGetCorrespondingCurrency:f,addBottom:v,isCurrentCompany:g,invoicePay:j}=e,C=b(),w=Q(),{id:N,status:I,dueDate:k,openBalance:S,companyInfo:D}=i,B=f(S.code||"USD");let A=i.status;0===I&&n>1e3*k&&(A=3);const T=[{key:"orderNumber",title:C("invoice.invoiceItemCardHeader.order"),render:()=>t.jsx(l,{sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{w(`/orderDetail/${i.orderNumber}`)},children:i?.orderNumber||"-"})},{key:"createdAt",title:C("invoice.invoiceItemCardHeader.invoiceDate"),render:()=>`${i.createdAt?P(Number(i.createdAt)):"–"}`},{key:"updatedAt",title:C("invoice.invoiceItemCardHeader.dueDate"),render:()=>{const{dueDate:e,status:r}=i,a=n>1e3*e&&2!==r;return t.jsx(c,{sx:{color:a?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:`${i.dueDate?P(Number(i.dueDate)):"–"}`})}},{key:"originalBalance",title:C("invoice.invoiceItemCardHeader.invoiceTotal"),render:()=>{const{originalBalance:e}=i,n=Number(e.value);return R(n||0)}},{key:"openBalance",title:C("invoice.invoiceItemCardHeader.amountDue"),render:()=>{const{openBalance:e}=i,n=Number(e.value);return R(n||0)}},{key:"openBalanceToPay",title:C("invoice.invoiceItemCardHeader.amountToPay"),render:()=>{const{openBalance:e,id:n}=i;let r=e.value,o=!0;if(h.length>0){const t=h.find((e=>{const{node:{id:t}}=e;return Number(t)===Number(n)}));if(t){const{node:{openBalance:n}}=t;o=!1,r=n.value,0===Number(e.value)&&(o=!0)}}return t.jsx(m,{disabled:o,variant:"filled",value:r,InputProps:{startAdornment:t.jsx(x,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:B||"$"})},sx:{"& input":{paddingTop:"8px"}},onChange:e=>{const t=e.target?.value;a(t,n)},type:"number"})}}];return t.jsx(u,{sx:{marginBottom:h.length>0&&v?"5rem":0},children:t.jsxs(p,{sx:{color:"rgba(0, 0, 0, 0.6)"},children:[t.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:"0.5rem"},children:[t.jsx(we,{children:r&&r(!!i?.disableCurrentCheckbox)}),t.jsx(c,{variant:"h6",sx:{color:"rgba(0, 0, 0, 0.87)"},children:t.jsx(l,{sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{o(N,I,D.companyId)},children:N||"-"})})]}),t.jsx(l,{sx:{mb:"0.5rem"},children:t.jsx(ae,{row:i,setInvoiceId:d,handleOpenHistoryModal:y,setIsRequestLoading:s,isCurrentCompany:g,invoicePay:j})})]}),t.jsx(l,{sx:{mb:"1rem"},children:t.jsx(se,{code:A})}),T.map((e=>t.jsxs(l,{sx:{display:"flex",alignItems:"center",mt:"4px"},children:[t.jsx(c,{sx:{fontWeight:"bold",color:"rgba(0, 0, 0, 0.87)",mr:"5px",whiteSpace:"nowrap"},children:`${e.title}:`}),t.jsx(l,{sx:{color:"black",wordBreak:"break-all"},children:e?.render?e.render():i[e.key]})]},e.key)))]})})}const Ie={q:"",first:10,offset:0,orderBy:`-${ye[xe]}`,companyIds:[]}}}}));
//# sourceMappingURL=index-legacy-DsvpDiUt.js.map
