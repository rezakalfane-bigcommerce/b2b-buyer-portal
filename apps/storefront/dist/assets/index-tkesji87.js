import{j as I,B as ae}from"./mui-BLXOPN2Y.js";import{r as x}from"./reactVendor-BTcQ-GDs.js";import{u as oe}from"./form-hNmOEDBo.js";import{u as re}from"./lang-DZEhsX8V.js";import{t as q}from"./lodashEs-DKEtmQJE.js";import{j as le,C as ne,a as ie,ac as fe,a8 as M,ad as te,k as T,u as N,t as de,ae as me,af as U,X as ue,ag as ce}from"./react-setup-Dk2lMx-W.js";import{B as pe}from"./B3CustomForm-WDZRXEWC.js";import"./load-functions-adwiw1MZ.js";import"./base-BCVDEF8S.js";import{c as Fe,a as be}from"./users-BXLfwXk2.js";import{g as we,a as he,u as xe,b as ye}from"./accountSetting-D25-Ib2V.js";import{d,g as ge}from"./config-1L-KDVt7.js";import{v as Ne}from"./validatorRules-BRQ7DvFQ.js";import{u as _e}from"./router-DEI8QtBD.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.COFs9ak5.js";import"./global-D7Yn0gGb.js";import"./muiIcon-DcrdeM0-.js";import"./dateFns-CXOS6Mtj.js";import"./dropzone-BOmS2zFM.js";const Ee=()=>[{name:"company",fieldId:"field_company",label:"Company",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"},{name:"role",fieldId:"field_role",label:"Role",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"}],Ce=()=>[{name:"currentPassword",fieldId:"field_current_password",label:"Current Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"password",fieldId:"field_password",label:"Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"confirmPassword",fieldId:"field_confirm_password",label:"Confirm Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"}],O=Ne(["email"]),Be=(e,o,u,n)=>{const l=(e==null?void 0:e.extraFields)||[];return o.forEach(s=>{const a=s;d((s==null?void 0:s.name)||"")==="first_name"&&(a.default=e.firstName),d((s==null?void 0:s.name)||"")==="last_name"&&(a.default=e.lastName),d((s==null?void 0:s.name)||"")==="phone"&&(a.default=e.phoneNumber),d((s==null?void 0:s.name)||"")==="email"&&(a.default=e.email,a.validate=O)}),l.length>0&&l.forEach(s=>{const a=s,t=o.find(r=>d((r==null?void 0:r.name)||"")===a.fieldName);t&&(t.default=a.fieldValue)}),u.forEach(s=>{const a=s;s.name==="role"?(a.default=e.companyRoleName,a.disabled=!0):s.name==="company"&&(a.default=e.company,a.disabled=!0)}),n.forEach(s=>{const a=((e==null?void 0:e.formFields)||[]).find(r=>r.name===s.bcLabel),t=s;a&&(t.default=a.value)}),[...o,...u,...n]},Ie=(e,o,u)=>(o.forEach(n=>{const l=n;d((n==null?void 0:n.name)||"")==="first_name"&&(l.default=e.firstName),d((n==null?void 0:n.name)||"")==="last_name"&&(l.default=e.lastName),d((n==null?void 0:n.name)||"")==="phone"&&(l.default=e.phoneNumber),d((n==null?void 0:n.name)||"")==="email"&&(l.default=e.email,l.validate=O),d((n==null?void 0:n.name)||"")==="company"&&(l.default=e.company)}),u.forEach(n=>{const l=((e==null?void 0:e.formFields)||[]).find(a=>a.name===n.bcLabel),s=n;l&&(s.default=l.value)}),[...o,...u]),Me=(e,o,u,n)=>{const l=(o==null?void 0:o.extraFields)||[],s={};s.formFields=[];let a=!0,t=!0,r=!1;if(Object.keys(e).forEach(c=>{u.forEach(i=>{if(c===i.name&&(t=!1,d(i.name)==="first_name"&&(o.firstName!==e[i.name]&&(a=!1),s.firstName=e[i.name]),d(i.name)==="last_name"&&(o.lastName!==e[i.name]&&(a=!1),s.lastName=e[i.name]),d(i.name)==="phone"&&(o.phoneNumber!==e[i.name]&&(a=!1),s.phoneNumber=e[i.name]),d(i.name)==="email"&&(o.email!==e[i.name]&&(a=!1),s.email=e[i.name]),i.custom)){const f=l.find(h=>h.fieldName===d((i==null?void 0:i.name)||""));(f==null?void 0:f.fieldValue)!==e[i.name]&&(r=!0)}}),r&&(a=!1),t&&n.forEach(i=>{var f;if(i.fieldId===c&&(s!=null&&s.formFields)){const{name:h}=i;s.formFields.push({name:(i==null?void 0:i.bcLabel)||"",value:e[c]}),t=!1;const g=((o==null?void 0:o.formFields)||[]).find(_=>_.name===i.bcLabel);g&&JSON.stringify(g.value)!==JSON.stringify(e[c])&&(a=!1),!((f=o==null?void 0:o.formFields)!=null&&f.length)&&h&&e[h]&&(a=!1)}}),t&&(c==="password"?(s.newPassword=e[c],e[c]&&(a=!1)):s[c]=e[c]),t=!0}),delete s.company,delete s.role,!a)return s},ve=(e,o,u,n)=>{const l={};l.formFields=[];let s=!0,a=!0;if(Object.keys(e).forEach(t=>{u.forEach(r=>{t===r.name&&(a=!1,d(r.name)==="first_name"&&(o.firstName!==e[r.name]&&(s=!1),l.firstName=e[r.name]),d(r.name)==="last_name"&&(o.lastName!==e[r.name]&&(s=!1),l.lastName=e[r.name]),d(r.name)==="phone"&&(o.phoneNumber!==e[r.name]&&(s=!1),l.phoneNumber=e[r.name]),d(r.name)==="email"&&(o.email!==e[r.name]&&(s=!1),l.email=e[r.name]),d(r.name)==="company"&&(o.company!==e[r.name]&&(s=!1),l.company=e[r.name]))}),a&&n.forEach(r=>{if(r.fieldId===t&&(l!=null&&l.formFields)){l.formFields.push({name:(r==null?void 0:r.bcLabel)||"",value:e[t]}),a=!1;const c=((o==null?void 0:o.formFields)||[]).find(i=>i.name===r.bcLabel);c&&JSON.stringify(c.value)!==JSON.stringify(e[t])&&(s=!1)}}),a&&(t==="password"?(l.newPassword=e[t],e[t]&&(s=!1)):l[t]=e[t]),a=!0}),!s)return l};function Pe(){const e=N(de),o=N(({company:f})=>f.companyInfo.id),u=N(({company:f})=>f.customer),n=N(({company:f})=>f.customer.role),l=N(({b2bFeatures:f})=>f.masqueradeCompany.id),s=N(({b2bFeatures:f})=>f.masqueradeCompany.isAgenting),a=Number(n===3&&s?l:o),t=!e||n===3&&!s;return{isBCUser:t,companyId:a,customer:u,validateEmailValue:async f=>{if(u.emailAddress===q(f))return!0;const h={email:f,channelId:ce},{isValid:g}=t?await Fe(h):await be(h);return g},emailValidation:f=>!(f.email!==u.emailAddress&&!f.currentPassword),passwordValidation:f=>f.password===f.confirmPassword}}function es(){const{isBCUser:e,companyId:o,customer:u,validateEmailValue:n,emailValidation:l,passwordValidation:s}=Pe(),{control:a,handleSubmit:t,getValues:r,formState:{errors:c},setValue:i,setError:f}=oe({mode:"onSubmit"}),[h,g]=le("sf-isFinishUpdate",!1,sessionStorage),{state:{portalStyle:{backgroundColor:_="#FEF9F5"}}}=x.useContext(ne),m=re(),[v]=ie(),z=_e(),[P,D]=x.useState([]),[J,H]=x.useState([]),[S,G]=x.useState([]),[X,E]=x.useState(!1),[K,Q]=x.useState({}),[W,Y]=x.useState(!1);x.useEffect(()=>{(async()=>{try{E(!0);const w=e?we:he,y=e?{}:{companyId:o},p=e?"customerAccountSettings":"accountSettings",R=await me(e?1:2),F=ge(R.accountFormFields||[]),C=((F==null?void 0:F.contactInformation)||[]).filter(L=>L.fieldId!=="field_email_marketing_newsletter"),{additionalInformation:A=[]}=F,{[p]:V}=await w(y),ee=e?Ie(V,C,A):Be(V,C,Ee(),A),se=Ce(),j=[...ee,...se],B=j.find(L=>L.name==="role");B!=null&&B.fieldType&&(B.fieldType="text"),D(j),Q(V),H(C),G(A)}finally{h&&(U.success(m("accountSettings.notification.detailsUpdated")),g(!1)),E(!1),Y(!0)}})()},[]);const Z=(b,w)=>w.filter(p=>p.custom&&p.groupId===1).map(p=>({fieldName:d((p==null?void 0:p.name)||""),fieldValue:b[p.name]})),$=()=>{t(async b=>{E(!0);try{const w=await n(b.email);w||f("email",{type:"custom",message:m("accountSettings.notification.emailExists")});const y=l(b);y||U.error(m("accountSettings.notification.updateEmailPassword"));const p=s(b);if(p||(f("confirmPassword",{type:"manual",message:m("global.registerComplete.passwordMatchPrompt")}),f("password",{type:"manual",message:m("global.registerComplete.passwordMatchPrompt")})),w&&y&&p){const F=(e?ve:Me)(b,K,J,S);if(F&&(e||(F.companyId=o,F.extraFields=Z(b,P)),F.newPassword===""&&F.confirmPassword===""&&(delete F.newPassword,delete F.confirmPassword)),!F){U.success(m("accountSettings.notification.noEdits"));return}await(e?xe:ye)(F),b.password&&b.currentPassword||u.emailAddress!==q(b.email)?z("/login?loginFlag=loggedOutLogin"):(ue.clear(),g(!0),window.location.reload())}}finally{E(!1)}})()},k=x.useMemo(()=>{const b={field_first_name:m("accountSettings.form.firstName"),field_last_name:m("accountSettings.form.lastName"),field_email:m("accountSettings.form.email"),field_phone_number:m("accountSettings.form.phoneNumber"),field_company:m("accountSettings.form.company"),field_role:m("accountSettings.form.role"),field_current_password:m("accountSettings.form.currentPassword"),field_password:m("accountSettings.form.password"),field_confirm_password:m("accountSettings.form.confirmPassword")};return P.map(w=>{var y,p;return{...w,label:(p=b[(y=w.fieldId)!=null?y:""])!=null?p:w.label}})},[P,m]);return I.jsx(fe,{isSpinning:X,background:_,children:I.jsxs(ae,{sx:{width:v?"100%":"35%",minHeight:v?"800px":"300px","& input, & .MuiFormControl-root .MuiTextField-root, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{bgcolor:M("#FFFFFF",.87),borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"},"& .MuiButtonBase-root.MuiCheckbox-root:not(.Mui-checked), & .MuiRadio-root:not(.Mui-checked)":{color:M(T(_),.6)},"& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label, & .MuiFormControl-root .MuiFormLabel-root:not(.Mui-focused)":{color:M(T(_),.87)},"& .MuiInputLabel-root.MuiInputLabel-formControl:not(.Mui-focused)":{color:M(T("#FFFFFF"),.6)}},children:[I.jsx(pe,{formFields:k,errors:c,control:a,getValues:r,setValue:i}),I.jsx(te,{sx:{mt:"28px",mb:v?"20px":"0",width:"100%",visibility:W?"visible":"hidden"},onClick:$,variant:"contained",children:m("accountSettings.button.saveUpdates")})]})})}export{es as default};
//# sourceMappingURL=index-tkesji87.js.map
