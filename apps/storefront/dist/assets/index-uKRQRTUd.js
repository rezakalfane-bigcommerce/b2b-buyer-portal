import{j as r,L as F,B as g,I as N,C as H,X as I,Y as T,aE as D,M as P,N as K,O as Q,Q as v,R as k,V}from"./mui-Cw0dwOiN.js";import{r as o}from"./reactVendor-BTcQ-GDs.js";import{C as A,a as W,u as E,ac as X,cm as Y}from"./react-setup-DSYWb28G.js";import"./load-functions-DL5N0fkL.js";import{H as q,b as G}from"./HierarchyDialog-C6ceVNTM.js";import"./base-BCVDEF8S.js";import{u as z}from"./lang-6J3-0YIA.js";import{B as L,M as R,K as J}from"./muiIcon-BiFRwRtm.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"./lodashEs-DKEtmQJE.js";import"../index.hStmN1DJ.js";import"./global-D7Yn0gGb.js";import"./router-DEI8QtBD.js";import"./dateFns-CeqDayOU.js";import"./dropzone-Cizh2goU.js";function U({company:e,currentCompanyId:m="",selectCompanyId:a="",onSwitchCompany:t,getDisplayName:d=s=>s.companyName,getNodeId:p=s=>s.companyId}){const s=p(e),[i,c]=o.useState(null),h=z(),{state:{switchAccountButton:{color:n="#ED6C02"}}}=o.useContext(A),u=Number(s)===Number(m),x=Number(s)===Number(a),b=!!i,l=o.useMemo(()=>a?Number(a)!==Number(e.companyId):Number(m)!==Number(e.companyId),[m,a,e]),j=M=>{c(M.currentTarget)},C=()=>{c(null)},f=()=>{C(),t==null||t(e)},w=b?{borderRadius:"10%",backgroundColor:"rgba(0, 0, 0, 0.14)"}:{};return r.jsxs(F,{sx:{padding:"16px",marginBottom:"16px"},children:[r.jsxs(g,{children:[r.jsxs(g,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[r.jsxs(g,{sx:{display:"flex",alignItems:"flex-start"},children:[r.jsx(L,{sx:{color:"rgba(0, 0, 0, 0.54)",mr:1}}),d(e)]}),(e==null?void 0:e.channelFlag)&&l&&r.jsx(N,{size:"small",onClick:j,"aria-controls":b?"company-menu":void 0,"aria-haspopup":"true","aria-expanded":b?"true":void 0,sx:{pt:0,"& svg":{...w}},children:r.jsx(R,{})})]}),x&&r.jsx(H,{label:h("companyHierarchy.chip.selectCompany"),size:"small",sx:{mt:2,backgroundColor:n,color:"white",height:24,"& .MuiChip-label":{px:1}}}),u&&r.jsx(H,{label:h("companyHierarchy.chip.currentCompany"),size:"small",sx:{mt:2,backgroundColor:"primary.main",color:"white",height:24,"& .MuiChip-label":{px:1}}})]}),r.jsx(I,{id:"company-menu",anchorEl:i,open:b,onClose:C,MenuListProps:{"aria-labelledby":"company-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:r.jsx(T,{sx:{color:"primary.main"},onClick:f,children:h("companyHierarchy.dialog.title")})})]})}function S({node:e,level:m=0,currentCompanyId:a="",selectCompanyId:t="",onSwitchCompany:d,getDisplayName:p=i=>i.companyName,getNodeId:s=i=>i.companyId}){const[i,c]=o.useState(!0),[h,n]=o.useState(null),u=z(),{state:{switchAccountButton:{color:x="#ED6C02"}}}=o.useContext(A),b=e.children&&e.children.length>0,l=s(e),j=Number(l)===Number(a),C=Number(l)===Number(t),f=!!h,w=o.useMemo(()=>t?Number(t)!==Number(e.companyId):Number(a)!==Number(e.companyId),[a,t,e]),M=y=>{n(y.currentTarget)},B=()=>{n(null)},O=()=>{B(),d==null||d(e)};return r.jsxs(r.Fragment,{children:[r.jsxs(v,{sx:{"&:last-child td, &:last-child th":{border:0},"& > td":{bgcolor:"background.paper"},height:"3.25rem"},children:[r.jsx(k,{sx:{width:"100%",py:1},children:r.jsx(g,{sx:{display:"flex",alignItems:"center"},children:r.jsxs(g,{sx:{display:"flex",ml:m*4,alignItems:"center"},children:[b?r.jsx(N,{size:"small",onClick:()=>c(!i),sx:{mr:1},children:r.jsx(J,{sx:{transform:i?"rotate(0deg)":"rotate(-90deg)",transition:"transform 0.2s",color:"rgba(0, 0, 0, 0.54)"}})}):r.jsx(g,{sx:{width:40}}),r.jsx(g,{sx:{mr:1,display:"flex",alignItems:"center"},children:r.jsx(L,{sx:{color:"rgba(0, 0, 0, 0.54)"}})}),r.jsx(g,{component:"span",sx:{mr:1},children:p(e)}),C&&r.jsx(H,{label:u("companyHierarchy.chip.selectCompany"),size:"small",sx:{backgroundColor:x,color:"white",height:24,"& .MuiChip-label":{px:1}}}),j&&r.jsx(H,{label:u("companyHierarchy.chip.currentCompany"),size:"small",sx:{backgroundColor:"primary.main",color:"white",height:24,"& .MuiChip-label":{px:1}}})]})})}),r.jsxs(k,{align:"right",sx:{width:48,py:1},children:[(e==null?void 0:e.channelFlag)&&w&&r.jsx(N,{size:"small",onClick:M,"aria-controls":f?"company-menu":void 0,"aria-haspopup":"true","aria-expanded":f?"true":void 0,children:r.jsx(R,{})}),r.jsx(I,{id:"company-menu",anchorEl:h,open:f,onClose:B,MenuListProps:{"aria-labelledby":"company-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:r.jsx(T,{sx:{color:"primary.main"},onClick:O,children:u("companyHierarchy.dialog.title")})})]})]}),i&&b&&((e==null?void 0:e.children)||[]).map(y=>r.jsx(S,{node:y,level:m+1,currentCompanyId:a,selectCompanyId:t,onSwitchCompany:d,getDisplayName:p,getNodeId:s},s(y)))]})}function Z({data:e,currentCompanyId:m,selectCompanyId:a,onSwitchCompany:t,getDisplayName:d=s=>s.companyName,getNodeId:p=s=>s.companyId}){const[s]=W(),i=z(),c=(n,u)=>(n.length===0||n.forEach(x=>{u.push({...x,children:[]}),x.children&&x.children.length>0&&c((x==null?void 0:x.children)||[],u)}),u),h=c(e,[]);return r.jsx(r.Fragment,{children:s?r.jsx(r.Fragment,{children:h.map(n=>r.jsx(U,{company:n,currentCompanyId:m,selectCompanyId:a,onSwitchCompany:t,getDisplayName:d,getNodeId:p}))}):r.jsx(D,{sx:{width:"100%",minHeight:"100px",mx:"auto",mt:2},children:r.jsx(P,{children:r.jsxs(K,{size:"small","aria-label":"company structure table",children:[r.jsx(Q,{children:r.jsxs(v,{sx:{height:"3.25rem"},children:[r.jsx(k,{sx:{fontWeight:500,pl:8},children:i("companyHierarchy.table.name")}),r.jsx(k,{sx:{width:48}})]})}),r.jsx(V,{children:e.map(n=>r.jsx(S,{node:n,currentCompanyId:m,selectCompanyId:a,onSwitchCompany:t,getDisplayName:d,getNodeId:p},p(n)))})]})})})})}function br(){const[e,m]=o.useState([]),[a,t]=o.useState(!1),[d,p]=o.useState(null),[s,i]=o.useState(!1),c=o.useRef([]),{id:h}=E(({company:l})=>l.companyInfo),{selectCompanyHierarchyId:n}=E(({company:l})=>l.companyHierarchyInfo),u=async()=>{i(!0);const{companySubsidiaries:l}=await Y(),j=G({data:l||[]});c.current=l,m(j),i(!1)};o.useEffect(()=>{h&&u()},[h]);const x=()=>{t(!1)},b=l=>{p(l),t(!0)};return r.jsx(X,{isSpinning:s,children:r.jsxs(g,{sx:{display:"flex",flexDirection:"column",flex:1,width:"100%"},children:[r.jsx(Z,{data:e,onSwitchCompany:b,currentCompanyId:h,selectCompanyId:n}),r.jsx(q,{open:a,handleClose:x,currentRow:d,companyHierarchyAllList:(c==null?void 0:c.current)||[]})]})})}export{br as default};
//# sourceMappingURL=index-uKRQRTUd.js.map
