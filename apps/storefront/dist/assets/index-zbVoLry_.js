import{x as he,j as c,B,a6 as ge,a1 as xe}from"./mui-BLXOPN2Y.js";import{r as b}from"./reactVendor-BTcQ-GDs.js";import{u as be}from"./form-hNmOEDBo.js";import{u as ye}from"./lang-DZEhsX8V.js";import{e as Fe}from"./lodashEs-DKEtmQJE.js";import{B as Ce}from"./B3Card-j8IQEPIr.js";import{B as N}from"./B3CustomForm-WDZRXEWC.js";import{a as Be,G as we,u as Ee,bL as Le,C as je,k as Ae,ac as Se,ad as Ie,ae as Re,al as Ne,K as Te,bF as ve,ag as Me,bN as Ve,aH as ke}from"./react-setup-Dk2lMx-W.js";import"./load-functions-adwiw1MZ.js";import{b as j}from"./base-BCVDEF8S.js";import{l as Ue}from"./b3Login-gJC9K58o.js";import{c as qe,g as De,d as y,h as ze,a as Pe,B as He,t as Oe}from"./config-1L-KDVt7.js";import{a as _e,b as Ge,R as We,c as Je,T as Ke,I as T}from"./RegisteredFinish-D9TQpbzd.js";import{u as $e}from"./router-DEI8QtBD.js";import"./intl-CKipw3rV.js";import"./eCache-BdHG5F0B.js";import"./muiIcon-DcrdeM0-.js";import"./redux-D7_Lh1Zo.js";import"./toolkit-C5fVsw89.js";import"../index.COFs9ak5.js";import"./global-D7Yn0gGb.js";import"./dateFns-CXOS6Mtj.js";import"./dropzone-BOmS2zFM.js";import"./validatorRules-BRQ7DvFQ.js";const Qe=he(B)({"& #b3-customForm-id-name":{'& label[data-shrink="true"]':{whiteSpace:"break-spaces",minWidth:"calc(133% - 24px)",transition:"unset"},'& label[data-shrink="false"]':{whiteSpace:"break-spaces"}}});function Ct(_){var P,H,O;const[v,w]=b.useState(""),[M,G]=b.useState(!1),{setOpenPage:W}=_,F=ye(),[V]=Be(),{control:A,handleSubmit:J,getValues:C,formState:{errors:S},setValue:E,setError:L,watch:K}=be({mode:"onSubmit"}),{state:{storeName:$,logo:k,blockPendingAccountOrderCreation:Q,registerEnabled:U}}=b.useContext(we),I=$e(),X=Ee(({company:i})=>i.customer),{id:Y,firstName:Z,lastName:ee,emailAddress:q,phoneNumber:te}=X,{state:se,dispatch:p}=b.useContext(Le),{state:{companyAutoApproval:D,portalStyle:{backgroundColor:ae="#FEF9F5"}}}=b.useContext(je),re=Ae(ae),x=(i=!1)=>{p({type:"loading",payload:{isLoading:i}})};b.useEffect(()=>{x(!1),U||I("/login")},[U]),b.useEffect(()=>{(async()=>{try{p&&(x(!0),p({type:"finishInfo",payload:{submitSuccess:!1}}));const l=await Re(3),o=((l==null?void 0:l.accountFormFields)||[]).map(e=>{const t=e;return qe.includes((e==null?void 0:e.fieldId)||"")&&e.groupId===4&&(t.isRequired=!0,t.visible=!0),e}),s=De(o||[]),{countries:a}=await Ne(),r=s.address.map(e=>{const t=e;return e.name==="country"&&(t.options=a,t.replaceOptions={label:"countryName",value:"countryName"}),e}),n={phone:te,first_name:Z,last_name:ee,email:q},d=s.contactInformation.map(e=>{const t=e;return t.disabled=!0,t.default=n[y(e.name)]||e.default,e.required&&!(e!=null&&e.default)&&(t.disabled=!1),e});p&&p({type:"all",payload:{isLoading:!1,storeName:$,bcTob2bContactInformation:[...d],bcTob2bCompanyExtraFields:[],bcTob2bCompanyInformation:[...s.businessDetails],bcTob2bAddressBasicFields:[...r],countryList:[...a]}})}catch(l){j.error(l)}})()},[]);const{bcTob2bContactInformation:m,isLoading:oe,bcTob2bCompanyInformation:h=[],bcTob2bAddressBasicFields:g=[],countryList:z=[],bcTob2bCompanyExtraFields:ne=[]}=se;b.useEffect(()=>{const i=(s,a="")=>{var d;const r=((d=z.find(e=>e.countryCode===s||e.countryName===s))==null?void 0:d.states)||[],n=g.find(e=>e.name==="state");n&&(r.length>0?(n.fieldType="dropdown",n.options=r,n.required=!0):(n.fieldType="text",n.options=[],n.required=!1)),E("state",a&&s&&(r.find(e=>e.stateCode===a)||r.length===0)?a:""),p({type:"stateList",payload:{stateList:r,bcTob2bAddressBasicFields:[...g]}})};(()=>{const s=C("country"),a=C("state");i(s,a)})();const o=K((s,{name:a,type:r})=>{const{country:n,state:d}=s;a==="country"&&r==="change"&&i(n,d)});return()=>o.unsubscribe()},[z]);const ie=async(i,l)=>{let o=[];if(i.length){i.forEach(s=>{o=l[s.name]||[]});try{return(await Promise.all(o.map(r=>ve({file:r,type:"companyAttachedFile"})))).reduce((r,n)=>{let d=r;if(n.code===200){const e={...n.data};e.fileSize=e.fileSize?"".concat(e.fileSize):"",d=[...r,e]}else throw n.data.errMsg||n.message||F("intl.global.fileUpload.fileUploadFailure");return d},[])}catch(s){throw j.error(s),s}}},le=async(i,l,o,s)=>{const a={};a.customerId=l||"",a.storeHash=ke,a.userExtraFields=s;const r=h.filter(t=>!t.custom&&t.fieldType!=="files"),n=h.filter(t=>!!t.custom);if(r.length&&r.forEach(t=>{a[Oe(y(t.name))]=i[t.name]||""}),n.length){const t=[];n.forEach(f=>{const u={};u.fieldName=y(f.name),u.fieldValue=i[f.name]||"",t.push(u)}),a.extraFields=t}const d=g.filter(t=>!t.custom),e=g.filter(t=>!!t.custom);if(d.length&&d.forEach(t=>{const f=y(t.name);f==="address1"&&(a.addressLine1=i[t.name]||""),f==="address2"&&(a.addressLine2=i[t.name]||""),a[f]=i[t.name]||""}),e.length){const t=[];e.forEach(f=>{const u={};u.fieldName=y(f.name),u.fieldValue=i[f.name]||"",t.push(u)}),a.addressExtraFields=t}return a.fileList=o,a.channelId=Me,Ve(a)},ce=async i=>{var l;try{const o=h.filter(r=>!!r.custom),s=o.map(r=>({fieldName:y(r.name),fieldValue:i[r.name]||r.default})),a=await ze({extraFields:s});if(a.code!==200){const r=((l=a.data)==null?void 0:l.errMsg)||a.message||"",n=r.split(":");if(n.length>=2){const d=o.find(e=>y(e.name)===n[0]);if(d)return L(d.name,{type:"manual",message:n[1]}),x(!1),!1}throw r}return w(""),!0}catch(o){throw j.error(o),o}},de=()=>{var o;const i=C(),l=h.find(s=>s.fieldId==="field_attachments");return!Fe(l)&&l.required&&i[l.name].length===0?(L(l.name,{type:"required",message:F("global.validate.required",{label:(o=l.label)!=null?o:""})}),x(!1),!0):!1},ue=i=>{if(m){const l=m.map(o=>o.name===i?{...o,disabled:!1}:o);p&&p({type:"all",payload:{bcTob2bContactInformation:[...l]}})}},me=async i=>{var l;try{const o=await Pe({extraFields:i});if(o.code!==200){const s=((l=o.data)==null?void 0:l.errMsg)||o.message||"",a=s.split(":");if(a.length>=2){const r=m==null?void 0:m.find(n=>n.custom&&He.decode(n.name)===a[0]);if(r)return L(r.name,{type:"manual",message:a[1]}),ue(r.name),x(!1),!1}return w(s),x(!1),!1}return w(""),!0}catch(o){return!1}},fe=i=>{const l=de();J(async o=>{if(!l){x(!0);try{if(!await ce(o))return;const r=(m||[]).filter(u=>!!u.custom),n=[];r.length&&r.forEach(u=>{const R={};R.fieldName=y(u.name),R.fieldValue=o[u.name]||(u==null?void 0:u.default)||"",n.push(R)});let d=!0;if(n.length>0&&(d=await me(n)),!d)return;const e=h.filter(u=>u.fieldType==="files"),t=await ie(e||[],o);await le(o,Y,t,n);const f=D.enabled;q&&(p({type:"finishInfo",payload:{submitSuccess:!0,isAutoApproval:f,blockPendingAccountOrderCreation:Q}}),p({type:"all",payload:{accountType:"1"}}),await Te(),G(!0))}catch(s){j.error(s),w((s==null?void 0:s.message)||s)}finally{x(!1)}}})(i)},pe=()=>{Ue(I,!0)&&(D.enabled?I("/orders"):window.location.href="/")};return c.jsx(Ce,{setOpenPage:W,children:c.jsx(_e,{isMobile:V,children:c.jsx(Se,{isSpinning:oe,tip:F("global.tips.loading"),transparency:"0",children:c.jsxs(B,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center","& h4":{color:re},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiDropzoneArea-textContainer, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:[k&&c.jsx(Ge,{children:c.jsx(ge,{sx:{maxWidth:"250px"},onClick:()=>{window.location.href="/"},children:c.jsx("img",{src:k,alt:F("global.tips.registerLogo"),loading:"lazy"})})}),M?c.jsx(We,{handleFinish:pe,isBCToB2B:!0}):c.jsxs(Qe,{sx:{width:V?"100%":"537px",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px",marginTop:"1rem",background:"#FFFFFF",padding:"0 0.8rem 1rem 0.8rem"},children:[c.jsx(Je,{children:F("registeredbctob2b.title")}),v&&c.jsx(xe,{severity:"error",children:c.jsx(Ke,{children:v})}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(T,{children:m!=null&&m.length?(P=m[0])==null?void 0:P.groupName:""}),c.jsx(N,{formFields:m||[],errors:S,control:A,getValues:C,setValue:E})]}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(T,{children:h!=null&&h.length?(H=h[0])==null?void 0:H.groupName:""}),c.jsx(N,{formFields:[...h,...ne],errors:S,control:A,getValues:C,setValue:E,setError:L})]}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(T,{children:g!=null&&g.length?(O=g[0])==null?void 0:O.groupName:""}),c.jsx(N,{formFields:g,errors:S,control:A,getValues:C,setValue:E})]}),!M&&c.jsx(B,{sx:{display:"flex",flexDirection:"row-reverse",pt:2,width:"100%"},children:c.jsx(Ie,{variant:"contained",onClick:fe,children:F("global.button.submit")})})]})]})})})})}export{Qe as StyledRegisterContent,Ct as default};
//# sourceMappingURL=index-zbVoLry_.js.map
