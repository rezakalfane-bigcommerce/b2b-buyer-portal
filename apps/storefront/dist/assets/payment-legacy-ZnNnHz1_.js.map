{"version":3,"file":"payment-legacy-ZnNnHz1_.js","sources":["../../src/shared/service/b2b/graphql/invoice.ts","../../src/pages/Invoice/utils/payment.ts"],"sourcesContent":["import { convertArrayToGraphql } from '../../../../utils';\nimport B3Request from '../../request/b3Fetch';\n\nconst invoiceList = (data: CustomFieldItems) => `{\n  invoices (\n    search: \"${data.q || ''}\"\n    first: ${data.first}\n    offset: ${data.offset} \n    ${data?.status ? `status: ${convertArrayToGraphql(data.status ? [data.status] : [])}` : ''}\n    ${data?.beginDateAt ? `beginDateAt: \"${data.beginDateAt}\"` : ''}\n    ${data?.endDateAt ? `endDateAt: \"${data.endDateAt}\"` : ''}\n    orderBy: \"${data?.orderBy}\"\n    ${data?.beginDueDateAt ? `beginDueDateAt: \"${data.beginDueDateAt}\"` : ''}\n    ${data?.endDueDateAt ? `endDueDateAt: \"${data.endDueDateAt}\"` : ''}\n    ${data?.companyIds ? `companyIds: ${convertArrayToGraphql(data.companyIds || [])}` : ''}\n  ){\n    totalCount,\n    pageInfo{\n      hasNextPage,\n      hasPreviousPage,\n    },\n    edges{\n      node {\n        id,\n        createdAt,\n        updatedAt,\n        storeHash,\n        customerId,\n        externalId,\n        invoiceNumber,\n        dueDate,\n        orderNumber,\n        purchaseOrderNumber,\n        notAllowedPay,\n        details,\n        status,\n        pendingPaymentCount,\n        purchaseOrderNumber,\n        openBalance {\n          code,\n          value,\n        },\n        originalBalance {\n          code,\n          value,\n        },\n        companyInfo {\n          companyId,\n          companyName,\n          companyAddress,\n          companyCountry,\n          companyState,\n          companyCity,\n          companyZipCode,\n          phoneNumber,\n          bcId,\n        },\n        orderUserId,\n      }\n    }\n  }\n}`;\n\nconst invoiceStats = (status: number | string, decimalPlaces: number, companyIds: number[]) => `{\n  invoiceStats (\n    ${status === '' ? '' : `status: ${status},`}\n    decimalPlaces: ${decimalPlaces}\n    ${companyIds.length ? `companyIds: ${convertArrayToGraphql(companyIds || [])}` : ''}\n  ){\n    totalBalance,\n    overDueBalance,\n  }\n}`;\n\nconst getInvoiceDownloadPDF = (invoiceId: number, isPayNow: boolean) => `mutation {\n  invoicePdf (\n    invoiceId: ${invoiceId}\n    ${isPayNow ? `isPayNow: ${isPayNow}` : ''}\n  ){\n    url,\n  }\n}`;\n\nconst invoiceCreateBcCart = (data: any) => `mutation {\n  invoiceCreateBcCart (\n    bcCartData: {\n      lineItems: ${convertArrayToGraphql(data.lineItems)},\n      currency: \"${data.currency}\"\n      details: {\n        memo: \"\"\n      }\n    }\n  ) {\n    result {\n      checkoutUrl\n      cartId\n    }\n  }\n}`;\n\nconst receiptLine = (id: number) => `{\n  allReceiptLines (\n    invoiceId: \"${id}\"\n    first: 50\n    offset: 0\n  ) {\n    edges {\n      node {\n        id\n        paymentType\n        invoiceId\n        amount\n        transactionType\n        referenceNumber\n        createdAt\n      }\n    }\n    totalCount\n  }\n}`;\n\nconst invoiceDetail = (invoiceId: number) => `{\n  invoice (\n    invoiceId: ${invoiceId}\n  ) {\n    id,\n    createdAt,\n    updatedAt,\n    storeHash,\n    customerId,\n    externalId,\n    invoiceNumber,\n    dueDate,\n    orderNumber,\n    purchaseOrderNumber,\n    notAllowedPay,\n    details,\n    status,\n    pendingPaymentCount,\n    purchaseOrderNumber,\n    openBalance {\n      code,\n      value,\n    },\n    originalBalance {\n      code,\n      value,\n    },\n  }\n}`;\n\nconst invoiceReceipt = (id: number) => `{\n  receipt (\n    id: ${id}\n  ) {\n    id,\n    createdAt,\n    updatedAt,\n    storeHash,\n    customerId,\n    externalId,\n    externalCustomerId,\n    totalCode,\n    totalAmount,\n    payerName,\n    payerCustomerId,\n    details,\n    paymentId,\n    transactionType,\n    paymentType,\n    referenceNumber,\n    receiptLineSet {\n      edges {\n        node {\n          id,\n          createdAt,\n          updatedAt,\n          storeHash,\n          customerId,\n          externalId,\n          externalCustomerId,\n          receiptId,\n          invoiceId,\n          amountCode,\n          amount,\n          paymentStatus,\n          paymentType,\n          invoiceNumber,\n          paymentId,\n          transactionType,\n          referenceNumber,\n        }\n      }\n    }\n  }\n}`;\n\nconst exportInvoices = `mutation($invoiceFilterData: InvoiceFilterDataType!, $lang: String!) {\n  invoicesExport (\n    invoiceFilterData: $invoiceFilterData,\n    lang: $lang,\n  ) {\n    url\n  }\n}`;\n\nexport const getInvoiceList = (data: CustomFieldItems) =>\n  B3Request.graphqlB2B({\n    query: invoiceList(data),\n  });\n\nexport const invoiceDownloadPDF = (invoiceId: number, isPayNow: boolean) =>\n  B3Request.graphqlB2B({\n    query: getInvoiceDownloadPDF(invoiceId, isPayNow),\n  });\n\nexport const getInvoiceCheckoutUrl = (data: CustomFieldItems) =>\n  B3Request.graphqlB2B({\n    query: invoiceCreateBcCart(data),\n  });\n\nexport const getInvoicePaymentHistory = (id: number) =>\n  B3Request.graphqlB2B({\n    query: receiptLine(id),\n  });\n\nexport const getInvoiceDetail = (id: number) =>\n  B3Request.graphqlB2B({\n    query: invoiceDetail(id),\n  });\n\nexport const getInvoicePaymentInfo = (id: number) =>\n  B3Request.graphqlB2B({\n    query: invoiceReceipt(id),\n  });\n\nexport const exportInvoicesAsCSV = (data: CustomFieldItems) =>\n  B3Request.graphqlB2B({\n    query: exportInvoices,\n    variables: data,\n  });\n\nexport const getInvoiceStats = (\n  status: number | string,\n  decimalPlaces: number,\n  comapnyIds: number[],\n) =>\n  B3Request.graphqlB2B({\n    query: invoiceStats(status, decimalPlaces, comapnyIds),\n  });\n","import round from 'lodash-es/round';\n\nimport { getInvoiceCheckoutUrl } from '@/shared/service/b2b';\nimport { BcCartData } from '@/types/invoice';\nimport { attemptCheckoutLoginAndRedirect } from '@/utils/b3checkout';\nimport b2bLogger from '@/utils/b3Logger';\n\nexport const getCheckoutUrlAndCart = async (params: BcCartData) => {\n  const {\n    invoiceCreateBcCart: {\n      result: { checkoutUrl, cartId },\n    },\n  } = await getInvoiceCheckoutUrl(params);\n\n  return {\n    checkoutUrl,\n    cartId,\n  };\n};\n\nexport const gotoInvoiceCheckoutUrl = async (\n  params: BcCartData,\n  platform: string,\n  isReplaceCurrentUrl?: boolean,\n) => {\n  const { checkoutUrl, cartId } = await getCheckoutUrlAndCart(params);\n  const handleStencil = () => {\n    if (isReplaceCurrentUrl) {\n      window.location.replace(checkoutUrl);\n    } else {\n      window.location.href = checkoutUrl;\n    }\n  };\n\n  if (platform === 'bigcommerce') {\n    handleStencil();\n    return;\n  }\n\n  try {\n    await attemptCheckoutLoginAndRedirect(cartId, checkoutUrl, isReplaceCurrentUrl);\n  } catch (e) {\n    b2bLogger.error(e);\n    handleStencil();\n  }\n};\n\nexport const formattingNumericValues = (value: number, decimalPlaces: number) =>\n  round(Number(value), decimalPlaces).toFixed(decimalPlaces);\n"],"names":["invoiceList","data","q","first","offset","status","convertArrayToGraphql","beginDateAt","endDateAt","orderBy","beginDueDateAt","endDueDateAt","companyIds","invoiceStats","decimalPlaces","length","getInvoiceDownloadPDF","invoiceId","isPayNow","invoiceCreateBcCart","lineItems","currency","receiptLine","id","invoiceReceipt","getCheckoutUrlAndCart","B3Request","graphqlB2B","query","exports","variables","comapnyIds","async","result","checkoutUrl","cartId","params","platform","isReplaceCurrentUrl","handleStencil","window","location","replace","href","attemptCheckoutLoginAndRedirect","e","b2bLogger","error","value","round","Number","toFixed"],"mappings":"uWAGA,MAAMA,EAAeC,GAA2B,iCAEjCA,EAAKC,GAAK,mBACZD,EAAKE,sBACJF,EAAKG,gBACbH,GAAMI,OAAS,WAAWC,EAAsBL,EAAKI,OAAS,CAACJ,EAAKI,QAAU,MAAQ,WACtFJ,GAAMM,YAAc,iBAAiBN,EAAKM,eAAiB,WAC3DN,GAAMO,UAAY,eAAeP,EAAKO,aAAe,qBAC3CP,GAAMQ,iBAChBR,GAAMS,eAAiB,oBAAoBT,EAAKS,kBAAoB,WACpET,GAAMU,aAAe,kBAAkBV,EAAKU,gBAAkB,WAC9DV,GAAMW,WAAa,eAAeN,EAAsBL,EAAKW,YAAc,MAAQ,23BAiDnFC,EAAeA,CAACR,EAAyBS,EAAuBF,IAAyB,4BAE9E,KAAXP,EAAgB,GAAK,WAAWA,4BACjBS,UACfF,EAAWG,OAAS,eAAeT,EAAsBM,GAAc,MAAQ,2DAO/EI,EAAwBA,CAACC,EAAmBC,IAAsB,8CAEvDD,UACXC,EAAW,aAAaA,IAAa,6BAMrCC,EAAuBlB,GAAc,4EAGxBK,EAAsBL,EAAKmB,iCAC3BnB,EAAKoB,qIAalBC,EAAeC,GAAe,2CAElBA,sPAiDZC,EAAkBD,GAAe,2BAE7BA,ywBClJGE,UDuMkBxB,GAC7ByB,EAAUC,WAAW,CACnBC,MAAO5B,EAAYC,OAGW4B,EAAA,KAAA,CAACZ,EAAmBC,IACpDQ,EAAUC,WAAW,CACnBC,MAAOZ,EAAsBC,EAAWC,cAQHK,GACvCG,EAAUC,WAAW,CACnBC,MAAON,EAAYC,cAGUA,IAC/BG,SAAUC,WAAW,CACnBC,OA3GmBX,EA2GEM,EA3GoB,kCAE5BN,kZAFMA,KA4GpB,WAEmCM,GACpCG,EAAUC,WAAW,CACnBC,MAAOJ,EAAeD,cAGUtB,GAClCyB,EAAUC,WAAW,CACnBC,MAzCmB,mLA0CnBE,UAAW7B,aAGgB,CAC7BI,EACAS,EACAiB,IAEAL,EAAUC,WAAW,CACnBC,MAAOf,EAAaR,EAAQS,EAAeiB,OCjPVC,UAC7B,MACJb,qBACEc,QAAQC,YAAEA,EAAAC,OAAaA,WD8MSlC,EC5MJmC,ED6MhCV,EAAUC,WAAW,CACnBC,MAAOT,EAAoBlB,MAFOA,MC1M7B,MAAA,CACLiC,cACAC,SACF,UAGoCH,MACpCI,EACAC,EACAC,KAEA,MAAMJ,YAAEA,EAAaC,OAAAA,SAAiBV,EAAsBW,GACtDG,EAAgBA,KAChBD,EACKE,OAAAC,SAASC,QAAQR,GAExBM,OAAOC,SAASE,KAAOT,CAAA,EAI3B,GAAiB,gBAAbG,EAKA,UACIO,EAAgCT,EAAQD,EAAaI,SACpDO,GACPC,EAAUC,MAAMF,GACFN,GAAA,MARAA,GAQA,IAIqBV,EAAA,KAAA,CAACmB,EAAelC,IACrDmC,EAAMC,OAAOF,GAAQlC,GAAeqC,QAAQrC"}